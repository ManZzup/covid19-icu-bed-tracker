{"version":3,"sources":["D2App/state/appState.js","D2App/components/OrgUnits.js","D2App/state/apiActions.js","D2App/components/ICUTable.js","D2App/state/store.js","D2App/components/ICUBed.js","D2App/components/ConfigureBedModal.js","D2App/components/useConfirmationHook.js","D2App/components/RegisterPatientModal.js","D2App/components/ICUMap.js","D2App/App.js"],"names":["appSlice","createSlice","name","initialState","activeOrgUnit","activeICU","metaData","icuList","ICUEventId","reducers","setActiveOrgUnit","state","action","payload","setActiveICU","setMetaData","setICUBeds","id","icuId","beds","updateBedStatus","bedIndex","findIndex","b","trackedEntityInstance","bedId","status","updateFilteredICUList","updateICUStat","icuIndex","i","available","stat","total","actions","query","organisationUnits","resource","params","paging","fields","OrgUnits","loading","error","data","refetch","useDataQuery","orgRoot","setOrgRoot","useState","cursor","setCursor","dispatch","useDispatch","traverseResults","useEffect","orgData","root","filter","o","level","children","processList","_children","child","childOrg","length","push","active","_prunedChildren","traverse","console","log","selectOU","node","icus","icu","distance","onToggle","toggled","Object","assign","ICU_EVENT","bedEventHelper","eventType","dataValue","dataElement","value","getEventStatus","event","dataValues","getICUBeds","program","async","getState","dhisEngine","results","ou","trackedEntityInstances","bed","getBedStatus","instanceId","events","lastEvent","bedEventIndex","dv","app","dataElements","addBedEvent","teId","programId","programStageId","additionalData","eventResponse","updateMutation","type","moment","format","mutate","mutation","sortData","field","setLocationData","sortedBy","setSortedBy","sortOrder","setSortOrder","result","slice","sort","locOne","locTwo","propertyOne","propertyTwo","comparison","ICUTable","onSelectICU","locationData","stateData","getOrResolveICUStat","orgUnit","response","getICUStat","primary","onClick","map","loc","key","href","rootReducer","combineReducers","appReducer","configureStore","reducer","ICUBed","onView","onOccupy","onDischarge","onReserve","ref","useRef","open","setOpen","className","createPortal","transparent","placement","reference","document","body","booleanSelections","label","findAttribute","attributes","search","a","attribute","findOption","optionSet","code","ConfigureBedModal","onClose","selectedBed","editable","useSelector","bedAttributes","setBedAttributtes","formState","setFormState","useDataEngine","_bedAttributes","trackedEntityType","trackedEntityTypeAttributes","_formState","attrib","bedValue","valueType","options","option","displayName","updateField","onChange","val","selected","disabled","sel","getAttributeInput","end","secondary","updateBed","teID","importSummaries","createBed","useConfirmation","show","onOk","onCancel","confirm","patientFieldset","RegisterPatientModal","programStage","getFormField","mapContainerStyle","height","width","center","lat","lng","infoWindowInitData","visible","ICUMap","props","onMarkerClick","infoWindowData","setInfoWindowData","handleMarkerOnHover","ICUEntry","markerAvailableOptions","icon","path","fillColor","fillOpacity","strokeColor","strokeWeight","markerUnavailableOptions","googleMapsApiKey","zoom","index","position","onMouseOver","onMouseOut","closeBoxURL","style","backgroundColor","opacity","padding","fontSize","fontColor","getAttributeByName","ViewOrgICU","bedData","onBedTypeChange","ViewICUBeds","placeholder","showConfigure","setShowConfigure","bedModalOpen","setBedModalOpen","patientModalOpen","setPatientModalOpen","setSelectedBed","confirmation","ViewConfigureBeds","onBack","onViewBed","onOccupyBed","onDischargeBed","onReserveBed","onRemoveBed","enrollmentId","enrollments","enrollment","onSelectBed","destructive","ContainerView","trackedEntityAttribute","_dataElements","de","startsWith","elem","MyApp","customizedMiddleware","getDefaultMiddleware","thunk","extraArgument","store","middleware"],"mappings":"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","file":"static/js/app.e66ba3ad.chunk.js","sourcesContent":["import { createSlice } from '@reduxjs/toolkit';\nconst initState = {\n  // activeOrgUnit: null,\n  activeOrgUnit: null,\n  activeICU: null,\n  metaData: null,\n  icuList: [],\n  ICUEventId: \"fKXrko0yhua\"\n};\nconst appSlice = createSlice({\n  name: \"app\",\n  initialState: initState,\n  reducers: {\n    setActiveOrgUnit(state, action) {\n      state.activeOrgUnit = action.payload;\n    },\n\n    setActiveICU(state, action) {\n      state.activeICU = action.payload;\n    },\n\n    setMetaData(state, action) {\n      state.metaData = action.payload;\n    },\n\n    setICUBeds(state, action) {\n      if (state.activeICU && state.activeICU.id === action.payload.icuId) {\n        state.activeICU.beds = action.payload.beds;\n      }\n    },\n\n    updateBedStatus(state, action) {\n      const bedIndex = state.activeICU.beds.findIndex(b => b.trackedEntityInstance === action.payload.bedId);\n      state.activeICU.beds[bedIndex].status = action.payload.status;\n    },\n\n    updateFilteredICUList(state, action) {\n      state.icuList = action.payload;\n    },\n\n    updateICUStat(state, action) {\n      const icuIndex = state.icuList.findIndex(i => i.id === action.payload.icuId);\n      state.icuList[icuIndex].available = action.payload.stat.available;\n      state.icuList[icuIndex].total = action.payload.stat.total;\n    }\n\n  }\n});\nexport const {\n  setActiveOrgUnit,\n  setActiveICU,\n  setMetaData,\n  setICUBeds,\n  updateBedStatus,\n  updateFilteredICUList,\n  updateICUStat\n} = appSlice.actions;\nexport default appSlice.reducer;","import React, { useEffect, useState } from 'react';\nimport { Card } from '@dhis2/ui-core';\nimport { useDispatch } from 'react-redux';\nimport { DataQuery, useDataQuery } from '@dhis2/app-runtime';\nimport { Treebeard } from 'react-treebeard';\nimport { setActiveOrgUnit, updateFilteredICUList, setActiveICU } from '../state/appState';\nconst query = {\n  organisationUnits: {\n    resource: 'organisationUnits.json',\n    params: {\n      paging: 'false',\n      fields: \"id,name,level,children\"\n    }\n  }\n};\nexport default function OrgUnits() {\n  const {\n    loading,\n    error,\n    data,\n    refetch\n  } = useDataQuery(query);\n  const [orgRoot, setOrgRoot] = useState(null);\n  const [cursor, setCursor] = useState(false);\n  const dispatch = useDispatch();\n  var traverseResults = [];\n\n  function processList(orgData, children) {\n    let _children = [];\n\n    for (var child of children) {\n      let childOrg = orgData.filter(o => o.id === child.id);\n\n      if (childOrg.length === 1) {\n        childOrg = childOrg[0];\n\n        if (childOrg.children.length === 0) {\n          childOrg.children = null;\n        } else {\n          childOrg.children = processList(orgData, childOrg.children);\n        }\n\n        _children.push({ ...childOrg,\n          active: false\n        });\n      }\n    }\n\n    let _prunedChildren = [];\n\n    for (var child of _children) {\n      traverseResults = [];\n      traverse(child, 6);\n\n      if (traverseResults.length > 0) {\n        _prunedChildren.push(child);\n      }\n    }\n\n    return _prunedChildren;\n  } // function pruneTree(root){\n  //     traverseResults = [];\n  //     traverse(root, 6);\n  //     if(traverseResults)\n  // }\n\n\n  useEffect(() => {\n    if (data) {\n      const orgData = data.organisationUnits.organisationUnits;\n      const root = data.organisationUnits.organisationUnits.filter(o => o.level === 1)[0];\n      root.children = processList(orgData, root.children);\n      console.log(root);\n      setOrgRoot(root);\n    }\n  }, [loading]);\n\n  const onToggle = (node, toggled) => {\n    if (cursor) {\n      cursor.active = false;\n    }\n\n    node.active = true;\n\n    if (node.children) {\n      node.toggled = toggled;\n    }\n\n    setCursor(node);\n    setOrgRoot(Object.assign({}, orgRoot));\n    selectOU(node);\n  };\n\n  function traverse(root, level) {\n    if (root.level === level) {\n      traverseResults.push({ ...root\n      });\n      return;\n    }\n\n    if (root.children) {\n      for (var child of root.children) {\n        traverse(child, level);\n      }\n    }\n  }\n\n  const selectOU = node => {\n    traverseResults = []; // traverse the tree and find level 6 bois\n\n    traverse(node, 6);\n    let icus = [];\n\n    for (var icu of traverseResults) {\n      icus.push({ ...icu,\n        distance: 0,\n        total: null,\n        available: null\n      });\n    }\n\n    dispatch(updateFilteredICUList(icus));\n    dispatch(setActiveOrgUnit({\n      id: node.id,\n      name: node.name,\n      level: node.level\n    }));\n\n    if (node.level === 6) {\n      dispatch(setActiveICU({\n        id: node.id,\n        beds: []\n      }));\n    }\n  };\n\n  return <Card>\n            {orgRoot && <Treebeard data={orgRoot} onToggle={onToggle} />}\n        </Card>;\n}","import { setICUBeds, setMetaData, updateBedStatus, updateICUStat } from './appState';\nimport * as moment from 'moment';\nconst ICU_EVENT = \"ICU - Bed Event\";\nexport function test() {\n  return async (dispatch, getState, dhisEngine) => {\n    console.log(dhisEngine);\n  };\n}\n\nfunction bedEventHelper(metaData, eventType) {\n  let dataValue = {};\n\n  if (eventType === \"Discharged\") {\n    dataValue = {\n      dataElement: metaData[ICU_EVENT].id,\n      value: \"Discharged\"\n    };\n  } else if (eventType === \"Admitted\") {\n    dataValue = {\n      dataElement: metaData[ICU_EVENT].id,\n      value: \"Admitted\"\n    };\n  } else if (eventType === \"Reserved\") {\n    dataValue = {\n      dataElement: metaData[ICU_EVENT].id,\n      value: \"Reserved\"\n    };\n  }\n\n  return dataValue;\n}\n\nfunction getEventStatus(event) {\n  if (event.dataValues.length > 0) {\n    switch (event.dataValues[0].value) {\n      case \"Discharged\":\n        return \"AVAILABLE\";\n\n      case \"Admitted\":\n        return \"OCCUPIED\";\n\n      case \"Reserved\":\n        return \"RESERVED\";\n    }\n  }\n\n  return \"\";\n}\n\nexport function getMetaData() {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        program: {\n          resource: 'programs/C1wTfmmMQUn',\n          params: {\n            fields: \"id,name,trackedEntityType[id, displayName, trackedEntityTypeAttributes[trackedEntityAttribute[id, displayName, valueType, optionSet[options[displayName, id, code]]]]]\"\n          }\n        },\n        dataElements: {\n          resource: 'dataElements',\n          params: {\n            paging: \"false\",\n            program: \"C1wTfmmMQUn\",\n            fields: \"id,displayName,optionSet[options[id, displayName,code]]\"\n          }\n        }\n      };\n      const {\n        program,\n        dataElements\n      } = await dhisEngine.query(query);\n      let metaData = {\n        id: program.id,\n        name: program.name,\n        trackedEntityType: {\n          id: program.trackedEntityType.id,\n          displayName: program.trackedEntityType.displayName,\n          trackedEntityTypeAttributes: []\n        }\n      };\n\n      for (var attrib of program.trackedEntityType.trackedEntityTypeAttributes) {\n        metaData.trackedEntityType.trackedEntityTypeAttributes.push(attrib.trackedEntityAttribute);\n      }\n\n      let _dataElements = {};\n\n      for (var de of dataElements.dataElements) {\n        if (de.displayName.startsWith(\"ICU\")) {\n          let elem = {\n            id: de.id,\n            displayName: de.displayName\n          };\n\n          if (de.optionSet) {\n            elem[\"options\"] = de.optionSet.options;\n          }\n\n          _dataElements[de.displayName] = elem;\n        }\n      }\n\n      metaData[\"dataElements\"] = _dataElements;\n      dispatch(setMetaData(metaData));\n    } catch (error) {\n      console.log(\"Error in query:\", error);\n    }\n  };\n}\nexport function getICUBeds(icuId, program) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        results: {\n          resource: 'trackedEntityInstances',\n          params: {\n            ou: icuId,\n            fields: \"trackedEntityInstance,attributes[attribute,displayName,value],enrollments\",\n            program: program\n          }\n        }\n      };\n      const response = await dhisEngine.query(query);\n      const beds = response.results.trackedEntityInstances; // now get status of each\n\n      for (var bed of beds) {\n        dispatch(getBedStatus(bed.trackedEntityInstance));\n      }\n\n      dispatch(setICUBeds({\n        icuId,\n        beds\n      }));\n    } catch (error) {\n      console.log(\"Error in query:\", error);\n    }\n  };\n}\nexport function getBedStatus(instanceId) {\n  return async (dispatch, getState, dhisEngine) => {\n    const query = {\n      events: {\n        resource: 'events',\n        params: {\n          trackedEntityInstance: instanceId,\n          paging: \"false\",\n          status: \"ACTIVE\"\n        }\n      }\n    };\n    const response = await dhisEngine.query(query);\n    const events = response.events.events;\n    let status = \"\";\n\n    if (events.length > 0) {\n      const lastEvent = events[0];\n      const bedEventIndex = lastEvent.dataValues.findIndex(dv => dv.dataElement === getState().app.metaData.dataElements[ICU_EVENT].id);\n\n      if (bedEventIndex > -1) {\n        switch (lastEvent.dataValues[bedEventIndex].value) {\n          case \"Discharged\":\n            status = \"AVAILABLE\";\n            break;\n\n          case \"Admitted\":\n            status = \"OCCUPIED\";\n            break;\n\n          case \"Reserved\":\n            status = \"RESERVED\";\n            break;\n        }\n      }\n\n      dispatch(updateBedStatus({\n        bedId: instanceId,\n        status: status,\n        lastEvent: lastEvent\n      }));\n    }\n  };\n}\nexport function createBed(teID, icuId, programId, attributes) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {\n        \"trackedEntityType\": teID,\n        \"orgUnit\": icuId,\n        \"attributes\": attributes,\n        \"enrollments\": [{\n          \"orgUnit\": icuId,\n          \"program\": programId,\n          \"enrollmentDate\": moment().format(\"YYYY-MM-DD\"),\n          \"incidentDate\": moment().format(\"YYYY-MM-DD\")\n        }]\n      };\n      const mutation = {\n        resource: 'trackedEntityInstances',\n        type: 'create',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      const instanceId = response.response.importSummaries[0].reference; // add new event to make the bed available\n\n      dispatch(addBedEvent(instanceId, programId, getState().app.ICUEventId, icuId, \"Discharged\"));\n      dispatch(getICUBeds(icuId, programId));\n    } catch (error) {\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function updateBed(icuId, bedId, attributes) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {\n        \"orgUnit\": icuId,\n        \"attributes\": attributes\n      };\n      const mutation = {\n        resource: 'trackedEntityInstances/' + bedId,\n        type: 'update',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getICUBeds(icuId, getState().app.metaData.id));\n    } catch (error) {\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function removeBed(icuId, enrollmentId) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {};\n      const mutation = {\n        resource: 'enrollments/' + enrollmentId,\n        type: 'delete'\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getICUBeds(icuId, getState().app.metaData.id));\n    } catch (error) {\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function addBedEvent(teId, programId, programStageId, icuId, eventType, additionalData = []) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      // first we complete last event\n      const query = {\n        events: {\n          resource: 'events',\n          params: {\n            trackedEntityInstance: teId,\n            paging: \"false\",\n            status: \"ACTIVE\"\n          }\n        }\n      };\n      const eventResponse = await dhisEngine.query(query);\n\n      if (eventResponse.events.events.length > 0) {\n        const lastEvent = eventResponse.events.events[0];\n        const updatePayload = {\n          \"event\": lastEvent.event,\n          \"trackedEntityInstance\": teId,\n          \"program\": programId,\n          \"programStage\": programStageId,\n          \"enrollment\": icuId,\n          \"orgUnit\": icuId,\n          \"completedDate\": moment().format(\"YYYY-MM-DD\"),\n          \"status\": \"COMPLETED\"\n        };\n        const updateMutation = {\n          resource: 'events',\n          type: 'create',\n          data: updatePayload\n        };\n        await dhisEngine.mutate(updateMutation);\n      }\n\n      const dataValues = [bedEventHelper(getState().app.metaData.dataElements, eventType), ...additionalData];\n      const payload = {\n        \"trackedEntityInstance\": teId,\n        \"program\": programId,\n        \"programStage\": programStageId,\n        \"enrollment\": icuId,\n        \"orgUnit\": icuId,\n        \"dataValues\": dataValues,\n        \"eventDate\": moment().format(\"YYYY-MM-DD\"),\n        \"status\": \"ACTIVE\"\n      };\n      const mutation = {\n        resource: 'events',\n        type: 'create',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getBedStatus(teId));\n    } catch (error) {\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function getICUStat(icu) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      // first we complete last event\n      const query = {\n        events: {\n          resource: 'events',\n          params: {\n            orgUnit: icu.id,\n            paging: \"false\",\n            status: \"ACTIVE\"\n          }\n        }\n      };\n      const response = await dhisEngine.query(query);\n      let stat = {\n        available: 0,\n        total: 0\n      };\n\n      for (var event of response.events.events) {\n        let status = getEventStatus(event);\n\n        if (status === \"AVAILABLE\") {\n          stat.available++;\n        }\n\n        stat.total++;\n      }\n\n      dispatch(updateICUStat({\n        icuId: icu.id,\n        stat: stat\n      }));\n    } catch (error) {\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}","import React, { useEffect, useState } from 'react';\nimport { Table, TableHead, TableBody, TableRow, TableCellHead, TableCell, Button, DropdownButton } from '@dhis2/ui-core';\nimport { useDispatch } from 'react-redux';\nimport { getICUStat } from '../state/apiActions';\n\nfunction sortData(field, data, state) {\n  const {\n    setLocationData,\n    sortedBy,\n    setSortedBy,\n    sortOrder,\n    setSortOrder\n  } = state;\n\n  const compare = (locOne, locTwo) => {\n    let propertyOne = locOne[field];\n    let propertyTwo = locTwo[field];\n    let comparison = 0;\n\n    if (propertyOne > propertyTwo) {\n      comparison = 1;\n    } else if (propertyOne < propertyTwo) {\n      comparison = -1;\n    }\n\n    if (sortedBy === field) {\n      comparison = comparison * -1 * sortOrder; //inverts the order\n    }\n\n    return comparison;\n  };\n\n  let result = data.slice();\n  result = result.sort(compare);\n  setLocationData(result);\n  setSortedBy(field);\n  setSortOrder(sortOrder * -1);\n}\n\nexport default function ICUTable({\n  data,\n  onSelectICU\n}) {\n  const [locationData, setLocationData] = useState([]);\n  const [sortedBy, setSortedBy] = useState('distance');\n  const [sortOrder, setSortOrder] = useState(1);\n  const dispatch = useDispatch();\n  const stateData = {\n    setLocationData,\n    sortedBy,\n    setSortedBy,\n    sortOrder,\n    setSortOrder\n  };\n  useEffect(() => {\n    sortData(sortedBy, data, stateData);\n  }, [data]);\n\n  const getOrResolveICUStat = icu => {\n    if (icu.total === null) {\n      dispatch(getICUStat(icu));\n      return \"Updating....\";\n    }\n\n    return icu.total;\n  };\n\n  if (!data) {\n    return <div></div>;\n  }\n\n  return <Table>\n            <TableHead>\n                <TableRow>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'name'} onClick={() => {\n            sortData('name', locationData, stateData);\n          }}> \n                            ICU\n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'distance'} onClick={() => {\n            sortData('distance', locationData, stateData);\n          }}> \n                            Distance \n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'total'} onClick={() => {\n            sortData('total', locationData, stateData);\n          }}> \n                            TotalBeds \n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'available'} onClick={() => {\n            sortData('available', locationData, stateData);\n          }}> \n                            AvailableBeds \n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  Contact </TableCellHead>\n                </TableRow>\n            </TableHead>\n            <TableBody>\n                {locationData.map((loc, key) => <TableRow key={key}>\n                    <TableCell><a href=\"#\" onClick={() => onSelectICU(loc)}>{loc.name}</a></TableCell>\n                    <TableCell>{loc.distance}</TableCell>\n                    <TableCell>{getOrResolveICUStat(loc)}</TableCell>\n                    <TableCell>{loc.available}</TableCell>\n                    <TableCell>\n                        <p>Dr. John Doe</p>\n                        <p>+94771234568</p>\n                        <p>+94717894562</p>\n                    </TableCell>\n                </TableRow>)}\n            </TableBody>\n        </Table>;\n}","import { configureStore, combineReducers, getDefaultMiddleware } from \"@reduxjs/toolkit\";\nimport appReducer from './appState';\nexport const rootReducer = combineReducers({\n  app: appReducer\n});\nexport const store = configureStore({\n  reducer: rootReducer\n});","import React, { useEffect, useState, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { Popper, ScreenCover } from '@dhis2/ui-core';\nexport default function ICUBed({\n  name,\n  status,\n  onView,\n  onOccupy,\n  onDischarge,\n  onReserve\n}) {\n  const ref = useRef(null);\n  const [open, setOpen] = useState(false);\n\n  const getClassName = () => {\n    if (status === \"AVAILABLE\") {\n      return \"available\";\n    }\n\n    if (status === \"OCCUPIED\") {\n      return \"occupied\";\n    }\n\n    if (status === \"RESERVED\") {\n      return \"reserved\";\n    }\n\n    return \"\";\n  };\n\n  const onToggle = () => {\n    setOpen(!open);\n  };\n\n  return <div className={`icu-bed ${getClassName()}`} ref={ref} onClick={onToggle}>\n            <span>{name}</span>\n            {open && createPortal(<ScreenCover onClick={onToggle} transparent>\n                        <Popper placement=\"right\" reference={ref}>\n                            <div className=\"bed-options\">\n                                {(status === \"AVAILABLE\" || status === \"RESERVED\") && <div onClick={() => {\n            setOpen(false);\n            onOccupy();\n          }}>Occupy</div>}\n                                {status === \"AVAILABLE\" && <div onClick={() => {\n            setOpen(false);\n            onReserve();\n          }}>Reserve</div>}\n                                {status !== \"AVAILABLE\" && <div onClick={() => {\n            setOpen(false);\n            onDischarge();\n          }}>Discharge</div>}\n                                <div onClick={onView}>View</div>\n                            </div>\n                        </Popper>\n                    </ScreenCover>, document.body)}\n        </div>;\n}","import React, { useState, useEffect } from 'react';\nimport { Modal, ModalTitle, ModalActions, ModalContent, ButtonStrip, Button, InputField, SingleSelect, RadioGroup, Radio, RadioGroupField, SingleSelectOption, SingleSelectField } from '@dhis2/ui-core';\nimport { useSelector, useDispatch } from 'react-redux';\nimport * as moment from 'moment';\nimport { useDataMutation, useDataEngine } from '@dhis2/app-runtime';\nimport { test, createBed, updateBed } from '../state/apiActions';\nconst booleanSelections = [{\n  label: \"No\",\n  value: 'false'\n}, {\n  label: \"Yes\",\n  value: 'true'\n}];\n\nfunction findAttribute(attributes, id) {\n  const search = attributes.filter(a => a.attribute === id);\n  return search.length > 0 ? search[0].value : null;\n}\n\nfunction findOption(optionSet, code) {\n  const search = optionSet.filter(o => o.code === code);\n  return search[0];\n}\n\nexport default function ConfigureBedModal({\n  open,\n  onClose,\n  selectedBed,\n  editable\n}) {\n  const metaData = useSelector(state => state.app.metaData);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const [bedAttributes, setBedAttributtes] = useState([]);\n  const [formState, setFormState] = useState({});\n  const engine = useDataEngine();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    if (metaData) {\n      let _bedAttributes = metaData.trackedEntityType.trackedEntityTypeAttributes;\n      let _formState = {};\n\n      for (var attrib of _bedAttributes) {\n        // check if this is a update thing\n        let bedValue = null;\n\n        if (selectedBed) {\n          bedValue = findAttribute(selectedBed.attributes, attrib.id);\n        }\n\n        if (attrib.valueType === \"TEXT\") {\n          if (attrib.optionSet && attrib.optionSet.options && attrib.optionSet.options.length > 0) {\n            if (bedValue) {\n              const option = findOption(attrib.optionSet.options, bedValue);\n              _formState[attrib.id] = {\n                \"label\": option.displayName,\n                \"value\": option.code\n              };\n            } else {\n              _formState[attrib.id] = {\n                \"label\": attrib.optionSet.options[0].displayName,\n                \"value\": attrib.optionSet.options[0].code\n              };\n            }\n          } else {\n            _formState[attrib.id] = bedValue ? bedValue : \"\";\n          }\n        } else if (attrib.valueType === \"BOOLEAN\") {\n          _formState[attrib.id] = {\n            \"label\": bedValue && bedValue === \"true\" ? \"Yes\" : \"No\",\n            \"value\": bedValue ? bedValue : \"false\"\n          };\n        }\n      }\n\n      setFormState(_formState);\n      setBedAttributtes(_bedAttributes);\n    }\n  }, [metaData]);\n\n  if (!open) {\n    return <></>;\n  }\n\n  const updateField = (field, value) => {\n    setFormState({ ...formState,\n      [field]: value\n    });\n  };\n\n  const getAttributeInput = (attrib, key) => {\n    if (attrib.optionSet && attrib.optionSet.options && attrib.optionSet.options.length > 0) {\n      return <SingleSelectField key={key} label={attrib.displayName} name={attrib.id} onChange={val => updateField(attrib.id, val.selected)} selected={formState[attrib.id]} disabled={!editable}>\n                        {attrib.optionSet.options.map((sel, key) => <SingleSelectOption key={key} label={sel.displayName} value={sel.code} />)}\n                </SingleSelectField>;\n    }\n\n    if (attrib.valueType === \"TEXT\") {\n      return <InputField key={key} label={attrib.displayName} name={attrib.id} type=\"text\" onChange={val => updateField(attrib.id, val.value)} value={formState[attrib.id]} disabled={!editable} />;\n    }\n\n    if (attrib.valueType === \"BOOLEAN\") {\n      return <SingleSelectField key={key} label={attrib.displayName} name={attrib.id} onChange={val => updateField(attrib.id, val.selected)} selected={formState[attrib.id]} disabled={!editable}>\n                        {booleanSelections.map((sel, key) => <SingleSelectOption key={key} label={sel.label} value={sel.value} />)}\n                </SingleSelectField>;\n      return <></>;\n    }\n  };\n\n  const addBed = async () => {\n    const attributes = [];\n\n    for (var attrib in formState) {\n      attributes.push({\n        \"attribute\": attrib,\n        \"value\": formState[attrib].value ? formState[attrib].value : formState[attrib]\n      });\n    }\n\n    if (selectedBed) {\n      // update existing bed\n      dispatch(updateBed(activeICU.id, selectedBed.trackedEntityInstance, attributes));\n    } else {\n      //create new bed\n      dispatch(createBed(metaData.trackedEntityType.id, activeICU.id, metaData.id, attributes));\n    }\n\n    onClose();\n  };\n\n  return <Modal open>\n            <ModalTitle>\n                {!editable ? \"View\" : selectedBed ? \"Update\" : \"Add\"} ICU Bed\n            </ModalTitle>\n            <ModalContent>\n                <div className=\"form\">\n                    {bedAttributes.map((attrib, key) => getAttributeInput(attrib, key))}\n                </div>\n            </ModalContent>\n            <ModalActions>\n                <ButtonStrip end>\n                    <Button onClick={onClose} secondary type=\"button\">\n                        Close\n                    </Button>\n                    {editable && <Button onClick={addBed} primary type=\"button\">\n                            {selectedBed ? \"Update Bed\" : \"Add New Bed\"}\n                        </Button>}\n                </ButtonStrip>\n            </ModalActions>\n        </Modal>;\n}","import React from 'react';\nexport default function useConfirmation() {\n  const show = (query, onOk, onCancel) => {\n    const isOk = confirm(query);\n\n    if (isOk) {\n      onOk();\n    } else {\n      onCancel();\n    }\n  };\n\n  return {\n    show\n  };\n}","import React, { useState, useEffect } from 'react';\nimport { Modal, ModalTitle, ModalActions, ModalContent, ButtonStrip, Button, InputField, SingleSelect, RadioGroup, Radio, RadioGroupField, SingleSelectOption, SingleSelectField } from '@dhis2/ui-core';\nimport { addBedEvent } from '../state/apiActions';\nimport { useSelector, useDispatch } from 'react-redux';\nimport useConfirmation from './useConfirmationHook';\nconst patientFieldset = [{\n  type: \"TEXT\",\n  label: \"ICU - BHT Number\",\n  id: \"j1hbO7zzRgV\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Patient Name\",\n  id: \"sK09QRLNyAA\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Consultant In-charge\",\n  id: \"malZQqUEzi9\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Patient Diagnosis\",\n  id: \"qh9bc6jlauE\"\n}];\nexport default function RegisterPatientModal({\n  open,\n  onClose,\n  selectedBed\n}) {\n  const [formState, setFormState] = useState({});\n  const dispatch = useDispatch();\n  const metaData = useSelector(state => state.app.metaData);\n  const programStage = useSelector(state => state.app.ICUEventId);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const confirmation = useConfirmation();\n  useEffect(() => {\n    let _formState = {};\n\n    for (var field of patientFieldset) {\n      if (field.type === \"TEXT\") {\n        _formState[field.id] = \"\";\n      }\n    }\n\n    setFormState(_formState);\n  }, []);\n\n  const updateField = (field, value) => {\n    setFormState({ ...formState,\n      [field]: value\n    });\n  };\n\n  const getFormField = (field, key) => {\n    if (field.type === \"TEXT\") {\n      return <InputField key={key} label={field.label} name={field.id} onChange={val => updateField(field.id, val.value)} value={formState[field.id]} />;\n    }\n  };\n\n  const admitPatient = () => {\n    let dataValues = [];\n\n    for (var field in formState) {\n      dataValues.push({\n        dataElement: field,\n        value: formState[field]\n      });\n    }\n\n    dispatch(addBedEvent(selectedBed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Admitted\", dataValues));\n    onClose();\n  };\n\n  return <Modal open>\n            <ModalTitle>\n                Admit New Patient\n            </ModalTitle>\n            <ModalContent>\n                {patientFieldset.map((field, key) => getFormField(field, key))}\n            </ModalContent>\n            <ModalActions>\n                <ButtonStrip end>\n                    <Button onClick={onClose} secondary type=\"button\">\n                        Close\n                    </Button>\n                    <Button onClick={admitPatient} primary type=\"button\">\n                        Admit Patient\n                    </Button>\n                </ButtonStrip>\n            </ModalActions>\n        </Modal>;\n}","import React, { useEffect, useState } from 'react';\nimport { GoogleMap, LoadScript, Marker, InfoBox } from '@react-google-maps/api';\nconst mapContainerStyle = {\n  height: \"600px\",\n  width: \"100%\"\n};\nconst center = {\n  lat: 8.11,\n  lng: 80.77\n};\nconst infoWindowInitData = {\n  visible: false,\n  ...center\n};\nexport default function ICUMap(props) {\n  const {\n    onMarkerClick,\n    data\n  } = props;\n  const [infoWindowData, setInfoWindowData] = useState(infoWindowInitData);\n\n  const handleMarkerOnHover = ICUEntry => {\n    setInfoWindowData({\n      visible: true,\n      ...ICUEntry\n    });\n  };\n\n  const infoBoxOptions = {\n    closeBoxURL: ''\n  };\n  const markerAvailableOptions = {\n    icon: {\n      path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',\n      fillColor: '#00802b',\n      fillOpacity: 1,\n      strokeColor: '',\n      strokeWeight: 0\n    }\n  };\n  const markerUnavailableOptions = {\n    icon: {\n      path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',\n      fillColor: '#DC143C',\n      fillOpacity: 1,\n      strokeColor: '',\n      strokeWeight: 0\n    }\n  };\n  return <LoadScript id=\"script-loader\" googleMapsApiKey=\"AIzaSyBjlDmwuON9lJbPMDlh_LI3zGpGtpK9erc\">\n            <GoogleMap id='example-map' mapContainerStyle={mapContainerStyle} zoom={7.6} center={center}>\n                {data.map((ICUEntry, index) => {\n        return <Marker position={{\n          lat: ICUEntry.lat,\n          lng: ICUEntry.lng\n        }} onClick={() => {\n          onMarkerClick(ICUEntry);\n        }} onMouseOver={() => {\n          handleMarkerOnHover(ICUEntry);\n        }} onMouseOut={() => {\n          handleMarkerOnHover(infoWindowInitData);\n        }} options={ICUEntry.available > 0 ? markerAvailableOptions : markerUnavailableOptions} />;\n      })}\n                {infoWindowData.visible && <InfoBox position={infoWindowData} options={infoBoxOptions}>\n                        <div style={{\n          backgroundColor: 'white',\n          opacity: 0.95,\n          padding: 5\n        }}>\n                            <div style={{\n            fontSize: 14,\n            fontColor: `#08233B`\n          }}>\n                                <div>ICU: {infoWindowData.name}</div>\n                                <div>Distance: {infoWindowData.distance}</div>\n                                <div>Beds: {infoWindowData.available}</div>\n                            </div>\n                        </div>\n                    </InfoBox>}\n            </GoogleMap>\n        </LoadScript>;\n}","import React, { useState, useEffect } from 'react';\nimport { Provider, useSelector, useDispatch } from 'react-redux';\nimport { DataQuery, useDataQuery, useDataEngine } from '@dhis2/app-runtime';\nimport i18n from '@dhis2/d2-i18n';\nimport OrgUnits from './components/OrgUnits';\nimport './App.css';\nimport { Card, MultiSelect, MultiSelectOption, MultiSelectField, Button, ButtonStrip, Table, TableHead, TableBody, TableRow, TableCellHead, TableCell } from '@dhis2/ui-core';\nimport ICUTable from './components/ICUTable';\nimport * as api from \"./mockapi\";\nimport { rootReducer } from './state/store';\nimport ICUBed from './components/ICUBed';\nimport ConfigureBedModal from './components/ConfigureBedModal';\nimport { setActiveICU, setMetaData, setActiveOrgUnit } from './state/appState';\nimport { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';\nimport { getICUBeds, getMetaData, addBedEvent, removeBed } from './state/apiActions';\nimport RegisterPatientModal from './components/RegisterPatientModal';\nimport useConfirmation from './components/useConfirmationHook';\nimport ICUMap from './components/ICUMap';\n\nfunction getAttributeByName(bed, name) {\n  for (var attrib of bed.attributes) {\n    if (attrib.displayName === name) {\n      return attrib.value;\n    }\n  }\n\n  return \"\";\n}\n\nfunction ViewOrgICU() {\n  const activeOrgUnit = useSelector(state => state.app.activeOrgUnit);\n  const bedData = useSelector(state => state.app.icuList); // const [bedData, setBedData] = useState([]);\n\n  const dispatch = useDispatch();\n  useEffect(() => {// setBedData(api.getICUByOrgUnit(\"lka\"))\n  }, []);\n\n  const onBedTypeChange = () => {};\n\n  if (!activeOrgUnit) {\n    return <p>Please select an organization unit</p>;\n  }\n\n  if (activeOrgUnit.level === 6) {\n    return <ViewICUBeds />;\n  }\n\n  const onSelectICU = icu => {\n    dispatch(setActiveOrgUnit({\n      id: icu.id,\n      name: icu.name,\n      level: icu.level\n    }));\n    dispatch(setActiveICU({\n      id: icu.id,\n      beds: []\n    }));\n  };\n\n  return activeOrgUnit.level < 6 && <>\n                <span className=\"t20\">Showing ICU Locations for <b>{activeOrgUnit.name}</b></span>\n                <div className=\"filter-area\">\n                    \n                        <MultiSelect placeholder=\"ICU Type\" onChange={onBedTypeChange}>\n                            <MultiSelectOption value=\"type01\" label=\"Medical\" />\n                            <MultiSelectOption value=\"type01\" label=\"Surgical\" />\n                            <MultiSelectOption value=\"type01\" label=\"Neurosurgical\" />\n                            <MultiSelectOption value=\"type01\" label=\"Pediatric\" />\n                            <MultiSelectOption value=\"type01\" label=\"Neonatal\" />\n                            <MultiSelectOption value=\"type01\" label=\"Other\" />\n                        </MultiSelect>\n                        <MultiSelect placeholder=\"Bed Type\" onChange={onBedTypeChange}>\n                            <MultiSelectOption value=\"type01\" label=\"Type 01\" onClick={onBedTypeChange} />\n                        </MultiSelect>\n                        <MultiSelect placeholder=\"Diagnosis Type\" onChange={onBedTypeChange}>\n                            <MultiSelectOption value=\"type01\" label=\"Type 01\" onClick={onBedTypeChange} />\n                        </MultiSelect>\n                    \n                </div>\n                <div className=\"icu-org\">\n                    <div className=\"icu-table\">\n                        <ICUTable data={bedData} onSelectICU={onSelectICU} />\n                    </div>\n                    <div className=\"icu-map\">\n                        <ICUMap onMarkerClick={ICUEntry => {\n          console.log(ICUEntry);\n        }} data={bedData} />\n                    </div>\n                </div>\n            </>;\n}\n\nfunction ViewICUBeds() {\n  const activeOrgUnit = useSelector(state => state.app.activeOrgUnit);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const metaData = useSelector(state => state.app.metaData);\n  const programStage = useSelector(state => state.app.ICUEventId);\n  const [showConfigure, setShowConfigure] = useState(false);\n  const [bedModalOpen, setBedModalOpen] = useState(false);\n  const [patientModalOpen, setPatientModalOpen] = useState(false);\n  const [selectedBed, setSelectedBed] = useState(null);\n  const dispatch = useDispatch();\n  const confirmation = useConfirmation();\n  useEffect(() => {\n    if (metaData) {\n      dispatch(getICUBeds(activeICU.id, metaData.id));\n    }\n  }, [metaData, activeICU.id]); // useEffect(() => {\n  //     if(metaData){\n  //         dispatch(getICUBeds(activeICU.id, metaData.id));\n  //     }        \n  // }, [activeICU.id]);\n\n  const onViewBed = bed => {\n    setSelectedBed(bed);\n    setBedModalOpen(true);\n  };\n\n  const onOccupyBed = bed => {\n    setSelectedBed(bed);\n    setPatientModalOpen(true); // dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Admitted\"));\n  };\n\n  const onReserveBed = bed => {\n    confirmation.show(\"Do you want to confirm reserving this bed?\", () => dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Reserved\")), () => {});\n  };\n\n  const onDischargeBed = bed => {\n    confirmation.show(\"Do you want to confirm discharging this bed?\", () => dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Discharged\")), () => {});\n  };\n\n  if (!activeOrgUnit) {\n    return <p>Please select an organization unit</p>;\n  }\n\n  return <>\n            <div className=\"inner-header\">\n                <span className=\"t20\">Showing ICU Bed status at <b>{activeOrgUnit.name}</b></span>\n                <Button onClick={() => setShowConfigure(true)} className=\"pull-right\">Configure Beds</Button>\n            </div>\n            {activeICU && <>\n                    {showConfigure && <ViewConfigureBeds onBack={() => setShowConfigure(false)} />}\n                    {!showConfigure && <div className=\"icu-bed-container\">\n                            {!activeICU.beds.length && <p>No beds currently added</p>}\n                            {activeICU.beds.map((bed, key) => <ICUBed key={key} name={getAttributeByName(bed, \"ICU - Bed Number\")} status={bed.status ? bed.status : \"IDLE\"} onView={() => onViewBed(bed)} onOccupy={() => onOccupyBed(bed)} onDischarge={() => onDischargeBed(bed)} onReserve={() => onReserveBed(bed)} />)}\n                        </div>}\n                </>}\n            {bedModalOpen && <ConfigureBedModal open={bedModalOpen} onClose={() => setBedModalOpen(false)} selectedBed={selectedBed} editable={false} />}\n            {patientModalOpen && <RegisterPatientModal open={patientModalOpen} onClose={() => setPatientModalOpen(false)} selectedBed={selectedBed} />}\n        </>;\n}\n\nfunction ViewConfigureBeds({\n  onBack\n}) {\n  const [bedModalOpen, setBedModalOpen] = useState(false);\n  const dispatch = useDispatch();\n  const activeICU = useSelector(state => state.app.activeICU);\n  const metaData = useSelector(state => state.app.metaData);\n  const [selectedBed, setSelectedBed] = useState(null);\n  const confirmation = useConfirmation(); // useEffect(() => {\n  //     dispatch(getICUBeds(activeICU.id, metaData.id));\n  // }, []);\n\n  const onAddBed = () => {\n    setSelectedBed(null);\n    setBedModalOpen(true);\n  };\n\n  const onSelectBed = bed => {\n    setSelectedBed(bed);\n    setBedModalOpen(true);\n  };\n\n  const onRemoveBed = bed => {\n    confirmation.show(\"Do you really want to remove this bed?\", () => {\n      dispatch(removeBed(activeICU.id, bed.enrollments[0].enrollment));\n    }, () => {});\n  };\n\n  return <>\n            <div className=\"inner-header\">\n                <ButtonStrip end>\n                    <Button onClick={onBack}>Back</Button>\n                    <Button primary onClick={onAddBed}>Add New Bed</Button>\n                </ButtonStrip>\n            </div>\n            <div className=\"inner-container\">\n                <Table>\n                    <TableHead>\n                        <TableRow>\n                            <TableCellHead>Bed No</TableCellHead>  \n                            <TableCellHead>Bed Type</TableCellHead>\n                            <TableCellHead>Covid Type</TableCellHead> \n                            <TableCellHead>Action</TableCellHead> \n                        </TableRow>\n                    </TableHead>\n                    {activeICU && <TableBody>\n                            {activeICU.beds.map((bed, key) => <TableRow key={key}>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - Bed Number\")}</TableCell>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - Type\")}</TableCell>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - COVID Type\")}</TableCell>\n                                    <TableCell>\n                                        <ButtonStrip>\n                                            <Button onClick={() => onSelectBed(bed)}>View Details</Button>\n                                            <Button destructive onClick={() => onRemoveBed(bed)}>Remove</Button>\n                                        </ButtonStrip>\n                                    </TableCell>\n                                </TableRow>)}\n                        </TableBody>}\n                </Table>\n            </div>\n            {bedModalOpen && <ConfigureBedModal open={bedModalOpen} onClose={() => setBedModalOpen(false)} selectedBed={selectedBed} editable={true} />}\n        </>;\n}\n\nfunction ContainerView({\n  children\n}) {\n  const dispatch = useDispatch();\n  useEffect(() => {\n    dispatch(getMetaData());\n  }, []);\n  return <div style={{\n    height: \"100vh\"\n  }}>\n            {children}\n        </div>;\n}\n\nfunction MyApp() {\n  const dhisEngine = useDataEngine();\n  const customizedMiddleware = getDefaultMiddleware({\n    thunk: {\n      extraArgument: dhisEngine\n    }\n  });\n  const store = configureStore({\n    reducer: rootReducer,\n    middleware: customizedMiddleware\n  });\n  return <Provider store={store}>\n            <ContainerView>\n                <div className=\"container\">\n                    <div className=\"left-column\">\n                        <OrgUnits />\n                    </div>\n                    <div className=\"right-column\">\n                        <ViewOrgICU />\n                        {\n            /* <ViewICUBeds /> */\n          }\n                        {\n            /* <ViewConfigureBeds /> */\n          }\n                    </div>\n                </div>\n            </ContainerView>\n        </Provider>;\n}\n\nexport default MyApp;"],"sourceRoot":""}