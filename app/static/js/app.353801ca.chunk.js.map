{"version":3,"sources":["D2App/state/appState.js","D2App/constants.js","D2App/components/OrgUnits.js","D2App/state/notificationState.js","D2App/state/apiActions.js","D2App/components/ICUTable.js","D2App/state/store.js","D2App/components/permissionUtils.js","D2App/components/ICUBed.js","D2App/components/ConfigureBedModal.js","D2App/components/useConfirmationHook.js","D2App/components/RegisterPatientModal.js","D2App/components/ICUMap.js","D2App/components/Notification.js","D2App/App.js"],"names":["appSlice","createSlice","name","initialState","activeUser","activeOrgUnit","activeICU","metaData","icuList","ICUEventId","reducers","setActiveOrgUnit","state","action","payload","setActiveICU","setActiveUser","setMetaData","setICUBeds","id","icuId","beds","updateBedStatus","bedIndex","findIndex","b","trackedEntityInstance","bedId","status","lastEvent","updateFilteredICUList","updateICUStat","icu","find","i","Object","assign","available","stat","total","icuName","isLoading","updateICUDistance","icuIndex","distance","updateActiveICUData","contactPerson","contactNumber","updateICUStatRequest","actions","EXPERTISE_ATTRIBUTES","FACILITIES_ATTRIBUTES","PATIENT_ATTRIBUTES","query","organisationUnits","resource","params","paging","fields","orgSort","x","y","localeCompare","traversalCache","parentMatrix","OrgUnits","loading","error","data","refetch","useDataQuery","orgRoot","setOrgRoot","useState","cursor","setCursor","dispatch","useDispatch","traverseResults","useEffect","orgData","root","filter","o","level","children","processList","parent","_children","child","childOrg","length","push","active","_prunedChildren","traverse","list","sort","organisationUnitGroups","g","concat","selectOU","node","console","log","icus","geometry","type","lat","coordinates","lng","onToggle","toggled","notificationSlice","isOpen","message","showNotification","hideNotification","bedEventHelper","eventType","dataValue","dataElement","value","getEventStatus","event","dataValues","getICUBeds","program","async","getState","dhisEngine","results","ou","trackedEntityInstances","bed","getBedStatus","instanceId","events","bedEventIndex","dv","addBedEvent","teId","programId","programStageId","additionalData","eventResponse","updateMutation","moment","format","mutate","app","dataElements","mutation","getICUStat","filters","filtersQuery","values","map","f","join","substr","orgUnit","filteredTEI","organisationUnit","response","te","displayName","phoneNumber","sortData","field","setLocationData","sortedBy","setSortedBy","sortOrder","setSortOrder","result","slice","locOne","locTwo","propertyOne","propertyTwo","comparison","ICUTableRow","React","memo","loc","onSelectICU","loadICU","href","onClick","ICUTable","locationData","stateData","primary","key","rootReducer","combineReducers","appReducer","notification","notificationReducer","configureStore","reducer","ACTIONS","isRelated","userHasOrgAccess","orgUnits","userHasGroupAccess","groups","accessGroups","accessType","userGroup","canRead","canWrite","hasPerm","programAccess","teAccess","group","indexOf","ICUBed","onView","onOccupy","onDischarge","onReserve","hasEventPerm","onViewPatient","hasEditPerm","ref","useRef","open","setOpen","className","icon","faProcedures","size","createPortal","transparent","placement","reference","document","body","booleanSelections","label","experiseAttrbutes","facilitiesAttributes","infoAttributes","findAttribute","attributes","search","a","attribute","findOption","optionSet","code","ConfigureBedModal","onClose","selectedBed","editable","useSelector","bedAttributes","setBedAttributtes","formState","setFormState","useDataEngine","_bedAttributes","trackedEntityType","trackedEntityTypeAttributes","_formState","attrib","bedValue","valueType","options","option","updateField","getAttributeInput","attribId","formName","onChange","val","selected","disabled","sel","end","secondary","updateBed","teID","importSummaries","createBed","useConfirmation","show","onOk","onCancel","confirm","RegisterPatientModal","actionType","programStage","fieldId","de","getFormField","mapContainerStyle","height","width","center","infoWindowInitData","visible","ICUMap","props","onMarkerClick","origin","updateDistance","infoWindowData","setInfoWindowData","markerData","setMarkerData","distanceRequest","setDistanceRequest","_markerData","_destinationData","_keys","d","p","origins","destinations","travelMode","handleMarkerOnHover","ICUEntry","markerAvailableOptions","path","fillColor","fillOpacity","strokeColor","strokeWeight","scale","useTraceUpdate","googleMapsApiKey","zoom","index","position","onMouseOver","onMouseOut","closeBoxURL","style","backgroundColor","opacity","padding","fontSize","fontColor","callback","Notification","duration","critical","warning","success","prev","changedProps","entries","reduce","ps","k","v","current","keys","getAttributeByName","ViewOrgICU","bedData","setIsLoading","isMapLoading","setIsMapLoading","bedTypeData","covidTypeData","setFilters","useCallback","onLoadICU","ViewICUBeds","placeholder","rows","elements","ind","text","err","showConfigure","setShowConfigure","bedModalOpen","setBedModalOpen","patientModalOpen","setPatientModalOpen","patientModalAction","setPatientModalAction","setSelectedBed","eventPerm","setEventPerm","patientEditable","setPatientEditable","confirmation","access","getAttributeText","ViewConfigureBeds","onBack","onViewBed","onOccupyBed","onDischargeBed","onReserveBed","onRemoveBed","enrollmentId","enrollments","enrollment","onSelectBed","destructive","ContainerView","ga","userGroupAccesses","userGroupUid","startsWith","trackedEntityAttribute","_dataElements","elem","displayFormName","user","userGroups","ug","MyApp","customizedMiddleware","getDefaultMiddleware","thunk","extraArgument","store","middleware","bottom","left","paddingLeft"],"mappings":"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","file":"static/js/app.353801ca.chunk.js","sourcesContent":["import { createSlice } from '@reduxjs/toolkit';\nconst initState = {\n  activeUser: null,\n  activeOrgUnit: null,\n  activeICU: null,\n  metaData: null,\n  icuList: [],\n  ICUEventId: \"fKXrko0yhua\"\n};\nconst appSlice = createSlice({\n  name: \"app\",\n  initialState: initState,\n  reducers: {\n    setActiveOrgUnit(state, action) {\n      state.activeOrgUnit = action.payload;\n    },\n\n    setActiveICU(state, action) {\n      state.activeICU = action.payload;\n    },\n\n    setActiveUser(state, action) {\n      state.activeUser = action.payload;\n    },\n\n    setMetaData(state, action) {\n      state.metaData = action.payload;\n    },\n\n    setICUBeds(state, action) {\n      if (state.activeICU && state.activeICU.id === action.payload.icuId) {\n        state.activeICU.beds = action.payload.beds;\n      }\n    },\n\n    updateBedStatus(state, action) {\n      const bedIndex = state.activeICU.beds.findIndex(b => b.trackedEntityInstance === action.payload.bedId);\n\n      if (bedIndex > -1) {\n        state.activeICU.beds[bedIndex].status = action.payload.status;\n        state.activeICU.beds[bedIndex].lastEvent = action.payload.lastEvent;\n      }\n    },\n\n    updateFilteredICUList(state, action) {\n      state.icuList = action.payload;\n    },\n\n    updateICUStat(state, action) {\n      const icu = state.icuList.find(i => i.id === action.payload.icuId);\n\n      if (icu) {\n        Object.assign(icu, {\n          available: action.payload.stat.available,\n          total: action.payload.stat.total,\n          name: action.payload.icuName,\n          isLoading: false\n        });\n      }\n    },\n\n    updateICUDistance(state, action) {\n      const icuIndex = state.icuList.findIndex(i => i.id === action.payload.icuId);\n\n      if (icuIndex > -1) {\n        state.icuList[icuIndex].distance = action.payload.distance;\n      }\n    },\n\n    updateActiveICUData(state, action) {\n      if (state.activeICU && state.activeICU.id === action.payload.icuId) {\n        Object.assign(state.activeICU, {\n          contactPerson: action.payload.contactPerson,\n          contactNumber: action.payload.contactNumber\n        });\n      }\n    },\n\n    updateICUStatRequest(state, action) {\n      const icu = state.icuList.find(i => i.id === action.payload.icuId);\n      icu.isLoading = true;\n    }\n\n  }\n});\nexport const {\n  setActiveOrgUnit,\n  setActiveICU,\n  setMetaData,\n  setICUBeds,\n  updateBedStatus,\n  updateFilteredICUList,\n  updateICUStat,\n  setActiveUser,\n  updateICUDistance,\n  updateActiveICUData,\n  updateICUStatRequest\n} = appSlice.actions;\nexport default appSlice.reducer;","export const EXPERTISE_ATTRIBUTES = [\"v5eNzdQsLox\", \"eBlbs7BzVfX\", \"JJ2DQSnlhfR\", \"m64bCKnUD8L\", \"Xar8cTc8XN0\", \"k7eXIuzzhat\", \"JZXI1GzSoYx\"];\nexport const FACILITIES_ATTRIBUTES = [\"Jio5MTDVFo4\", \"yvOZEiBS5cd\", \"CGp0lKLkSKY\", \"YCILPvLTofG\"];\nexport const PATIENT_ATTRIBUTES = [\"j1hbO7zzRgV\", \"sK09QRLNyAA\", \"malZQqUEzi9\", \"qh9bc6jlauE\"];\nexport const ICU_EVENT_ID = \"MtYPOv0wqCg\";\nexport const ICU_ORG_UNIT_GROUP = \"PTahQgpjqyQ\";\nexport const SUPER_ADMIN_GROUP = \"LkEkMDG0zfj\";","import React, { useEffect, useState } from 'react';\nimport { Card } from '@dhis2/ui-core';\nimport { useDispatch } from 'react-redux';\nimport { DataQuery, useDataQuery } from '@dhis2/app-runtime';\nimport { Treebeard } from 'react-treebeard';\nimport { setActiveOrgUnit, updateFilteredICUList, setActiveICU } from '../state/appState';\nimport { ICU_ORG_UNIT_GROUP } from '../constants';\nconst query = {\n  organisationUnits: {\n    resource: 'organisationUnits.json',\n    params: {\n      paging: 'false',\n      fields: \"id,name,level,children,geometry,organisationUnitGroups,parent[id, displayName]\"\n    }\n  }\n};\n\nfunction orgSort(x, y) {\n  return x.name.localeCompare(y.name);\n}\n\nlet traversalCache = {};\nexport var parentMatrix = {};\nexport default function OrgUnits() {\n  const {\n    loading,\n    error,\n    data,\n    refetch\n  } = useDataQuery(query);\n  const [orgRoot, setOrgRoot] = useState(null);\n  const [cursor, setCursor] = useState(false);\n  const dispatch = useDispatch();\n  var traverseResults = [];\n\n  function processList(orgData, children, parent = null) {\n    let _children = [];\n\n    for (var child of children) {\n      let childOrg = orgData.find(o => o.id === child.id);\n\n      if (!childOrg) {\n        continue;\n      }\n\n      if (parent) {\n        if (!parentMatrix[childOrg.id]) {\n          parentMatrix[childOrg.id] = {};\n        }\n\n        parentMatrix[childOrg.id] = parent.id;\n      }\n\n      if (childOrg.children.length === 0) {\n        childOrg.children = null;\n      } else {\n        childOrg.children = processList(orgData, childOrg.children, childOrg);\n      }\n\n      _children.push({ ...childOrg,\n        active: false\n      });\n    }\n\n    let _prunedChildren = [];\n\n    for (var child of _children) {\n      traverseResults = [];\n      traverse(child, 5); // traversalCache[child.id] = null;\n\n      if (traverseResults.length > 0) {\n        _prunedChildren.push(child);\n\n        traversalCache[child.id] = { ...child,\n          list: [...traverseResults]\n        };\n      }\n    }\n\n    return _prunedChildren.sort(orgSort);\n  }\n\n  function mergeLevel(node, level = 4) {\n    if (node.level === level - 1) {\n      // at level 3\n      let newChildren = [];\n\n      for (var child1 of node.children) {\n        if (!child1.children) continue;\n\n        for (var child2 of child1.children) {\n          newChildren.push(child2);\n        }\n      }\n\n      node.children = newChildren;\n      return;\n    }\n\n    for (var child of node.children) {\n      mergeLevel(child, level);\n    }\n  }\n\n  useEffect(() => {\n    if (data) {\n      const orgData = data.organisationUnits.organisationUnits;\n      const root = data.organisationUnits.organisationUnits.filter(o => o.level === 1)[0];\n      root.children = processList(orgData, root.children, root);\n      parentMatrix[root.id] = \"\"; // mergeLevel(root, 4);\n\n      setOrgRoot(root);\n    }\n  }, [loading]);\n\n  const onToggle = (node, toggled) => {\n    if (cursor) {\n      cursor.active = false;\n    }\n\n    node.active = true;\n\n    if (node.children) {\n      node.toggled = toggled;\n    }\n\n    setCursor(node);\n    setOrgRoot(Object.assign({}, orgRoot));\n    selectOU(node);\n  };\n\n  function traverse(root, level) {\n    if (root.level === level && root.organisationUnitGroups.findIndex(g => g.id === ICU_ORG_UNIT_GROUP) > -1) {\n      traverseResults.push({ ...root\n      });\n      return;\n    }\n\n    if (root.children) {\n      for (var child of root.children) {\n        if (traversalCache[child.id]) {\n          traverseResults = traverseResults.concat(traversalCache[child.id].list);\n        } else {\n          traverse(child, level);\n        }\n      }\n    }\n  }\n\n  const selectOU = node => {\n    traverseResults = []; // traverse the tree and find level 6 bois\n\n    traverse(node, 5);\n    console.log(\"this hre\");\n    let icus = []; // let requests = traverseResults.map(icu => {\n    //     return new Promise((resolve) => {\n    //         resolve({\n    //             ...icu,\n    //             distance: 0,\n    //             total: null,\n    //             available: null,\n    //             geometry: traversalCache[icu.parent.id] && traversalCache[icu.parent.id].geometry \n    //                         && traversalCache[icu.parent.id].geometry.type === \"Point\" ? \n    //                         {\n    //                             lat: traversalCache[icu.parent.id].geometry.coordinates[1],\n    //                             lng: traversalCache[icu.parent.id].geometry.coordinates[0]\n    //                         } : {\n    //                             lat: 0,\n    //                             lng: 0\n    //                         },\n    //             isLoading: true\n    //         })\n    //     })\n    // });\n    // console.log(\"over promise\");\n    // Promise.all(requests).then((icus) => {\n    //     dispatch(updateFilteredICUList(icus));\n    // });\n\n    for (var icu of traverseResults) {\n      icus.push({ ...icu,\n        distance: 0,\n        total: null,\n        available: null,\n        geometry: traversalCache[icu.parent.id] && traversalCache[icu.parent.id].geometry && traversalCache[icu.parent.id].geometry.type === \"Point\" ? {\n          lat: traversalCache[icu.parent.id].geometry.coordinates[1],\n          lng: traversalCache[icu.parent.id].geometry.coordinates[0]\n        } : {\n          lat: 0,\n          lng: 0\n        },\n        isLoading: true\n      });\n    }\n\n    dispatch(updateFilteredICUList(icus));\n    dispatch(setActiveOrgUnit({\n      id: node.id,\n      name: node.name,\n      level: node.level\n    }));\n\n    if (node.level === 5) {\n      dispatch(setActiveICU({\n        id: node.id,\n        beds: []\n      }));\n    }\n  };\n\n  return <Card>\n            {orgRoot && <Treebeard data={orgRoot} onToggle={onToggle} />}\n        </Card>;\n}","import { createSlice } from '@reduxjs/toolkit';\nconst initState = {\n  isOpen: false,\n  message: null,\n  type: null\n};\nconst notificationSlice = createSlice({\n  name: \"notification\",\n  initialState: initState,\n  reducers: {\n    showNotification(state, action) {\n      state.isOpen = true;\n      state.message = action.payload.message;\n      state.type = action.payload.type;\n    },\n\n    hideNotification(state, action) {\n      state, isOpen = false;\n      state.message = null;\n      state.type = null;\n    }\n\n  }\n});\nexport default notificationSlice.reducer;\nexport const {\n  showNotification,\n  hideNotification\n} = notificationSlice.actions;","import { setICUBeds, setMetaData, updateBedStatus, updateICUStat, setActiveUser, updateActiveICUData, updateICUStatRequest } from './appState';\nimport * as moment from 'moment';\nimport { showNotification } from './notificationState';\nimport { ICU_EVENT_ID } from '../constants';\nexport function test() {\n  return async (dispatch, getState, dhisEngine) => {\n    console.log(dhisEngine);\n  };\n}\n\nfunction bedEventHelper(metaData, eventType) {\n  let dataValue = {};\n\n  if (eventType === \"Discharged\") {\n    dataValue = {\n      dataElement: ICU_EVENT_ID,\n      value: \"Discharged\"\n    };\n  } else if (eventType === \"Admitted\") {\n    dataValue = {\n      dataElement: ICU_EVENT_ID,\n      value: \"Admitted\"\n    };\n  } else if (eventType === \"Reserved\") {\n    dataValue = {\n      dataElement: ICU_EVENT_ID,\n      value: \"Reserved\"\n    };\n  }\n\n  return dataValue;\n}\n\nfunction getEventStatus(event) {\n  if (event.dataValues.length > 0) {\n    switch (event.dataValues[0].value) {\n      case \"Discharged\":\n        return \"AVAILABLE\";\n\n      case \"Admitted\":\n        return \"OCCUPIED\";\n\n      case \"Reserved\":\n        return \"RESERVED\";\n    }\n  }\n\n  return \"\";\n}\n\nexport function getActiveUser() {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        user: {\n          resource: 'me',\n          params: {\n            fields: \"id,displayName,userGroups,organisationUnits[id, geometry]\"\n          }\n        }\n      };\n      const {\n        user\n      } = await dhisEngine.query(query);\n      dispatch(setActiveUser({\n        id: user.id,\n        name: user.displayName,\n        group: user.userGroups.length > 0 ? user.userGroups.map(ug => ug.id) : null,\n        organisationUnits: user.organisationUnits.map(ou => ou.id),\n        origin: user.organisationUnits.length > 0 && user.organisationUnits[0].geometry && user.organisationUnits[0].geometry.type === \"Point\" ? user.organisationUnits[0].geometry.coordinates : null\n      }));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'Error loading user',\n        type: 'error'\n      }));\n      console.log(\"Error in query:\", error);\n    }\n  };\n}\nexport function getMetaData() {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        program: {\n          resource: 'programs/C1wTfmmMQUn',\n          params: {\n            fields: \"id,name,userGroupAccesses,trackedEntityType[id, displayName, userGroupAccesses, trackedEntityTypeAttributes[trackedEntityAttribute[id, displayName, formName, valueType, optionSet[options[displayName, id, code]]]]]\"\n          }\n        },\n        dataElements: {\n          resource: 'dataElements',\n          params: {\n            paging: \"false\",\n            program: \"C1wTfmmMQUn\",\n            fields: \"id,displayName,displayFormName,valueType,optionSet[options[id, displayName, code]]\"\n          }\n        }\n      };\n      const {\n        program,\n        dataElements\n      } = await dhisEngine.query(query);\n      let metaData = {\n        id: program.id,\n        name: program.name,\n        trackedEntityType: {\n          id: program.trackedEntityType.id,\n          displayName: program.trackedEntityType.displayName,\n          trackedEntityTypeAttributes: []\n        }\n      };\n      let programAccess = {};\n\n      for (var ga of program.userGroupAccesses) {\n        programAccess[ga.userGroupUid] = {\n          canRead: ga.access.startsWith(\"rw\"),\n          canWrite: ga.access.startsWith(\"rwrw\")\n        };\n      }\n\n      metaData['programAccess'] = programAccess;\n\n      for (var attrib of program.trackedEntityType.trackedEntityTypeAttributes) {\n        metaData.trackedEntityType.trackedEntityTypeAttributes.push(attrib.trackedEntityAttribute);\n      }\n\n      let teAccess = {};\n\n      for (var ga of program.trackedEntityType.userGroupAccesses) {\n        teAccess[ga.userGroupUid] = {\n          canRead: ga.access.startsWith(\"rw\"),\n          canWrite: ga.access.startsWith(\"rwrw\")\n        };\n      }\n\n      metaData.trackedEntityType['access'] = teAccess;\n      let _dataElements = {};\n\n      for (var de of dataElements.dataElements) {\n        if (de.displayName.startsWith(\"ICU\")) {\n          let elem = {\n            id: de.id,\n            displayName: de.displayName,\n            formName: de.displayFormName,\n            type: de.valueType\n          };\n\n          if (de.optionSet) {\n            elem[\"options\"] = de.optionSet.options;\n          }\n\n          _dataElements[de.displayName] = elem;\n        }\n      }\n\n      metaData[\"dataElements\"] = _dataElements;\n      dispatch(setMetaData(metaData));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'failed to load metadata',\n        type: 'error'\n      }));\n      console.log(\"Error in query:\", error);\n    }\n  };\n}\nexport function getICUBeds(icuId, program) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        results: {\n          resource: 'trackedEntityInstances',\n          params: {\n            ou: icuId,\n            fields: \"trackedEntityInstance,attributes[attribute,displayName,value],enrollments\",\n            program: program\n          }\n        }\n      };\n      const response = await dhisEngine.query(query);\n      const beds = response.results.trackedEntityInstances; // now get status of each\n\n      for (var bed of beds) {\n        dispatch(getBedStatus(bed.trackedEntityInstance));\n      }\n\n      dispatch(setICUBeds({\n        icuId,\n        beds\n      }));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'failed to load icu bed data',\n        type: 'error'\n      }));\n      console.log(\"Error in query:\", error);\n    }\n  };\n}\nexport function getBedStatus(instanceId) {\n  return async (dispatch, getState, dhisEngine) => {\n    const query = {\n      events: {\n        resource: 'events',\n        params: {\n          trackedEntityInstance: instanceId,\n          paging: \"false\",\n          status: \"ACTIVE\"\n        }\n      }\n    };\n    const response = await dhisEngine.query(query);\n    const events = response.events.events;\n    let status = \"\";\n\n    if (events.length > 0) {\n      const lastEvent = events[0];\n      const bedEventIndex = lastEvent.dataValues.findIndex(dv => dv.dataElement === ICU_EVENT_ID);\n\n      if (bedEventIndex > -1) {\n        switch (lastEvent.dataValues[bedEventIndex].value) {\n          case \"Discharged\":\n            status = \"AVAILABLE\";\n            break;\n\n          case \"Admitted\":\n            status = \"OCCUPIED\";\n            break;\n\n          case \"Reserved\":\n            status = \"RESERVED\";\n            break;\n        }\n      }\n\n      dispatch(updateBedStatus({\n        bedId: instanceId,\n        status: status,\n        lastEvent: lastEvent\n      }));\n    }\n  };\n}\nexport function createBed(teID, icuId, programId, attributes) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {\n        \"trackedEntityType\": teID,\n        \"orgUnit\": icuId,\n        \"attributes\": attributes,\n        \"enrollments\": [{\n          \"orgUnit\": icuId,\n          \"program\": programId,\n          \"enrollmentDate\": moment().format(\"YYYY-MM-DD\"),\n          \"incidentDate\": moment().format(\"YYYY-MM-DD\")\n        }]\n      };\n      const mutation = {\n        resource: 'trackedEntityInstances',\n        type: 'create',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      const instanceId = response.response.importSummaries[0].reference; // add new event to make the bed available\n\n      dispatch(addBedEvent(instanceId, programId, getState().app.ICUEventId, icuId, \"Discharged\"));\n      dispatch(getICUBeds(icuId, programId));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in creating bed',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function updateBed(icuId, bedId, attributes) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {\n        \"orgUnit\": icuId,\n        \"attributes\": attributes\n      };\n      const mutation = {\n        resource: 'trackedEntityInstances/' + bedId,\n        type: 'update',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getICUBeds(icuId, getState().app.metaData.id));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in updating bed',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function removeBed(icuId, enrollmentId) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {};\n      const mutation = {\n        resource: 'enrollments/' + enrollmentId,\n        type: 'delete'\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getICUBeds(icuId, getState().app.metaData.id));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in deleting bed',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function addBedEvent(teId, programId, programStageId, icuId, eventType, additionalData = []) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      // first we complete last event\n      const query = {\n        events: {\n          resource: 'events',\n          params: {\n            trackedEntityInstance: teId,\n            paging: \"false\",\n            status: \"ACTIVE\"\n          }\n        }\n      };\n      const eventResponse = await dhisEngine.query(query);\n\n      if (eventResponse.events.events.length > 0) {\n        const lastEvent = eventResponse.events.events[0];\n        const updatePayload = {\n          \"event\": lastEvent.event,\n          \"trackedEntityInstance\": teId,\n          \"program\": programId,\n          \"programStage\": programStageId,\n          \"enrollment\": icuId,\n          \"orgUnit\": icuId,\n          \"completedDate\": moment().format(\"YYYY-MM-DD\"),\n          \"status\": \"COMPLETED\"\n        };\n        const updateMutation = {\n          resource: 'events',\n          type: 'create',\n          data: updatePayload\n        };\n        await dhisEngine.mutate(updateMutation);\n      }\n\n      const dataValues = [bedEventHelper(getState().app.metaData.dataElements, eventType), ...additionalData];\n      const payload = {\n        \"trackedEntityInstance\": teId,\n        \"program\": programId,\n        \"programStage\": programStageId,\n        \"enrollment\": icuId,\n        \"orgUnit\": icuId,\n        \"dataValues\": dataValues,\n        \"eventDate\": moment().format(\"YYYY-MM-DD\"),\n        \"status\": \"ACTIVE\"\n      };\n      const mutation = {\n        resource: 'events',\n        type: 'create',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getBedStatus(teId));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in adding bed event',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function getICUStat(icu, filters = {}) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      dispatch(updateICUStatRequest({\n        icuId: icu.id\n      }));\n      let filtersQuery = \"\";\n\n      for (var filter in filters) {\n        if (filters[filter].length === 0) {\n          continue;\n        }\n\n        const values = filters[filter].map(f => f.value);\n        filtersQuery += `${filter}:IN:${values.join(\";\")},`;\n      }\n\n      filtersQuery = filtersQuery.substr(0, filtersQuery.length - 1); // first we complete last event\n\n      const query = {\n        events: {\n          resource: 'events',\n          params: {\n            orgUnit: icu.id,\n            paging: \"false\",\n            status: \"ACTIVE\"\n          }\n        },\n        filteredTEI: {\n          resource: 'trackedEntityInstances',\n          params: {\n            ou: icu.id,\n            paging: 'false',\n            fields: 'trackedEntityInstance',\n            filter: filtersQuery\n          }\n        },\n        organisationUnit: {\n          resource: 'organisationUnits/' + icu.id,\n          params: {\n            fields: 'id,displayName,parent[displayName, geometry],contactPerson,phoneNumber'\n          }\n        }\n      };\n      const response = await dhisEngine.query(query);\n      let stat = {\n        available: 0,\n        total: 0\n      };\n\n      for (var event of response.events.events) {\n        let teIndex = response.filteredTEI.trackedEntityInstances.findIndex(te => te.trackedEntityInstance === event.trackedEntityInstance);\n\n        if (teIndex === -1) {\n          // filtered TE doesn't have this\n          continue;\n        }\n\n        let status = getEventStatus(event);\n\n        if (status === \"AVAILABLE\") {\n          stat.available++;\n        }\n\n        stat.total++;\n      }\n\n      dispatch(updateICUStat({\n        icuId: icu.id,\n        stat: stat,\n        icuName: `${response.organisationUnit.parent.displayName} - ${response.organisationUnit.displayName}`,\n        contactPerson: response.organisationUnit.contactPerson,\n        contactNumber: response.organisationUnit.phoneNumber\n      }));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in retrieving ICU status',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function getActiveICData(icuId) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        organisationUnit: {\n          resource: 'organisationUnits/' + icuId,\n          params: {\n            fields: 'id,contactPerson,phoneNumber'\n          }\n        }\n      };\n      const response = await dhisEngine.query(query);\n      dispatch(updateActiveICUData({\n        icuId: icuId,\n        contactPerson: response.organisationUnit.contactPerson,\n        contactNumber: response.organisationUnit.phoneNumber\n      }));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in retrieving ICU data',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}","import React, { useEffect, useState } from 'react';\nimport { Table, TableHead, TableBody, TableRow, TableCellHead, TableCell, Button, DropdownButton } from '@dhis2/ui-core';\nimport { useDispatch } from 'react-redux';\nimport { getICUStat } from '../state/apiActions';\nimport { useTraceUpdate } from '../App';\n\nfunction sortData(field, data, state) {\n  const {\n    setLocationData,\n    sortedBy,\n    setSortedBy,\n    sortOrder,\n    setSortOrder\n  } = state;\n\n  const compare = (locOne, locTwo) => {\n    let propertyOne = locOne[field];\n    let propertyTwo = locTwo[field];\n    let comparison = 0;\n\n    if (propertyOne > propertyTwo) {\n      comparison = 1;\n    } else if (propertyOne < propertyTwo) {\n      comparison = -1;\n    }\n\n    if (sortedBy === field) {\n      comparison = comparison * -1 * sortOrder; //inverts the order\n    }\n\n    return comparison;\n  };\n\n  let result = data.slice();\n  result = result.sort(compare);\n  setLocationData(result);\n  setSortedBy(field);\n  setSortOrder(sortOrder * -1);\n}\n\nconst ICUTableRow = React.memo(({\n  loc,\n  onSelectICU,\n  loadICU\n}) => {\n  // useTraceUpdate({loc});\n  // console.log(\"rendering\", loc.id)\n  const dispatch = useDispatch();\n  useEffect(() => {\n    if (loc.total === null) {\n      loadICU(loc);\n    }\n  });\n\n  if (loc.total === 0) {\n    return \"\";\n  }\n\n  return <TableRow>\n            <TableCell><a href=\"#\" onClick={() => onSelectICU(loc)}>{loc.name}</a></TableCell>\n            <TableCell>{loc.distance}</TableCell>\n            <TableCell>{loc.total}</TableCell>\n            <TableCell>{loc.available}</TableCell>\n        </TableRow>;\n});\nconst ICUTable = React.memo(({\n  data,\n  onSelectICU,\n  loadICU\n}) => {\n  // console.log(\"reloading table\");\n  const [locationData, setLocationData] = useState([]);\n  const [sortedBy, setSortedBy] = useState('distance');\n  const [sortOrder, setSortOrder] = useState(1);\n  const dispatch = useDispatch();\n  const stateData = {\n    setLocationData,\n    sortedBy,\n    setSortedBy,\n    sortOrder,\n    setSortOrder\n  };\n  useEffect(() => {\n    sortData(sortedBy, data, stateData);\n  }, [data]);\n\n  if (!data) {\n    return <div></div>;\n  } // useTraceUpdate({data, onSelectICU});\n\n\n  return <Table>\n            <TableHead>\n                <TableRow>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'name'} onClick={() => {\n            sortData('name', locationData, stateData);\n          }}> \n                            ICU\n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'distance'} onClick={() => {\n            sortData('distance', locationData, stateData);\n          }}> \n                            Distance \n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'total'} onClick={() => {\n            sortData('total', locationData, stateData);\n          }}> \n                            TotalBeds \n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'available'} onClick={() => {\n            sortData('available', locationData, stateData);\n          }}> \n                            AvailableBeds \n                        </DropdownButton> \n                    </TableCellHead>\n                </TableRow>\n            </TableHead>\n            <TableBody>\n                {locationData.map((loc, key) => <ICUTableRow loc={loc} onSelectICU={onSelectICU} key={key} loadICU={loadICU} />)}\n            </TableBody>\n        </Table>;\n});\nexport default ICUTable;","import { configureStore, combineReducers, getDefaultMiddleware } from \"@reduxjs/toolkit\";\nimport appReducer from './appState';\nimport notificationReducer from './notificationState';\nexport const rootReducer = combineReducers({\n  app: appReducer,\n  notification: notificationReducer\n});\nexport const store = configureStore({\n  reducer: rootReducer\n});","import { parentMatrix } from \"./OrgUnits\";\nimport { SUPER_ADMIN_GROUP } from \"../constants\";\nexport const ACTIONS = {\n  VIEW_ICU: \"VIEW_ICU\",\n  CONFIG_ICU: \"CONFIG_ICU\",\n  ADD_EVENT: \"ADD_EVENT\"\n}; // function to calculate if the parent has the child down the line\n\nfunction isRelated(parent, child) {\n  while (parentMatrix[child] !== parent) {\n    child = parentMatrix[child];\n\n    if (!parentMatrix[child]) {\n      break;\n    }\n  }\n\n  if (!parentMatrix[child] || parentMatrix[child] !== parent) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction userHasOrgAccess(orgUnits, icuId) {\n  for (var orgUnit of orgUnits) {\n    if (orgUnit === icuId || isRelated(orgUnit, icuId)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction userHasGroupAccess(groups, accessGroups, accessType) {\n  for (var userGroup of groups) {\n    if (accessGroups[userGroup]) {\n      if (accessType === \"READ\") {\n        return accessGroups[userGroup].canRead;\n      }\n\n      if (accessType === \"WRITE\") {\n        return accessGroups[userGroup].canWrite;\n      }\n    }\n  }\n\n  return false;\n}\n\nexport function hasPerm(action, activeUser, programAccess, teAccess, icuId) {\n  if (activeUser.group.indexOf(SUPER_ADMIN_GROUP) > -1) {\n    //super user\n    return true;\n  }\n\n  if (action === ACTIONS.VIEW_ICU) {\n    if (userHasGroupAccess(activeUser.group, teAccess, \"READ\")) {\n      return true;\n    }\n  }\n\n  if (action === ACTIONS.CONFIG_ICU && userHasOrgAccess(activeUser.organisationUnits, icuId)) {\n    if (userHasGroupAccess(activeUser.group, teAccess, \"WRITE\")) {\n      return true;\n    }\n  }\n\n  if (action === ACTIONS.ADD_EVENT) {\n    if (userHasGroupAccess(activeUser.group, programAccess, \"WRITE\") && userHasOrgAccess(activeUser.organisationUnits, icuId)) {\n      return true;\n    }\n  }\n\n  return false;\n}","import React, { useEffect, useState, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { Popper, ScreenCover } from '@dhis2/ui-core';\nimport { hasPerm, ACTIONS } from './permissionUtils';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faProcedures } from '@fortawesome/free-solid-svg-icons';\nexport default function ICUBed({\n  name,\n  status,\n  onView,\n  onOccupy,\n  onDischarge,\n  onReserve,\n  hasEventPerm,\n  onViewPatient,\n  hasEditPerm\n}) {\n  const ref = useRef(null);\n  const [open, setOpen] = useState(false);\n\n  const getClassName = () => {\n    if (status === \"AVAILABLE\") {\n      return \"available\";\n    }\n\n    if (status === \"OCCUPIED\") {\n      return \"occupied\";\n    }\n\n    if (status === \"RESERVED\") {\n      return \"reserved\";\n    }\n\n    return \"\";\n  };\n\n  const onToggle = () => {\n    if (hasEventPerm) {\n      setOpen(!open);\n    }\n  };\n\n  return <div className={`icu-bed ${getClassName()}`} ref={ref} onClick={onToggle}>\n            <FontAwesomeIcon icon={faProcedures} size=\"lg\" />\n            <span>{name}</span>\n            {open && createPortal(<ScreenCover onClick={onToggle} transparent>\n                        <Popper placement=\"right\" reference={ref}>\n                            <div className=\"bed-options\">\n                                {(status === \"AVAILABLE\" || status === \"RESERVED\") && <div onClick={() => {\n            setOpen(false);\n            onOccupy();\n          }}>Occupy</div>}\n                                {status === \"AVAILABLE\" && <div onClick={() => {\n            setOpen(false);\n            onReserve();\n          }}>Reserve</div>}\n                                {status !== \"AVAILABLE\" && <div onClick={() => {\n            setOpen(false);\n            onDischarge();\n          }}>Discharge</div>}\n                                <div onClick={onView}>View</div>\n                                {hasEditPerm && (status === \"OCCUPIED\" || status === \"RESERVED\") && <div onClick={onViewPatient}>View Patient</div>}\n                            </div>\n                        </Popper>\n                    </ScreenCover>, document.body)}\n        </div>;\n}","import React, { useState, useEffect } from 'react';\nimport { Modal, ModalTitle, ModalActions, ModalContent, ButtonStrip, Button, InputField, SingleSelect, RadioGroup, Radio, RadioGroupField, SingleSelectOption, SingleSelectField } from '@dhis2/ui-core';\nimport { useSelector, useDispatch } from 'react-redux';\nimport * as moment from 'moment';\nimport { useDataMutation, useDataEngine } from '@dhis2/app-runtime';\nimport { test, createBed, updateBed } from '../state/apiActions';\nconst booleanSelections = [{\n  label: \"No\",\n  value: 'false'\n}, {\n  label: \"Yes\",\n  value: 'true'\n}];\nconst experiseAttrbutes = [\"v5eNzdQsLox\", \"eBlbs7BzVfX\", \"JJ2DQSnlhfR\", \"m64bCKnUD8L\", \"Xar8cTc8XN0\", \"k7eXIuzzhat\", \"JZXI1GzSoYx\"];\nconst facilitiesAttributes = [\"Jio5MTDVFo4\", \"yvOZEiBS5cd\", \"CGp0lKLkSKY\", \"YCILPvLTofG\"];\nconst infoAttributes = [\"tswabivShTy\", \"Xt5tV6OFSEW\", \"XYNBoDZS0aV\"];\n\nfunction findAttribute(attributes, id) {\n  const search = attributes.filter(a => a.attribute === id);\n  return search.length > 0 ? search[0].value : null;\n}\n\nfunction findOption(optionSet, code) {\n  const search = optionSet.filter(o => o.code === code);\n  return search[0];\n}\n\nexport default function ConfigureBedModal({\n  open,\n  onClose,\n  selectedBed,\n  editable\n}) {\n  const metaData = useSelector(state => state.app.metaData);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const [bedAttributes, setBedAttributtes] = useState([]);\n  const [formState, setFormState] = useState({});\n  const engine = useDataEngine();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    if (metaData) {\n      let _bedAttributes = metaData.trackedEntityType.trackedEntityTypeAttributes;\n      let _formState = {};\n\n      for (var attrib of _bedAttributes) {\n        // check if this is a update thing\n        let bedValue = null;\n\n        if (selectedBed) {\n          bedValue = findAttribute(selectedBed.attributes, attrib.id);\n        }\n\n        if (attrib.valueType === \"TEXT\") {\n          if (attrib.optionSet && attrib.optionSet.options && attrib.optionSet.options.length > 0) {\n            if (bedValue) {\n              const option = findOption(attrib.optionSet.options, bedValue);\n              _formState[attrib.id] = {\n                \"label\": option.displayName,\n                \"value\": option.code\n              };\n            } else {\n              _formState[attrib.id] = {\n                \"label\": attrib.optionSet.options[0].displayName,\n                \"value\": attrib.optionSet.options[0].code\n              };\n            }\n          } else {\n            _formState[attrib.id] = bedValue ? bedValue : \"\";\n          }\n        } else if (attrib.valueType === \"BOOLEAN\") {\n          _formState[attrib.id] = {\n            \"label\": bedValue && bedValue === \"true\" ? \"Yes\" : \"No\",\n            \"value\": bedValue ? bedValue : \"false\"\n          };\n        }\n      }\n\n      setFormState(_formState);\n      setBedAttributtes(_bedAttributes);\n    }\n  }, [metaData]);\n\n  if (!open) {\n    return <></>;\n  }\n\n  const updateField = (field, value) => {\n    setFormState({ ...formState,\n      [field]: value\n    });\n  };\n\n  const getAttributeInput = (attribId, key) => {\n    const attrib = bedAttributes.find(b => b.id === attribId);\n\n    if (attrib.optionSet && attrib.optionSet.options && attrib.optionSet.options.length > 0) {\n      return <SingleSelectField key={key} label={attrib.formName} name={attrib.id} onChange={val => updateField(attrib.id, val.selected)} selected={formState[attrib.id]} disabled={!editable}>\n                        {attrib.optionSet.options.map((sel, key) => <SingleSelectOption key={key} label={sel.displayName} value={sel.code} />)}\n                </SingleSelectField>;\n    }\n\n    if (attrib.valueType === \"TEXT\") {\n      return <InputField key={key} label={attrib.formName} name={attrib.id} type=\"text\" onChange={val => updateField(attrib.id, val.value)} value={formState[attrib.id]} disabled={!editable} />;\n    }\n\n    if (attrib.valueType === \"BOOLEAN\") {\n      return <SingleSelectField key={key} label={attrib.formName} name={attrib.id} onChange={val => updateField(attrib.id, val.selected)} selected={formState[attrib.id]} disabled={!editable}>\n                        {booleanSelections.map((sel, key) => <SingleSelectOption key={key} label={sel.label} value={sel.value} />)}\n                </SingleSelectField>;\n      return <></>;\n    }\n  };\n\n  const addBed = async () => {\n    const attributes = [];\n\n    for (var attrib in formState) {\n      attributes.push({\n        \"attribute\": attrib,\n        \"value\": formState[attrib].value ? formState[attrib].value : formState[attrib]\n      });\n    }\n\n    if (selectedBed) {\n      // update existing bed\n      dispatch(updateBed(activeICU.id, selectedBed.trackedEntityInstance, attributes));\n    } else {\n      //create new bed\n      dispatch(createBed(metaData.trackedEntityType.id, activeICU.id, metaData.id, attributes));\n    }\n\n    onClose();\n  };\n\n  return <Modal open>\n            <ModalTitle>\n                {!editable ? \"View\" : selectedBed ? \"Update\" : \"Add\"} ICU Bed\n            </ModalTitle>\n            <ModalContent>\n                {bedAttributes.length > 0 && <div className=\"form\">\n                        {infoAttributes.map((attrib, key) => getAttributeInput(attrib, key))}\n                        \n                        <h4>Facilities</h4>\n                        {facilitiesAttributes.map((attrib, key) => getAttributeInput(attrib, key))}\n\n                        <h4>Expertise</h4>\n                        {experiseAttrbutes.map((attrib, key) => getAttributeInput(attrib, key))}\n                    </div>}\n            </ModalContent>\n            <ModalActions>\n                <ButtonStrip end>\n                    <Button onClick={onClose} secondary type=\"button\">\n                        Close\n                    </Button>\n                    {editable && <Button onClick={addBed} primary type=\"button\">\n                            {selectedBed ? \"Update Bed\" : \"Add New Bed\"}\n                        </Button>}\n                </ButtonStrip>\n            </ModalActions>\n        </Modal>;\n}","import React from 'react';\nexport default function useConfirmation() {\n  const show = (query, onOk, onCancel) => {\n    const isOk = confirm(query);\n\n    if (isOk) {\n      onOk();\n    } else {\n      onCancel();\n    }\n  };\n\n  return {\n    show\n  };\n}","import React, { useState, useEffect } from 'react';\nimport { Modal, ModalTitle, ModalActions, ModalContent, ButtonStrip, Button, InputField, SingleSelect, RadioGroup, Radio, RadioGroupField, SingleSelectOption, SingleSelectField } from '@dhis2/ui-core';\nimport { addBedEvent } from '../state/apiActions';\nimport { useSelector, useDispatch } from 'react-redux';\nimport useConfirmation from './useConfirmationHook';\nimport { PATIENT_ATTRIBUTES } from '../constants';\nconst patientFieldset = [{\n  type: \"TEXT\",\n  label: \"ICU - BHT Number\",\n  id: \"j1hbO7zzRgV\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Patient Name\",\n  id: \"sK09QRLNyAA\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Consultant In-charge\",\n  id: \"malZQqUEzi9\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Patient Diagnosis\",\n  id: \"qh9bc6jlauE\"\n}];\nexport default function RegisterPatientModal({\n  open,\n  onClose,\n  selectedBed,\n  actionType,\n  editable\n}) {\n  const [formState, setFormState] = useState({});\n  const dispatch = useDispatch();\n  const metaData = useSelector(state => state.app.metaData);\n  const programStage = useSelector(state => state.app.ICUEventId);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const confirmation = useConfirmation();\n  useEffect(() => {\n    let _formState = {};\n\n    for (var fieldId of PATIENT_ATTRIBUTES) {\n      const field = Object.values(metaData.dataElements).find(de => de.id === fieldId);\n\n      if (field.type === \"TEXT\") {\n        if (!editable && selectedBed.lastEvent) {\n          _formState[field.id] = selectedBed.lastEvent.dataValues.find(dv => dv.dataElement === field.id).value;\n        } else {\n          _formState[field.id] = \"\";\n        }\n      }\n    }\n\n    setFormState(_formState);\n  }, [selectedBed]);\n\n  const updateField = (field, value) => {\n    setFormState({ ...formState,\n      [field]: value\n    });\n  };\n\n  const getFormField = (attrib, key) => {\n    const field = Object.values(metaData.dataElements).find(de => de.id === attrib);\n\n    if (field.type === \"TEXT\") {\n      return <InputField key={key} label={field.formName} name={field.id} onChange={val => updateField(field.id, val.value)} value={formState[field.id]} disabled={!editable} />;\n    }\n  };\n\n  const admitPatient = () => {\n    let dataValues = [];\n\n    for (var field in formState) {\n      dataValues.push({\n        dataElement: field,\n        value: formState[field]\n      });\n    }\n\n    if (actionType === \"admit\") {\n      dispatch(addBedEvent(selectedBed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Admitted\", dataValues));\n    } else if (actionType === \"reserve\") {\n      dispatch(addBedEvent(selectedBed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Reserved\", dataValues));\n    }\n\n    onClose();\n  };\n\n  return <Modal open>\n            <ModalTitle>\n                \n                {editable && <span>{actionType === \"admit\" ? 'Admit' : 'Reserve'} New Patient</span>}\n                {!editable && <span>View Patient</span>}\n                \n            </ModalTitle>\n            <ModalContent>\n                {PATIENT_ATTRIBUTES.map((attrib, key) => getFormField(attrib, key))}\n            </ModalContent>\n            <ModalActions>\n                <ButtonStrip end>\n                    <Button onClick={onClose} secondary type=\"button\">\n                        Close\n                    </Button>\n                    {editable && <Button onClick={admitPatient} primary type=\"button\">\n                            {actionType === \"admit\" ? 'Admit' : 'Reserve'} Patient\n                        </Button>}\n                </ButtonStrip>\n            </ModalActions>\n        </Modal>;\n}","import React, { useEffect, useState } from 'react';\nimport { GoogleMap, LoadScript, Marker, InfoBox, DistanceMatrixService } from '@react-google-maps/api';\nimport { useTraceUpdate } from '../App';\nconst mapContainerStyle = {\n  height: \"600px\",\n  width: \"100%\"\n};\nconst center = {\n  lat: 8.11,\n  lng: 80.77\n};\nconst infoWindowInitData = {\n  visible: false,\n  ...center\n};\nconst ICUMap = React.memo(props => {\n  const {\n    onMarkerClick,\n    data,\n    origin,\n    updateDistance\n  } = props;\n  const [infoWindowData, setInfoWindowData] = useState(infoWindowInitData);\n  const [markerData, setMarkerData] = useState(null);\n  const [distanceRequest, setDistanceRequest] = useState(null); // console.log(\"loading map\");\n\n  useEffect(() => {\n    if (data) {\n      // if(!markerData){\n      let _markerData = [];\n      let _destinationData = [];\n      let _keys = {};\n\n      for (var d of data) {\n        if (!_keys[d.parent.id]) {\n          _markerData.push({\n            id: d.parent.id,\n            name: d.parent.displayName,\n            geometry: d.geometry,\n            icus: []\n          });\n\n          _keys[d.parent.id] = true;\n        }\n\n        _markerData.find(p => p.id === d.parent.id).icus.push(d.name);\n\n        _destinationData.push(d.geometry);\n      }\n\n      let destinations = null;\n      let distanceRequest = null;\n\n      if (origin) {\n        // destinations = _markerData.map(d =>  d.geometry);\n        distanceRequest = {\n          origins: [{\n            lat: origin[1],\n            lng: origin[0]\n          }],\n          destinations: _destinationData,\n          travelMode: 'DRIVING'\n        };\n      }\n\n      setMarkerData(_markerData);\n      setDistanceRequest(distanceRequest); // }\n    }\n  }, [data.length, origin]);\n\n  const handleMarkerOnHover = ICUEntry => {\n    setInfoWindowData({\n      visible: true,\n      ...ICUEntry\n    });\n  };\n\n  const infoBoxOptions = {\n    closeBoxURL: ''\n  };\n  const markerAvailableOptions = {\n    icon: {\n      path: 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30 a 2,2 0 1,1 4,0 2,2 0 1,1 -4,0',\n      fillColor: 'green',\n      fillOpacity: 1,\n      strokeColor: '#000',\n      strokeWeight: 1,\n      scale: 1\n    }\n  };\n  const markerUnavailableOptions = {\n    icon: {\n      path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',\n      fillColor: '#DC143C',\n      fillOpacity: 1,\n      strokeColor: '',\n      strokeWeight: 0\n    }\n  }; // let destinations = null;\n  // let distanceRequest = null;\n  // if(origin){\n  //     destinations = data.map(d =>  d.geometry);\n  //     distanceRequest = {\n  //         origins: [{lat: origin[1], lng: origin[0]}],\n  //         destinations: destinations,\n  //         travelMode: 'DRIVING'\n  //     }\n  // }\n\n  useTraceUpdate(props);\n  return <LoadScript id=\"script-loader\" googleMapsApiKey=\"AIzaSyBjlDmwuON9lJbPMDlh_LI3zGpGtpK9erc\">\n            {markerData && <GoogleMap id='example-map' mapContainerStyle={mapContainerStyle} zoom={7.6} center={center}>\n                    {markerData.map((ICUEntry, index) => {\n        return <Marker position={{\n          lat: ICUEntry.geometry.lat,\n          lng: ICUEntry.geometry.lng\n        }} onClick={() => {\n          onMarkerClick(ICUEntry);\n        }} onMouseOver={() => {\n          handleMarkerOnHover(ICUEntry);\n        }} onMouseOut={() => {\n          handleMarkerOnHover(infoWindowInitData);\n        }} options={markerAvailableOptions} key={index} />;\n      })}\n                    {infoWindowData.visible && <InfoBox position={{\n        lat: infoWindowData.geometry.lat,\n        lng: infoWindowData.geometry.lng\n      }} options={infoBoxOptions}>\n                            <div style={{\n          backgroundColor: 'white',\n          opacity: 0.95,\n          padding: 5\n        }}>\n                                <div style={{\n            fontSize: 14,\n            fontColor: `#08233B`\n          }}>\n                                    <div>Hospital: {infoWindowData.name}</div>\n                                    <div><b>ICUs</b></div>\n                                    {infoWindowData.icus.map(name => <div>{name}</div>)}\n                                </div>\n                            </div>\n                        </InfoBox>}\n                </GoogleMap>}\n            {distanceRequest && <DistanceMatrixService options={distanceRequest} callback={(data, status) => updateDistance(data, status)} />}\n        </LoadScript>;\n});\nexport default ICUMap;","import React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { AlertBar } from '@dhis2/ui-core';\nexport default function Notification(props) {\n  const {\n    isOpen,\n    message,\n    type\n  } = useSelector(state => state.notification);\n  if (!isOpen) return null;\n  return <AlertBar duration={5000} icon critical={type === 'error'} warning={type === 'warning'} success={type === 'success'}>\n            {message}\n        </AlertBar>;\n}","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Provider, useSelector, useDispatch } from 'react-redux';\nimport { DataQuery, useDataQuery, useDataEngine } from '@dhis2/app-runtime';\nimport i18n from '@dhis2/d2-i18n';\nimport OrgUnits from './components/OrgUnits';\nimport './App.css';\nimport { Card, MultiSelect, MultiSelectOption, MultiSelectField, Button, ButtonStrip, Table, TableHead, TableBody, TableRow, TableCellHead, TableCell } from '@dhis2/ui-core';\nimport ICUTable from './components/ICUTable';\nimport * as api from \"./mockapi\";\nimport { rootReducer } from './state/store';\nimport ICUBed from './components/ICUBed';\nimport ConfigureBedModal from './components/ConfigureBedModal';\nimport { setActiveICU, setMetaData, setActiveOrgUnit, updateICUStat, updateICUDistance } from './state/appState';\nimport { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';\nimport { getICUBeds, getMetaData, addBedEvent, removeBed, getICUStat, getActiveUser, getActiveICData } from './state/apiActions';\nimport RegisterPatientModal from './components/RegisterPatientModal';\nimport useConfirmation from './components/useConfirmationHook';\nimport ICUMap from './components/ICUMap';\nimport Notification from './components/Notification';\nimport { hasPerm, ACTIONS } from './components/permissionUtils';\nimport { EXPERTISE_ATTRIBUTES, FACILITIES_ATTRIBUTES } from './constants';\nexport function useTraceUpdate(props) {\n  const prev = useRef(props);\n  useEffect(() => {\n    const changedProps = Object.entries(props).reduce((ps, [k, v]) => {\n      if (prev.current[k] !== v) {\n        ps[k] = [prev.current[k], v];\n      }\n\n      return ps;\n    }, {});\n\n    if (Object.keys(changedProps).length > 0) {\n      console.log('Changed props:', changedProps);\n    }\n\n    prev.current = props;\n  });\n}\n\nfunction getAttributeByName(bed, name) {\n  for (var attrib of bed.attributes) {\n    if (attrib.displayName === name) {\n      return attrib.value;\n    }\n  }\n\n  return \"\";\n}\n\nfunction ViewOrgICU() {\n  const activeOrgUnit = useSelector(state => state.app.activeOrgUnit);\n  const activeUser = useSelector(state => state.app.activeUser);\n  const bedData = useSelector(state => state.app.icuList);\n  const metaData = useSelector(state => state.app.metaData);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isMapLoading, setIsMapLoading] = useState(true);\n  const dispatch = useDispatch();\n  const bedTypeId = 'XYNBoDZS0aV';\n  const covidTypeId = 'Xt5tV6OFSEW';\n  let bedTypeData = null;\n  let covidTypeData = null;\n\n  if (metaData) {\n    bedTypeData = metaData.trackedEntityType.trackedEntityTypeAttributes.find(({\n      id\n    }) => id === bedTypeId);\n    covidTypeData = metaData.trackedEntityType.trackedEntityTypeAttributes.find(({\n      id\n    }) => id === covidTypeId);\n  }\n\n  const [filters, setFilters] = useState({\n    [bedTypeId]: [],\n    [covidTypeId]: []\n  }); // console.log(\"icu beds\");\n\n  useEffect(() => {\n    if (bedData) {\n      setIsLoading(true); // for (var icu of bedData) {\n      //     if (icu.total === null) {\n      //         dispatch(getICUStat(icu, filters));\n      //         dispatch(updateICUStat({\n      //             icuId: icu.id,\n      //             stat: {\n      //                 total: \"Updating...\",\n      //                 available: null\n      //             }\n      //         }));\n      //     }\n      // }\n      // let _isLoading = false;\n      // setIsMapLoading(true);\n      // for (var icu of bedData) {\n      //     if(icu.isLoading){\n      //         _isLoading = true;\n      //         break;\n      //     }\n      // }\n      // setIsLoading(_isLoading);\n    }\n  }, [bedData]);\n  useEffect(() => {\n    if (bedData) {\n      for (var icu of bedData) {\n        dispatch(getICUStat(icu, filters));\n      }\n    }\n  }, [filters]);\n  const onSelectICU = useCallback(icu => {\n    dispatch(setActiveOrgUnit({\n      id: icu.id,\n      name: icu.name,\n      level: icu.level\n    }));\n    dispatch(setActiveICU({\n      id: icu.id,\n      beds: []\n    }));\n  }, []);\n  const onLoadICU = useCallback(icu => {\n    dispatch(getICUStat(icu, filters));\n  }, [filters]);\n\n  if (!activeOrgUnit) {\n    return <p>Please select an organization unit</p>;\n  }\n\n  if (activeOrgUnit.level === 5) {\n    return <ViewICUBeds />;\n  }\n\n  const loadICU = icu => {\n    dispatch(getICUStat(icu, filters));\n  };\n\n  const onUpdateDistance = (data, status) => {\n    try {\n      if (data) {\n        if (data.rows && data.rows.length > 0 && data.rows[0].elements && data.rows[0].elements.length === bedData.length) {\n          for (var ind in bedData) {\n            if (data.rows[0].elements[ind].status === \"OK\") {\n              dispatch(updateICUDistance({\n                icuId: bedData[ind].id,\n                distance: `${data.rows[0].elements[ind].distance.text} (${data.rows[0].elements[ind].duration.text})`\n              }));\n            }\n          }\n        }\n      }\n    } catch (err) {// alot of things can go wrong here\n      // in any case, we ignore the result from distance matrix\n    }\n\n    setIsMapLoading(false);\n  };\n\n  return activeOrgUnit.level < 6 && <>\n                <span className=\"t20\">Showing ICU Locations for <b>{activeOrgUnit.name}</b></span>\n                <div className=\"filter-area\">\n                    <MultiSelect selected={filters[bedTypeId]} placeholder={bedTypeData.displayName} onChange={({\n        selected\n      }) => {\n        setFilters({ ...filters,\n          [bedTypeId]: selected\n        });\n      }}>\n                        {bedTypeData && bedTypeData.optionSet.options.map((option, key) => <MultiSelectOption className=\"multiselect-bedtype\" key={key} value={option.code} label={option.displayName} />)}\n                    </MultiSelect>\n                    <MultiSelect selected={filters[covidTypeId]} placeholder={covidTypeData.displayName} onChange={({\n        selected\n      }) => {\n        setFilters({ ...filters,\n          [covidTypeId]: selected\n        });\n      }}>\n                        {covidTypeData && covidTypeData.optionSet.options.map((option, key) => <MultiSelectOption key={key} value={option.code} label={option.displayName} />)}\n                    </MultiSelect>\n                </div>\n\n\n                <div className=\"icu-org\">\n                    {\n        /* { (isLoading || isMapLoading) && \n           <div className=\"icu-table\">\n               <p>Loading ICU stat, please wait...</p>\n               <ICUTable\n                       data={[]}\n                       onSelectICU={onSelectICU}\n                   />\n           </div>\n        } */\n      }\n                    {\n        /* {!(isLoading || isMapLoading) && \n           <div className=\"icu-table\">\n               <ICUTable\n                   data={bedData}\n                   onSelectICU={onSelectICU}\n               />\n           </div>\n        } */\n      }\n                    <div className=\"icu-table\">\n                        <ICUTable data={bedData} onSelectICU={onSelectICU} loadICU={onLoadICU} />\n                    </div>\n                    {\n        /* {!isLoading &&  */\n      }\n                    <div className=\"icu-map\">\n                        <ICUMap onMarkerClick={ICUEntry => {\n          console.log(ICUEntry);\n        }} data={bedData.filter(bed => bed.total !== 0)} origin={activeUser.origin} updateDistance={onUpdateDistance} />\n                    </div>\n                    {\n        /* } */\n      }\n                </div>\n\n            </>;\n}\n\nfunction ViewICUBeds() {\n  const activeUser = useSelector(state => state.app.activeUser);\n  const activeOrgUnit = useSelector(state => state.app.activeOrgUnit);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const metaData = useSelector(state => state.app.metaData);\n  const programStage = useSelector(state => state.app.ICUEventId);\n  const [showConfigure, setShowConfigure] = useState(false);\n  const [bedModalOpen, setBedModalOpen] = useState(false);\n  const [patientModalOpen, setPatientModalOpen] = useState(false);\n  const [patientModalAction, setPatientModalAction] = useState(\"admit\");\n  const [selectedBed, setSelectedBed] = useState(null);\n  const [eventPerm, setEventPerm] = useState(false);\n  const [patientEditable, setPatientEditable] = useState(true);\n  const dispatch = useDispatch();\n  const confirmation = useConfirmation();\n  useEffect(() => {\n    if (metaData) {\n      dispatch(getICUBeds(activeICU.id, metaData.id));\n      dispatch(getActiveICData(activeICU.id));\n\n      if (hasPerm(ACTIONS.ADD_EVENT, activeUser, metaData.programAccess, metaData.trackedEntityType.access, activeICU.id)) {\n        setEventPerm(true);\n      }\n    }\n  }, [metaData, activeICU.id]);\n\n  const onViewBed = bed => {\n    setSelectedBed(bed);\n    setBedModalOpen(true);\n  };\n\n  const onOccupyBed = bed => {\n    setSelectedBed(bed);\n    setPatientEditable(true);\n    setPatientModalAction(\"admit\");\n    setPatientModalOpen(true); // dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Admitted\"));\n  };\n\n  const onReserveBed = bed => {\n    // confirmation.show(\"Do you want to confirm reserving this bed?\",\n    //     () => dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Reserved\")),\n    //     () => { }\n    // );\n    setSelectedBed(bed);\n    setPatientEditable(true);\n    setPatientModalAction(\"reserve\");\n    setPatientModalOpen(true);\n  };\n\n  const onDischargeBed = bed => {\n    confirmation.show(\"Do you want to confirm discharging this bed?\", () => dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Discharged\")), () => {});\n  };\n\n  const onViewPatient = bed => {\n    setSelectedBed(bed);\n    setPatientEditable(false);\n    setPatientModalOpen(true);\n  };\n\n  if (!activeOrgUnit) {\n    return <p>Please select an organization unit</p>;\n  }\n\n  const getAttributeText = (bed, attribId, key) => {\n    if (bed.attributes.find(a => a.attribute === attribId).value === \"true\") {\n      return <p key={key}>{metaData.trackedEntityType.trackedEntityTypeAttributes.find(a => a.id === attribId).formName}</p>;\n    }\n\n    return \"\";\n  };\n\n  return <>\n            <div className=\"inner-header\">\n                <span className=\"t20\">Showing ICU Bed status at <b>{activeOrgUnit.name}</b></span>\n                {hasPerm(ACTIONS.CONFIG_ICU, activeUser, metaData.programAccess, metaData.trackedEntityType.access, activeICU.id) && <Button onClick={() => setShowConfigure(true)} className=\"pull-right\">Configure Beds</Button>}\n            </div>\n            <div className=\"info\">\n                {activeICU.beds.length > 0 && <div className=\"contact\">\n                        <p><b>Facilities</b></p>\n                        {FACILITIES_ATTRIBUTES.map((attrib, key) => getAttributeText(activeICU.beds[0], attrib, key))}\n                    </div>}\n                {activeICU.beds.length > 0 && <div className=\"contact\">\n                        <p><b>Expertise</b></p>\n                        {EXPERTISE_ATTRIBUTES.map((attrib, key) => getAttributeText(activeICU.beds[0], attrib, key))}\n                    </div>}\n                <div className=\"contact\">\n                    <p><b>Primary Contact</b></p>\n                    <p>{activeICU.contactPerson ? activeICU.contactPerson : \"No contact person listed\"}</p>\n                    <p>{activeICU.contactNumber ? activeICU.contactNumber : \"No contact number listed\"}</p>\n                </div>\n            </div>\n            {activeICU && <>\n                    {showConfigure && <ViewConfigureBeds onBack={() => setShowConfigure(false)} />}\n                    {!showConfigure && <div className=\"icu-bed-container\">\n                            {!activeICU.beds.length && <p>No beds currently added</p>}\n                            {activeICU.beds.map((bed, key) => <ICUBed key={key} name={getAttributeByName(bed, \"ICU - Bed Number\")} status={bed.status ? bed.status : \"IDLE\"} onView={() => onViewBed(bed)} onOccupy={() => onOccupyBed(bed)} onDischarge={() => onDischargeBed(bed)} onReserve={() => onReserveBed(bed)} onViewPatient={() => onViewPatient(bed)} hasEventPerm={eventPerm} hasEditPerm={hasPerm(ACTIONS.CONFIG_ICU, activeUser, metaData.programAccess, metaData.trackedEntityType.access, activeICU.id)} />)}\n                        </div>}\n                </>}\n            {bedModalOpen && <ConfigureBedModal open={bedModalOpen} onClose={() => setBedModalOpen(false)} selectedBed={selectedBed} editable={false} />}\n            {patientModalOpen && <RegisterPatientModal open={patientModalOpen} onClose={() => setPatientModalOpen(false)} selectedBed={selectedBed} actionType={patientModalAction} editable={patientEditable} />}\n        </>;\n}\n\nfunction ViewConfigureBeds({\n  onBack\n}) {\n  const [bedModalOpen, setBedModalOpen] = useState(false);\n  const dispatch = useDispatch();\n  const activeICU = useSelector(state => state.app.activeICU);\n  const metaData = useSelector(state => state.app.metaData);\n  const [selectedBed, setSelectedBed] = useState(null);\n  const confirmation = useConfirmation(); // useEffect(() => {\n  //     dispatch(getICUBeds(activeICU.id, metaData.id));\n  // }, []);\n\n  const onAddBed = () => {\n    setSelectedBed(null);\n    setBedModalOpen(true);\n  };\n\n  const onSelectBed = bed => {\n    setSelectedBed(bed);\n    setBedModalOpen(true);\n  };\n\n  const onRemoveBed = bed => {\n    confirmation.show(\"Do you really want to remove this bed?\", () => {\n      dispatch(removeBed(activeICU.id, bed.enrollments[0].enrollment));\n    }, () => {});\n  };\n\n  return <>\n            <div className=\"inner-header\">\n                <ButtonStrip end>\n                    <Button onClick={onBack}>Back</Button>\n                    <Button primary onClick={onAddBed}>Add New Bed</Button>\n                </ButtonStrip>\n            </div>\n            <div className=\"inner-container\">\n                <Table>\n                    <TableHead>\n                        <TableRow>\n                            <TableCellHead>Bed No</TableCellHead>\n                            <TableCellHead>Bed Type</TableCellHead>\n                            <TableCellHead>Covid Type</TableCellHead>\n                            <TableCellHead>Action</TableCellHead>\n                        </TableRow>\n                    </TableHead>\n                    {activeICU && <TableBody>\n                            {activeICU.beds.map((bed, key) => <TableRow key={key}>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - Bed Number\")}</TableCell>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - Type\")}</TableCell>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - COVID Type\")}</TableCell>\n                                    <TableCell>\n                                        <ButtonStrip>\n                                            <Button onClick={() => onSelectBed(bed)}>View Details</Button>\n                                            <Button destructive onClick={() => onRemoveBed(bed)}>Remove</Button>\n                                        </ButtonStrip>\n                                    </TableCell>\n                                </TableRow>)}\n                        </TableBody>}\n                </Table>\n            </div>\n            {bedModalOpen && <ConfigureBedModal open={bedModalOpen} onClose={() => setBedModalOpen(false)} selectedBed={selectedBed} editable={true} />}\n        </>;\n}\n\nfunction ContainerView({\n  children\n}) {\n  const dispatch = useDispatch();\n  useEffect(() => {\n    dispatch(getMetaData());\n    dispatch(getActiveUser());\n  }, []);\n  return <div style={{\n    height: \"100vh\"\n  }}>\n            {children}\n        </div>;\n}\n\nfunction MyApp() {\n  const dhisEngine = useDataEngine();\n  const customizedMiddleware = getDefaultMiddleware({\n    thunk: {\n      extraArgument: dhisEngine\n    }\n  });\n  const store = configureStore({\n    reducer: rootReducer,\n    middleware: customizedMiddleware\n  });\n  return <Provider store={store}>\n            <ContainerView>\n                <div className=\"inner-app-bar\">\n                    COLLEGE OF ANAESTHESIOLOGIST AND INTENSIVIST OF SRI LANKA\n                </div>\n                <div className=\"container\">\n                    <div className=\"left-column\">\n                        <OrgUnits />\n                    </div>\n                    <div className=\"right-column\">\n                        <ViewOrgICU />\n                        {\n            /* <ViewICUBeds /> */\n          }\n                        {\n            /* <ViewConfigureBeds /> */\n          }\n                    </div>\n                </div>\n                <div style={{\n        bottom: 0,\n        left: 0,\n        paddingLeft: 16,\n        position: 'fixed',\n        width: '60%'\n      }}>\n                    <Notification />\n                </div>\n            </ContainerView>\n        </Provider>;\n}\n\nexport default MyApp;"],"sourceRoot":""}