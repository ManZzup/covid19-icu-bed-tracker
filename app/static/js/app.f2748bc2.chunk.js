(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{428:function(e,t,a){},430:function(e,t,a){"use strict";a.r(t);var n=a(193),r=a(1),l=a.n(r),i=a(188),c=a(17),s=(a(7),a(5)),o=a(272),d=a(204);const u=Object(d.b)({name:"app",initialState:{activeUser:null,activeOrgUnit:null,activeICU:null,metaData:null,icuList:[],ICUEventId:"fKXrko0yhua"},reducers:{setActiveOrgUnit(e,t){e.activeOrgUnit=t.payload},setActiveICU(e,t){e.activeICU=t.payload},setActiveUser(e,t){e.activeUser=t.payload},setMetaData(e,t){e.metaData=t.payload},setICUBeds(e,t){e.activeICU&&e.activeICU.id===t.payload.icuId&&(e.activeICU.beds=t.payload.beds)},updateBedStatus(e,t){const a=e.activeICU.beds.findIndex(e=>e.trackedEntityInstance===t.payload.bedId);e.activeICU.beds[a].status=t.payload.status,e.activeICU.beds[a].lastEvent=t.payload.lastEvent},updateFilteredICUList(e,t){e.icuList=t.payload},updateICUStat(e,t){const a=e.icuList.findIndex(e=>e.id===t.payload.icuId);e.icuList[a].available=t.payload.stat.available,e.icuList[a].total=t.payload.stat.total,e.icuList[a].name=t.payload.icuName},updateICUDistance(e,t){const a=e.icuList.findIndex(e=>e.id===t.payload.icuId);e.icuList[a].distance=t.payload.distance}}}),{setActiveOrgUnit:m,setActiveICU:p,setMetaData:E,setICUBeds:y,updateBedStatus:b,updateFilteredICUList:v,updateICUStat:g,setActiveUser:f,updateICUDistance:h}=u.actions;var C=u.reducer;const O={organisationUnits:{resource:"organisationUnits.json",params:{paging:"false",fields:"id,name,level,children,geometry"}}};function I(){const{loading:e,error:t,data:a,refetch:d}=Object(c.c)(O),[u,E]=Object(r.useState)(null),[y,b]=Object(r.useState)(!1),g=Object(i.b)();var f=[];Object(r.useEffect)(()=>{if(a){const e=a.organisationUnits.organisationUnits,t=a.organisationUnits.organisationUnits.filter(e=>1===e.level)[0];t.children=function e(t,a){let r=[];for(var l of a){let a=t.filter(e=>e.id===l.id);1===a.length&&(a=a[0],0===a.children.length?a.children=null:a.children=e(t,a.children),r.push(Object(n.a)({},a,{active:!1})))}let i=[];for(var l of r)f=[],h(l,6),f.length>0&&i.push(l);return i}(e,t.children),function e(t,a=4){if(t.level!==a-1)for(var n of t.children)e(n,a);else{let e=[];for(var r of t.children)if(r.children)for(var l of r.children)e.push(l);t.children=e}}(t,4),E(t)}},[e]);function h(e,t){if(e.level!==t){if(e.children)for(var a of e.children)h(a,t)}else f.push(Object(n.a)({},e))}const C=e=>{f=[],h(e,6);let t=[];for(var a of f)t.push(Object(n.a)({},a,{distance:0,total:null,available:null,geometry:a.geometry?{lat:a.geometry.coordinates[1],lng:a.geometry.coordinates[0]}:{lat:0,lng:0}}));g(v(t)),g(m({id:e.id,name:e.name,level:e.level})),6===e.level&&g(p({id:e.id,beds:[]}))};return l.a.createElement(s.d,null,u&&l.a.createElement(o.Treebeard,{data:u,onToggle:(e,t)=>{y&&(y.active=!1),e.active=!0,e.children&&(e.toggled=t),b(e),E(Object.assign({},u)),C(e)}}))}a(428);var k=a(25);const U=Object(d.b)({name:"notification",initialState:{isOpen:!1,message:null,type:null},reducers:{showNotification(e,t){e.isOpen=!0,e.message=t.payload.message,e.type=t.payload.type},hideNotification(e,t){isOpen=!1,e.message=null,e.type=null}}});var j=U.reducer;const{showNotification:N,hideNotification:A}=U.actions,S="ICU - Bed Event";function D(e,t){let a={};return"Discharged"===t?a={dataElement:e[S].id,value:"Discharged"}:"Admitted"===t?a={dataElement:e[S].id,value:"Admitted"}:"Reserved"===t&&(a={dataElement:e[S].id,value:"Reserved"}),a}function T(e){if(e.dataValues.length>0)switch(e.dataValues[0].value){case"Discharged":return"AVAILABLE";case"Admitted":return"OCCUPIED";case"Reserved":return"RESERVED"}return""}function w(e,t){return async(a,n,r)=>{try{const n={results:{resource:"trackedEntityInstances",params:{ou:e,fields:"trackedEntityInstance,attributes[attribute,displayName,value],enrollments",program:t}}},i=(await r.query(n)).results.trackedEntityInstances;for(var l of i)a(B(l.trackedEntityInstance));a(y({icuId:e,beds:i}))}catch(i){a(N({message:"failed to load icu bed data",type:"error"})),console.log("Error in query:",i)}}}function B(e){return async(t,a,n)=>{const r={events:{resource:"events",params:{trackedEntityInstance:e,paging:"false",status:"ACTIVE"}}},l=(await n.query(r)).events.events;let i="";if(l.length>0){const n=l[0],r=n.dataValues.findIndex(e=>e.dataElement===a().app.metaData.dataElements[S].id);if(r>-1)switch(n.dataValues[r].value){case"Discharged":i="AVAILABLE";break;case"Admitted":i="OCCUPIED";break;case"Reserved":i="RESERVED"}t(b({bedId:e,status:i,lastEvent:n}))}}}function V(e,t,a,n,r,l=[]){return async(i,c,s)=>{try{const o={events:{resource:"events",params:{trackedEntityInstance:e,paging:"false",status:"ACTIVE"}}},d=await s.query(o);if(d.events.events.length>0){const r={resource:"events",type:"create",data:{event:d.events.events[0].event,trackedEntityInstance:e,program:t,programStage:a,enrollment:n,orgUnit:n,completedDate:k().format("YYYY-MM-DD"),status:"COMPLETED"}};await s.mutate(r)}const u=[D(c().app.metaData.dataElements,r),...l],m={resource:"events",type:"create",data:{trackedEntityInstance:e,program:t,programStage:a,enrollment:n,orgUnit:n,dataValues:u,eventDate:k().format("YYYY-MM-DD"),status:"ACTIVE"}};await s.mutate(m);i(B(e))}catch(o){i(N({message:"error in adding bed event",type:"error"})),console.log("Error in creating:",o)}}}function L(e,t={}){return async(a,n,r)=>{try{let n="";for(var l in t){if(0===t[l].length)continue;const e=t[l].map(e=>e.value);n+="".concat(l,":IN:").concat(e.join(";"),",")}n=n.substr(0,n.length-1);const c={events:{resource:"events",params:{orgUnit:e.id,paging:"false",status:"ACTIVE"}},filteredTEI:{resource:"trackedEntityInstances",params:{ou:e.id,paging:"false",fields:"trackedEntityInstance",filter:n}},organisationUnit:{resource:"organisationUnits/"+e.id,params:{fields:"id,displayName,parent[displayName]"}}},s=await r.query(c);let o={available:0,total:0};for(var i of s.events.events){-1!==s.filteredTEI.trackedEntityInstances.findIndex(e=>e.trackedEntityInstance===i.trackedEntityInstance)&&("AVAILABLE"===T(i)&&o.available++,o.total++)}a(g({icuId:e.id,stat:o,icuName:"".concat(s.organisationUnit.parent.displayName," - ").concat(s.organisationUnit.displayName)}))}catch(c){a(N({message:"error in retrieving ICU status",type:"error"})),console.log("Error in creating:",c)}}}function R(e,t,a){const{setLocationData:n,sortedBy:r,setSortedBy:l,sortOrder:i,setSortOrder:c}=a;let s=t.slice();s=s.sort((t,a)=>{let n=t[e],l=a[e],c=0;return n>l?c=1:n<l&&(c=-1),r===e&&(c=-1*c*i),c}),n(s),l(e),c(-1*i)}function Y({data:e,onSelectICU:t}){const[a,n]=Object(r.useState)([]),[c,o]=Object(r.useState)("distance"),[d,u]=Object(r.useState)(1),m=(Object(i.b)(),{setLocationData:n,sortedBy:c,setSortedBy:o,sortOrder:d,setSortOrder:u});return Object(r.useEffect)(()=>{R(c,e,m)},[e]),e?l.a.createElement(s.x,null,l.a.createElement(s.B,null,l.a.createElement(s.C,null,l.a.createElement(s.A,null,l.a.createElement(s.i,{primary:"name"===c,onClick:()=>{R("name",a,m)}},"ICU")),l.a.createElement(s.A,null,l.a.createElement(s.i,{primary:"distance"===c,onClick:()=>{R("distance",a,m)}},"Distance")),l.a.createElement(s.A,null,l.a.createElement(s.i,{primary:"total"===c,onClick:()=>{R("total",a,m)}},"TotalBeds")),l.a.createElement(s.A,null,l.a.createElement(s.i,{primary:"available"===c,onClick:()=>{R("available",a,m)}},"AvailableBeds")))),l.a.createElement(s.y,null,a.map((e,a)=>l.a.createElement(s.C,{key:a},l.a.createElement(s.z,null,l.a.createElement("a",{href:"#",onClick:()=>t(e)},e.name)),l.a.createElement(s.z,null,e.distance),l.a.createElement(s.z,null,e.total),l.a.createElement(s.z,null,e.available))))):l.a.createElement("div",null)}var z=a(189);const M=Object(z.combineReducers)({app:C,notification:j});Object(d.a)({reducer:M});var X=a(15);const P="VIEW_ICU",x="CONFIG_ICU",G="ADD_EVENT";function W(e,t,a,n,r){return"LkEkMDG0zfj"===t.group||(!(e!==P||!n[t.group]||!n[t.group].canRead)||(!!(e===x&&t.organisationUnits.indexOf(r)>-1&&n[t.group]&&n[t.group].canWrite)||!!(e===G&&a[t.group]&&a[t.group].canWrite&&t.organisationUnits.indexOf(r)>-1)))}function F({name:e,status:t,onView:a,onOccupy:n,onDischarge:i,onReserve:c,hasEventPerm:o,onViewPatient:d,hasEditPerm:u}){const m=Object(r.useRef)(null),[p,E]=Object(r.useState)(!1),y=()=>{o&&E(!p)};return l.a.createElement("div",{className:"icu-bed ".concat("AVAILABLE"===t?"available":"OCCUPIED"===t?"occupied":"RESERVED"===t?"reserved":""),ref:m,onClick:y},l.a.createElement("span",null,e),p&&Object(X.createPortal)(l.a.createElement(s.u,{onClick:y,transparent:!0},l.a.createElement(s.t,{placement:"right",reference:m},l.a.createElement("div",{className:"bed-options"},("AVAILABLE"===t||"RESERVED"===t)&&l.a.createElement("div",{onClick:()=>{E(!1),n()}},"Occupy"),"AVAILABLE"===t&&l.a.createElement("div",{onClick:()=>{E(!1),c()}},"Reserve"),"AVAILABLE"!==t&&l.a.createElement("div",{onClick:()=>{E(!1),i()}},"Discharge"),l.a.createElement("div",{onClick:a},"View"),u&&("OCCUPIED"===t||"RESERVED"===t)&&l.a.createElement("div",{onClick:d},"View Patient")))),document.body))}const q=[{label:"No",value:"false"},{label:"Yes",value:"true"}],J=["v5eNzdQsLox","eBlbs7BzVfX","JJ2DQSnlhfR","m64bCKnUD8L","Xar8cTc8XN0","k7eXIuzzhat","JZXI1GzSoYx"],K=["Jio5MTDVFo4","yvOZEiBS5cd","CGp0lKLkSKY","YCILPvLTofG"],Z=["tswabivShTy","Xt5tV6OFSEW","XYNBoDZS0aV"];function Q(e,t){const a=e.filter(e=>e.attribute===t);return a.length>0?a[0].value:null}function _(e,t){return e.filter(e=>e.code===t)[0]}function H({open:e,onClose:t,selectedBed:a,editable:o}){const d=Object(i.c)(e=>e.app.metaData),u=Object(i.c)(e=>e.app.activeICU),[m,p]=Object(r.useState)([]),[E,y]=Object(r.useState)({}),b=(Object(c.b)(),Object(i.b)());if(Object(r.useEffect)(()=>{if(d){let t=d.trackedEntityType.trackedEntityTypeAttributes,n={};for(var e of t){let t=null;if(a&&(t=Q(a.attributes,e.id)),"TEXT"===e.valueType)if(e.optionSet&&e.optionSet.options&&e.optionSet.options.length>0)if(t){const a=_(e.optionSet.options,t);n[e.id]={label:a.displayName,value:a.code}}else n[e.id]={label:e.optionSet.options[0].displayName,value:e.optionSet.options[0].code};else n[e.id]=t||"";else"BOOLEAN"===e.valueType&&(n[e.id]={label:t&&"true"===t?"Yes":"No",value:t||"false"})}y(n),p(t)}},[d]),!e)return l.a.createElement(l.a.Fragment,null);const v=(e,t)=>{y(Object(n.a)({},E,{[e]:t}))},g=(e,t)=>{console.log(e),console.log(m);const a=m.find(t=>t.id===e);return console.log(a),a.optionSet&&a.optionSet.options&&a.optionSet.options.length>0?l.a.createElement(s.v,{key:t,label:a.formName,name:a.id,onChange:e=>v(a.id,e.selected),selected:E[a.id],disabled:!o},a.optionSet.options.map((e,t)=>l.a.createElement(s.w,{key:t,label:e.displayName,value:e.code}))):"TEXT"===a.valueType?l.a.createElement(s.j,{key:t,label:a.formName,name:a.id,type:"text",onChange:e=>v(a.id,e.value),value:E[a.id],disabled:!o}):"BOOLEAN"===a.valueType?l.a.createElement(s.v,{key:t,label:a.formName,name:a.id,onChange:e=>v(a.id,e.selected),selected:E[a.id],disabled:!o},q.map((e,t)=>l.a.createElement(s.w,{key:t,label:e.label,value:e.value}))):void 0};return l.a.createElement(s.m,{open:!0},l.a.createElement(s.p,null,o?a?"Update":"Add":"View"," ICU Bed"),l.a.createElement(s.o,null,m.length>0&&l.a.createElement("div",{className:"form"},Z.map((e,t)=>g(e,t)),l.a.createElement("h4",null,"Facilities"),K.map((e,t)=>g(e,t)),l.a.createElement("h4",null,"Expertise"),J.map((e,t)=>g(e,t)))),l.a.createElement(s.n,null,l.a.createElement(s.c,{end:!0},l.a.createElement(s.b,{onClick:t,secondary:!0,type:"button"},"Close"),o&&l.a.createElement(s.b,{onClick:async()=>{const e=[];for(var n in E)e.push({attribute:n,value:E[n].value?E[n].value:E[n]});b(a?function(e,t,a){return async(n,r,l)=>{try{const i={resource:"trackedEntityInstances/"+t,type:"update",data:{orgUnit:e,attributes:a}};await l.mutate(i);n(w(e,r().app.metaData.id))}catch(i){n(N({message:"error in updating bed",type:"error"})),console.log("Error in creating:",i)}}}(u.id,a.trackedEntityInstance,e):function(e,t,a,n){return async(r,l,i)=>{try{const c={resource:"trackedEntityInstances",type:"create",data:{trackedEntityType:e,orgUnit:t,attributes:n,enrollments:[{orgUnit:t,program:a,enrollmentDate:k().format("YYYY-MM-DD"),incidentDate:k().format("YYYY-MM-DD")}]}};r(V((await i.mutate(c)).response.importSummaries[0].reference,a,l().app.ICUEventId,t,"Discharged")),r(w(t,a))}catch(c){r(N({message:"error in creating bed",type:"error"})),console.log("Error in creating:",c)}}}(d.trackedEntityType.id,u.id,d.id,e)),t()},primary:!0,type:"button"},a?"Update Bed":"Add New Bed"))))}function $(){return{show:(e,t,a)=>{confirm(e)?t():a()}}}const ee=[{type:"TEXT",label:"ICU - BHT Number",id:"j1hbO7zzRgV"},{type:"TEXT",label:"ICU - Patient Name",id:"sK09QRLNyAA"},{type:"TEXT",label:"ICU - Consultant In-charge",id:"malZQqUEzi9"},{type:"TEXT",label:"ICU - Patient Diagnosis",id:"qh9bc6jlauE"}];function te({open:e,onClose:t,selectedBed:a,actionType:c,editable:o}){const[d,u]=Object(r.useState)({}),m=Object(i.b)(),p=Object(i.c)(e=>e.app.metaData),E=Object(i.c)(e=>e.app.ICUEventId),y=Object(i.c)(e=>e.app.activeICU);$();Object(r.useEffect)(()=>{let e={};for(var t of ee)"TEXT"===t.type&&(!o&&a.lastEvent?e[t.id]=a.lastEvent.dataValues.find(e=>e.dataElement===t.id).value:e[t.id]="");u(e)},[a]);const b=(e,t)=>{if("TEXT"===e.type)return l.a.createElement(s.j,{key:t,label:e.label,name:e.id,onChange:t=>((e,t)=>{u(Object(n.a)({},d,{[e]:t}))})(e.id,t.value),value:d[e.id],disabled:!o})};return l.a.createElement(s.m,{open:!0},l.a.createElement(s.p,null,o&&l.a.createElement("span",null,"admit"===c?"Admit":"Reserve"," New Patient"),!o&&l.a.createElement("span",null,"View Patient")),l.a.createElement(s.o,null,ee.map((e,t)=>b(e,t))),l.a.createElement(s.n,null,l.a.createElement(s.c,{end:!0},l.a.createElement(s.b,{onClick:t,secondary:!0,type:"button"},"Close"),o&&l.a.createElement(s.b,{onClick:()=>{let e=[];for(var n in d)e.push({dataElement:n,value:d[n]});"admit"===c?m(V(a.trackedEntityInstance,p.id,E,y.id,"Admitted",e)):"reserve"===c&&m(V(a.trackedEntityInstance,p.id,E,y.id,"Reserved",e)),t()},primary:!0,type:"button"},"Admit Patient"))))}var ae=a(429);const ne={height:"600px",width:"100%"},re={lat:8.11,lng:80.77},le=Object(n.a)({visible:!1},re);function ie(e){const{onMarkerClick:t,data:a,origin:i,updateDistance:c}=e,[s,o]=Object(r.useState)(le),d=e=>{o(Object(n.a)({visible:!0},e))},u={icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#00802b",fillOpacity:1,strokeColor:"",strokeWeight:0}},m={icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#DC143C",fillOpacity:1,strokeColor:"",strokeWeight:0}};let p=null,E=null;return i&&(p=a.map(e=>e.geometry),E={origins:[{lat:i[1],lng:i[0]}],destinations:p,travelMode:"DRIVING"}),l.a.createElement(ae.d,{id:"script-loader",googleMapsApiKey:"AIzaSyBjlDmwuON9lJbPMDlh_LI3zGpGtpK9erc"},l.a.createElement(ae.b,{id:"example-map",mapContainerStyle:ne,zoom:7.6,center:re},a.map((e,a)=>l.a.createElement(ae.e,{position:{lat:e.geometry.lat,lng:e.geometry.lng},onClick:()=>{t(e)},onMouseOver:()=>{d(e)},onMouseOut:()=>{d(le)},options:e.available>0?u:m,key:a})),s.visible&&l.a.createElement(ae.c,{position:s,options:{closeBoxURL:""}},l.a.createElement("div",{style:{backgroundColor:"white",opacity:.95,padding:5}},l.a.createElement("div",{style:{fontSize:14,fontColor:"#08233B"}},l.a.createElement("div",null,"ICU: ",s.name),l.a.createElement("div",null,"Distance: ",s.distance),l.a.createElement("div",null,"Beds: ",s.available))))),i&&l.a.createElement(ae.a,{options:E,callback:(e,t)=>c(e,status)}))}function ce(e){const{isOpen:t,message:a,type:n}=Object(i.c)(e=>e.notification);return t?l.a.createElement(s.a,{duration:5e3,icon:!0,critical:"error"===n,warning:"warning"===n,success:"success"===n},a):null}function se(e,t){for(var a of e.attributes)if(a.displayName===t)return a.value;return""}function oe(){const e=Object(i.c)(e=>e.app.activeOrgUnit),t=Object(i.c)(e=>e.app.activeUser),a=Object(i.c)(e=>e.app.icuList),c=Object(i.c)(e=>e.app.metaData),o=Object(i.b)();let d=null,u=null;c&&(d=c.trackedEntityType.trackedEntityTypeAttributes.find(({id:e})=>"XYNBoDZS0aV"===e),u=c.trackedEntityType.trackedEntityTypeAttributes.find(({id:e})=>"Xt5tV6OFSEW"===e));const[E,y]=Object(r.useState)({XYNBoDZS0aV:[],Xt5tV6OFSEW:[]});if(Object(r.useEffect)(()=>{if(a)for(var e of a)null===e.total&&(o(L(e,E)),o(g({icuId:e.id,stat:{total:"Updating...",available:null}})))},[a]),Object(r.useEffect)(()=>{if(a)for(var e of a)o(L(e,E))},[E]),!e)return l.a.createElement("p",null,"Please select an organization unit");if(6===e.level)return l.a.createElement(de,null);return e.level<6&&l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"t20"},"Showing ICU Locations for ",l.a.createElement("b",null,e.name)),l.a.createElement("div",{className:"filter-area"},l.a.createElement(s.q,{selected:E.XYNBoDZS0aV,placeholder:d.displayName,onChange:({selected:e})=>{y(Object(n.a)({},E,{XYNBoDZS0aV:e}))}},d&&d.optionSet.options.map((e,t)=>l.a.createElement(s.r,{key:t,value:e.code,label:e.displayName}))),l.a.createElement(s.q,{selected:E.Xt5tV6OFSEW,placeholder:u.displayName,onChange:({selected:e})=>{y(Object(n.a)({},E,{Xt5tV6OFSEW:e}))}},u&&u.optionSet.options.map((e,t)=>l.a.createElement(s.r,{key:t,value:e.code,label:e.displayName})))),l.a.createElement("div",{className:"icu-org"},l.a.createElement("div",{className:"icu-table"},l.a.createElement(Y,{data:a,onSelectICU:e=>{o(m({id:e.id,name:e.name,level:e.level})),o(p({id:e.id,beds:[]}))}})),l.a.createElement("div",{className:"icu-map"},l.a.createElement(ie,{onMarkerClick:e=>{console.log(e)},data:a,origin:t.origin,updateDistance:(e,t)=>{if(e.rows&&e.rows.length>0&&e.rows[0].elements&&e.rows[0].elements.length===a.length)for(var n in a)"OK"===e.rows[0].elements[n].status&&o(h({icuId:a[n].id,distance:"".concat(e.rows[0].elements[n].distance.text," (").concat(e.rows[0].elements[n].duration.text,")")}))}}))))}function de(){const e=Object(i.c)(e=>e.app.activeUser),t=Object(i.c)(e=>e.app.activeOrgUnit),a=Object(i.c)(e=>e.app.activeICU),n=Object(i.c)(e=>e.app.metaData),c=Object(i.c)(e=>e.app.ICUEventId),[o,d]=Object(r.useState)(!1),[u,m]=Object(r.useState)(!1),[p,E]=Object(r.useState)(!1),[y,b]=Object(r.useState)("admit"),[v,g]=Object(r.useState)(null),[f,h]=Object(r.useState)(!1),[C,O]=Object(r.useState)(!0),I=Object(i.b)(),k=$();Object(r.useEffect)(()=>{n&&(I(w(a.id,n.id)),W(G,e,n.programAccess,n.trackedEntityType.access,a.id)&&h(!0))},[n,a.id]);return t?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"contact"},l.a.createElement("p",null,l.a.createElement("b",null,"Primary Contact")),l.a.createElement("p",null,"Dr. John Doe"),l.a.createElement("p",null,"+94771234568"),l.a.createElement("p",null,"+94717894562")),l.a.createElement("div",{className:"inner-header"},l.a.createElement("span",{className:"t20"},"Showing ICU Bed status at ",l.a.createElement("b",null,t.name)),W(x,e,n.programAccess,n.trackedEntityType.access,a.id)&&l.a.createElement(s.b,{onClick:()=>d(!0),className:"pull-right"},"Configure Beds")),a&&l.a.createElement(l.a.Fragment,null,o&&l.a.createElement(ue,{onBack:()=>d(!1)}),!o&&l.a.createElement("div",{className:"icu-bed-container"},!a.beds.length&&l.a.createElement("p",null,"No beds currently added"),a.beds.map((t,r)=>l.a.createElement(F,{key:r,name:se(t,"ICU - Bed Number"),status:t.status?t.status:"IDLE",onView:()=>(e=>{g(e),m(!0)})(t),onOccupy:()=>(e=>{g(e),O(!0),b("admit"),E(!0)})(t),onDischarge:()=>(e=>{k.show("Do you want to confirm discharging this bed?",()=>I(V(e.trackedEntityInstance,n.id,c,a.id,"Discharged")),()=>{})})(t),onReserve:()=>(e=>{g(e),O(!0),b("reserve"),E(!0)})(t),onViewPatient:()=>(e=>{g(e),O(!1),E(!0)})(t),hasEventPerm:f,hasEditPerm:W(x,e,n.programAccess,n.trackedEntityType.access,a.id)})))),u&&l.a.createElement(H,{open:u,onClose:()=>m(!1),selectedBed:v,editable:!1}),p&&l.a.createElement(te,{open:p,onClose:()=>E(!1),selectedBed:v,actionType:y,editable:C})):l.a.createElement("p",null,"Please select an organization unit")}function ue({onBack:e}){const[t,a]=Object(r.useState)(!1),n=Object(i.b)(),c=Object(i.c)(e=>e.app.activeICU),[o,d]=(Object(i.c)(e=>e.app.metaData),Object(r.useState)(null)),u=$(),m=e=>{u.show("Do you really want to remove this bed?",()=>{var t,a;n((t=c.id,a=e.enrollments[0].enrollment,async(e,n,r)=>{try{const l={resource:"enrollments/"+a,type:"delete"};await r.mutate(l),e(w(t,n().app.metaData.id))}catch(l){e(N({message:"error in deleting bed",type:"error"})),console.log("Error in creating:",l)}}))},()=>{})};return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"inner-header"},l.a.createElement(s.c,{end:!0},l.a.createElement(s.b,{onClick:e},"Back"),l.a.createElement(s.b,{primary:!0,onClick:()=>{d(null),a(!0)}},"Add New Bed"))),l.a.createElement("div",{className:"inner-container"},l.a.createElement(s.x,null,l.a.createElement(s.B,null,l.a.createElement(s.C,null,l.a.createElement(s.A,null,"Bed No"),l.a.createElement(s.A,null,"Bed Type"),l.a.createElement(s.A,null,"Covid Type"),l.a.createElement(s.A,null,"Action"))),c&&l.a.createElement(s.y,null,c.beds.map((e,t)=>l.a.createElement(s.C,{key:t},l.a.createElement(s.z,null,se(e,"ICU - Bed Number")),l.a.createElement(s.z,null,se(e,"ICU - Type")),l.a.createElement(s.z,null,se(e,"ICU - COVID Type")),l.a.createElement(s.z,null,l.a.createElement(s.c,null,l.a.createElement(s.b,{onClick:()=>(e=>{d(e),a(!0)})(e)},"View Details"),l.a.createElement(s.b,{destructive:!0,onClick:()=>m(e)},"Remove")))))))),t&&l.a.createElement(H,{open:t,onClose:()=>a(!1),selectedBed:o,editable:!0}))}function me({children:e}){const t=Object(i.b)();return Object(r.useEffect)(()=>{t(async(e,t,a)=>{try{const t={program:{resource:"programs/C1wTfmmMQUn",params:{fields:"id,name,userGroupAccesses,trackedEntityType[id, displayName, userGroupAccesses, trackedEntityTypeAttributes[trackedEntityAttribute[id, displayName, formName, valueType, optionSet[options[displayName, id, code]]]]]"}},dataElements:{resource:"dataElements",params:{paging:"false",program:"C1wTfmmMQUn",fields:"id,displayName,optionSet[options[id, displayName,code]]"}}},{program:i,dataElements:c}=await a.query(t);let s={id:i.id,name:i.name,trackedEntityType:{id:i.trackedEntityType.id,displayName:i.trackedEntityType.displayName,trackedEntityTypeAttributes:[]}},o={};for(var n of i.userGroupAccesses)o[n.userGroupUid]={canRead:n.access.startsWith("rw"),canWrite:n.access.startsWith("rwrw")};for(var r of(s.programAccess=o,i.trackedEntityType.trackedEntityTypeAttributes))s.trackedEntityType.trackedEntityTypeAttributes.push(r.trackedEntityAttribute);let d={};for(var n of i.trackedEntityType.userGroupAccesses)d[n.userGroupUid]={canRead:n.access.startsWith("rw"),canWrite:n.access.startsWith("rwrw")};s.trackedEntityType.access=d;let u={};for(var l of c.dataElements)if(l.displayName.startsWith("ICU")){let e={id:l.id,displayName:l.displayName};l.optionSet&&(e.options=l.optionSet.options),u[l.displayName]=e}s.dataElements=u,e(E(s))}catch(i){e(N({message:"failed to load metadata",type:"error"})),console.log("Error in query:",i)}}),t(async(e,t,a)=>{try{const t={user:{resource:"me",params:{fields:"id,displayName,userGroups,organisationUnits[id, geometry]"}}},{user:n}=await a.query(t);e(f({id:n.id,name:n.displayName,group:n.userGroups.length>0?n.userGroups[0].id:null,organisationUnits:n.organisationUnits.map(e=>e.id),origin:n.organisationUnits.length>0&&n.organisationUnits[0].geometry?n.organisationUnits[0].geometry.coordinates:null}))}catch(n){e(N({message:"Error loading user",type:"error"})),console.log("Error in query:",n)}})},[]),l.a.createElement("div",{style:{height:"100vh"}},e)}t.default=function(){const e=Object(c.b)(),t=Object(d.c)({thunk:{extraArgument:e}}),a=Object(d.a)({reducer:M,middleware:t});return l.a.createElement(i.a,{store:a},l.a.createElement(me,null,l.a.createElement("div",{className:"container"},l.a.createElement("div",{className:"left-column"},l.a.createElement(I,null)),l.a.createElement("div",{className:"right-column"},l.a.createElement(oe,null))),l.a.createElement("div",{style:{bottom:0,left:0,paddingLeft:16,position:"fixed",width:"60%"}},l.a.createElement(ce,null))))}}}]);
//# sourceMappingURL=app.f2748bc2.chunk.js.map