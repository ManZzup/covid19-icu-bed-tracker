{"version":3,"sources":["D2App/state/appState.js","D2App/components/OrgUnits.js","D2App/state/notificationState.js","D2App/state/apiActions.js","D2App/components/ICUTable.js","D2App/state/store.js","D2App/components/permissionUtils.js","D2App/components/ICUBed.js","D2App/components/ConfigureBedModal.js","D2App/components/useConfirmationHook.js","D2App/components/RegisterPatientModal.js","D2App/components/ICUMap.js","D2App/components/Notification.js","D2App/App.js"],"names":["appSlice","createSlice","name","initialState","activeUser","activeOrgUnit","activeICU","metaData","icuList","ICUEventId","reducers","setActiveOrgUnit","state","action","payload","setActiveICU","setActiveUser","setMetaData","setICUBeds","id","icuId","beds","updateBedStatus","bedIndex","findIndex","b","trackedEntityInstance","bedId","status","lastEvent","updateFilteredICUList","updateICUStat","icuIndex","i","available","stat","total","icuName","updateICUDistance","distance","actions","query","organisationUnits","resource","params","paging","fields","OrgUnits","loading","error","data","refetch","useDataQuery","orgRoot","setOrgRoot","useState","cursor","setCursor","dispatch","useDispatch","traverseResults","useEffect","orgData","root","filter","o","level","children","processList","_children","child","childOrg","length","push","active","_prunedChildren","traverse","mergeLevel","node","newChildren","child1","child2","selectOU","icus","icu","geometry","lat","coordinates","lng","onToggle","toggled","Object","assign","notificationSlice","isOpen","message","type","showNotification","hideNotification","ICU_EVENT","bedEventHelper","eventType","dataValue","dataElement","value","getEventStatus","event","dataValues","getICUBeds","program","async","getState","dhisEngine","results","ou","trackedEntityInstances","bed","getBedStatus","console","log","instanceId","events","bedEventIndex","dv","app","dataElements","addBedEvent","teId","programId","programStageId","additionalData","eventResponse","updateMutation","moment","format","mutate","mutation","getICUStat","filters","filtersQuery","values","map","f","join","substr","orgUnit","filteredTEI","organisationUnit","response","te","parent","displayName","sortData","field","setLocationData","sortedBy","setSortedBy","sortOrder","setSortOrder","result","slice","sort","locOne","locTwo","propertyOne","propertyTwo","comparison","ICUTable","onSelectICU","locationData","stateData","primary","onClick","loc","key","href","rootReducer","combineReducers","appReducer","notification","notificationReducer","configureStore","reducer","ACTIONS","hasPerm","programAccess","teAccess","group","canRead","indexOf","canWrite","ICUBed","onView","onOccupy","onDischarge","onReserve","hasEventPerm","onViewPatient","hasEditPerm","ref","useRef","open","setOpen","className","createPortal","transparent","placement","reference","document","body","booleanSelections","label","experiseAttrbutes","facilitiesAttributes","infoAttributes","findAttribute","attributes","search","a","attribute","findOption","optionSet","code","ConfigureBedModal","onClose","selectedBed","editable","useSelector","bedAttributes","setBedAttributtes","formState","setFormState","useDataEngine","_bedAttributes","trackedEntityType","trackedEntityTypeAttributes","_formState","attrib","bedValue","valueType","options","option","updateField","getAttributeInput","attribId","find","formName","onChange","val","selected","disabled","sel","end","secondary","updateBed","teID","importSummaries","createBed","useConfirmation","show","onOk","onCancel","confirm","patientFieldset","RegisterPatientModal","actionType","programStage","getFormField","mapContainerStyle","height","width","center","infoWindowInitData","visible","ICUMap","props","onMarkerClick","origin","updateDistance","infoWindowData","setInfoWindowData","handleMarkerOnHover","ICUEntry","markerAvailableOptions","icon","path","fillColor","fillOpacity","strokeColor","strokeWeight","markerUnavailableOptions","destinations","distanceRequest","d","origins","travelMode","googleMapsApiKey","zoom","index","position","onMouseOver","onMouseOut","closeBoxURL","style","backgroundColor","opacity","padding","fontSize","fontColor","callback","s","Notification","duration","critical","warning","success","getAttributeByName","ViewOrgICU","bedData","bedTypeData","covidTypeData","setFilters","ViewICUBeds","placeholder","rows","elements","ind","text","showConfigure","setShowConfigure","bedModalOpen","setBedModalOpen","patientModalOpen","setPatientModalOpen","patientModalAction","setPatientModalAction","setSelectedBed","eventPerm","setEventPerm","patientEditable","setPatientEditable","confirmation","access","ViewConfigureBeds","onBack","onViewBed","onOccupyBed","onDischargeBed","onReserveBed","onRemoveBed","enrollmentId","enrollments","enrollment","onSelectBed","destructive","ContainerView","ga","userGroupAccesses","userGroupUid","startsWith","trackedEntityAttribute","_dataElements","de","elem","user","userGroups","MyApp","customizedMiddleware","getDefaultMiddleware","thunk","extraArgument","store","middleware","bottom","left","paddingLeft"],"mappings":"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","file":"static/js/app.f2748bc2.chunk.js","sourcesContent":["import { createSlice } from '@reduxjs/toolkit';\nconst initState = {\n  activeUser: null,\n  activeOrgUnit: null,\n  activeICU: null,\n  metaData: null,\n  icuList: [],\n  ICUEventId: \"fKXrko0yhua\"\n};\nconst appSlice = createSlice({\n  name: \"app\",\n  initialState: initState,\n  reducers: {\n    setActiveOrgUnit(state, action) {\n      state.activeOrgUnit = action.payload;\n    },\n\n    setActiveICU(state, action) {\n      state.activeICU = action.payload;\n    },\n\n    setActiveUser(state, action) {\n      state.activeUser = action.payload;\n    },\n\n    setMetaData(state, action) {\n      state.metaData = action.payload;\n    },\n\n    setICUBeds(state, action) {\n      if (state.activeICU && state.activeICU.id === action.payload.icuId) {\n        state.activeICU.beds = action.payload.beds;\n      }\n    },\n\n    updateBedStatus(state, action) {\n      const bedIndex = state.activeICU.beds.findIndex(b => b.trackedEntityInstance === action.payload.bedId);\n      state.activeICU.beds[bedIndex].status = action.payload.status;\n      state.activeICU.beds[bedIndex].lastEvent = action.payload.lastEvent;\n    },\n\n    updateFilteredICUList(state, action) {\n      state.icuList = action.payload;\n    },\n\n    updateICUStat(state, action) {\n      const icuIndex = state.icuList.findIndex(i => i.id === action.payload.icuId);\n      state.icuList[icuIndex].available = action.payload.stat.available;\n      state.icuList[icuIndex].total = action.payload.stat.total;\n      state.icuList[icuIndex].name = action.payload.icuName;\n    },\n\n    updateICUDistance(state, action) {\n      const icuIndex = state.icuList.findIndex(i => i.id === action.payload.icuId);\n      state.icuList[icuIndex].distance = action.payload.distance;\n    }\n\n  }\n});\nexport const {\n  setActiveOrgUnit,\n  setActiveICU,\n  setMetaData,\n  setICUBeds,\n  updateBedStatus,\n  updateFilteredICUList,\n  updateICUStat,\n  setActiveUser,\n  updateICUDistance\n} = appSlice.actions;\nexport default appSlice.reducer;","import React, { useEffect, useState } from 'react';\nimport { Card } from '@dhis2/ui-core';\nimport { useDispatch } from 'react-redux';\nimport { DataQuery, useDataQuery } from '@dhis2/app-runtime';\nimport { Treebeard } from 'react-treebeard';\nimport { setActiveOrgUnit, updateFilteredICUList, setActiveICU } from '../state/appState';\nconst query = {\n  organisationUnits: {\n    resource: 'organisationUnits.json',\n    params: {\n      paging: 'false',\n      fields: \"id,name,level,children,geometry\"\n    }\n  }\n};\nexport default function OrgUnits() {\n  const {\n    loading,\n    error,\n    data,\n    refetch\n  } = useDataQuery(query);\n  const [orgRoot, setOrgRoot] = useState(null);\n  const [cursor, setCursor] = useState(false);\n  const dispatch = useDispatch();\n  var traverseResults = [];\n\n  function processList(orgData, children) {\n    let _children = [];\n\n    for (var child of children) {\n      let childOrg = orgData.filter(o => o.id === child.id);\n\n      if (childOrg.length === 1) {\n        childOrg = childOrg[0];\n\n        if (childOrg.children.length === 0) {\n          childOrg.children = null;\n        } else {\n          childOrg.children = processList(orgData, childOrg.children);\n        }\n\n        _children.push({ ...childOrg,\n          active: false\n        });\n      }\n    }\n\n    let _prunedChildren = [];\n\n    for (var child of _children) {\n      traverseResults = [];\n      traverse(child, 6);\n\n      if (traverseResults.length > 0) {\n        _prunedChildren.push(child);\n      }\n    }\n\n    return _prunedChildren;\n  }\n\n  function mergeLevel(node, level = 4) {\n    if (node.level === level - 1) {\n      // at level 3\n      let newChildren = [];\n\n      for (var child1 of node.children) {\n        if (!child1.children) continue;\n\n        for (var child2 of child1.children) {\n          newChildren.push(child2);\n        }\n      }\n\n      node.children = newChildren;\n      return;\n    }\n\n    for (var child of node.children) {\n      mergeLevel(child, level);\n    }\n  }\n\n  useEffect(() => {\n    if (data) {\n      const orgData = data.organisationUnits.organisationUnits;\n      const root = data.organisationUnits.organisationUnits.filter(o => o.level === 1)[0];\n      root.children = processList(orgData, root.children);\n      mergeLevel(root, 4);\n      setOrgRoot(root);\n    }\n  }, [loading]);\n\n  const onToggle = (node, toggled) => {\n    if (cursor) {\n      cursor.active = false;\n    }\n\n    node.active = true;\n\n    if (node.children) {\n      node.toggled = toggled;\n    }\n\n    setCursor(node);\n    setOrgRoot(Object.assign({}, orgRoot));\n    selectOU(node);\n  };\n\n  function traverse(root, level) {\n    if (root.level === level) {\n      traverseResults.push({ ...root\n      });\n      return;\n    }\n\n    if (root.children) {\n      for (var child of root.children) {\n        traverse(child, level);\n      }\n    }\n  }\n\n  const selectOU = node => {\n    traverseResults = []; // traverse the tree and find level 6 bois\n\n    traverse(node, 6);\n    let icus = [];\n\n    for (var icu of traverseResults) {\n      icus.push({ ...icu,\n        distance: 0,\n        total: null,\n        available: null,\n        geometry: icu.geometry ? {\n          lat: icu.geometry.coordinates[1],\n          lng: icu.geometry.coordinates[0]\n        } : {\n          lat: 0,\n          lng: 0\n        }\n      });\n    }\n\n    dispatch(updateFilteredICUList(icus));\n    dispatch(setActiveOrgUnit({\n      id: node.id,\n      name: node.name,\n      level: node.level\n    }));\n\n    if (node.level === 6) {\n      dispatch(setActiveICU({\n        id: node.id,\n        beds: []\n      }));\n    }\n  };\n\n  return <Card>\n            {orgRoot && <Treebeard data={orgRoot} onToggle={onToggle} />}\n        </Card>;\n}","import { createSlice } from '@reduxjs/toolkit';\nconst initState = {\n  isOpen: false,\n  message: null,\n  type: null\n};\nconst notificationSlice = createSlice({\n  name: \"notification\",\n  initialState: initState,\n  reducers: {\n    showNotification(state, action) {\n      state.isOpen = true;\n      state.message = action.payload.message;\n      state.type = action.payload.type;\n    },\n\n    hideNotification(state, action) {\n      state, isOpen = false;\n      state.message = null;\n      state.type = null;\n    }\n\n  }\n});\nexport default notificationSlice.reducer;\nexport const {\n  showNotification,\n  hideNotification\n} = notificationSlice.actions;","import { setICUBeds, setMetaData, updateBedStatus, updateICUStat, setActiveUser } from './appState';\nimport * as moment from 'moment';\nimport { showNotification } from './notificationState';\nconst ICU_EVENT = \"ICU - Bed Event\";\nexport function test() {\n  return async (dispatch, getState, dhisEngine) => {\n    console.log(dhisEngine);\n  };\n}\n\nfunction bedEventHelper(metaData, eventType) {\n  let dataValue = {};\n\n  if (eventType === \"Discharged\") {\n    dataValue = {\n      dataElement: metaData[ICU_EVENT].id,\n      value: \"Discharged\"\n    };\n  } else if (eventType === \"Admitted\") {\n    dataValue = {\n      dataElement: metaData[ICU_EVENT].id,\n      value: \"Admitted\"\n    };\n  } else if (eventType === \"Reserved\") {\n    dataValue = {\n      dataElement: metaData[ICU_EVENT].id,\n      value: \"Reserved\"\n    };\n  }\n\n  return dataValue;\n}\n\nfunction getEventStatus(event) {\n  if (event.dataValues.length > 0) {\n    switch (event.dataValues[0].value) {\n      case \"Discharged\":\n        return \"AVAILABLE\";\n\n      case \"Admitted\":\n        return \"OCCUPIED\";\n\n      case \"Reserved\":\n        return \"RESERVED\";\n    }\n  }\n\n  return \"\";\n}\n\nexport function getActiveUser() {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        user: {\n          resource: 'me',\n          params: {\n            fields: \"id,displayName,userGroups,organisationUnits[id, geometry]\"\n          }\n        }\n      };\n      const {\n        user\n      } = await dhisEngine.query(query);\n      dispatch(setActiveUser({\n        id: user.id,\n        name: user.displayName,\n        group: user.userGroups.length > 0 ? user.userGroups[0].id : null,\n        organisationUnits: user.organisationUnits.map(ou => ou.id),\n        origin: user.organisationUnits.length > 0 && user.organisationUnits[0].geometry ? user.organisationUnits[0].geometry.coordinates : null\n      }));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'Error loading user',\n        type: 'error'\n      }));\n      console.log(\"Error in query:\", error);\n    }\n  };\n}\nexport function getMetaData() {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        program: {\n          resource: 'programs/C1wTfmmMQUn',\n          params: {\n            fields: \"id,name,userGroupAccesses,trackedEntityType[id, displayName, userGroupAccesses, trackedEntityTypeAttributes[trackedEntityAttribute[id, displayName, formName, valueType, optionSet[options[displayName, id, code]]]]]\"\n          }\n        },\n        dataElements: {\n          resource: 'dataElements',\n          params: {\n            paging: \"false\",\n            program: \"C1wTfmmMQUn\",\n            fields: \"id,displayName,optionSet[options[id, displayName,code]]\"\n          }\n        }\n      };\n      const {\n        program,\n        dataElements\n      } = await dhisEngine.query(query);\n      let metaData = {\n        id: program.id,\n        name: program.name,\n        trackedEntityType: {\n          id: program.trackedEntityType.id,\n          displayName: program.trackedEntityType.displayName,\n          trackedEntityTypeAttributes: []\n        }\n      };\n      let programAccess = {};\n\n      for (var ga of program.userGroupAccesses) {\n        programAccess[ga.userGroupUid] = {\n          canRead: ga.access.startsWith(\"rw\"),\n          canWrite: ga.access.startsWith(\"rwrw\")\n        };\n      }\n\n      metaData['programAccess'] = programAccess;\n\n      for (var attrib of program.trackedEntityType.trackedEntityTypeAttributes) {\n        metaData.trackedEntityType.trackedEntityTypeAttributes.push(attrib.trackedEntityAttribute);\n      }\n\n      let teAccess = {};\n\n      for (var ga of program.trackedEntityType.userGroupAccesses) {\n        teAccess[ga.userGroupUid] = {\n          canRead: ga.access.startsWith(\"rw\"),\n          canWrite: ga.access.startsWith(\"rwrw\")\n        };\n      }\n\n      metaData.trackedEntityType['access'] = teAccess;\n      let _dataElements = {};\n\n      for (var de of dataElements.dataElements) {\n        if (de.displayName.startsWith(\"ICU\")) {\n          let elem = {\n            id: de.id,\n            displayName: de.displayName\n          };\n\n          if (de.optionSet) {\n            elem[\"options\"] = de.optionSet.options;\n          }\n\n          _dataElements[de.displayName] = elem;\n        }\n      }\n\n      metaData[\"dataElements\"] = _dataElements;\n      dispatch(setMetaData(metaData));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'failed to load metadata',\n        type: 'error'\n      }));\n      console.log(\"Error in query:\", error);\n    }\n  };\n}\nexport function getICUBeds(icuId, program) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const query = {\n        results: {\n          resource: 'trackedEntityInstances',\n          params: {\n            ou: icuId,\n            fields: \"trackedEntityInstance,attributes[attribute,displayName,value],enrollments\",\n            program: program\n          }\n        }\n      };\n      const response = await dhisEngine.query(query);\n      const beds = response.results.trackedEntityInstances; // now get status of each\n\n      for (var bed of beds) {\n        dispatch(getBedStatus(bed.trackedEntityInstance));\n      }\n\n      dispatch(setICUBeds({\n        icuId,\n        beds\n      }));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'failed to load icu bed data',\n        type: 'error'\n      }));\n      console.log(\"Error in query:\", error);\n    }\n  };\n}\nexport function getBedStatus(instanceId) {\n  return async (dispatch, getState, dhisEngine) => {\n    const query = {\n      events: {\n        resource: 'events',\n        params: {\n          trackedEntityInstance: instanceId,\n          paging: \"false\",\n          status: \"ACTIVE\"\n        }\n      }\n    };\n    const response = await dhisEngine.query(query);\n    const events = response.events.events;\n    let status = \"\";\n\n    if (events.length > 0) {\n      const lastEvent = events[0];\n      const bedEventIndex = lastEvent.dataValues.findIndex(dv => dv.dataElement === getState().app.metaData.dataElements[ICU_EVENT].id);\n\n      if (bedEventIndex > -1) {\n        switch (lastEvent.dataValues[bedEventIndex].value) {\n          case \"Discharged\":\n            status = \"AVAILABLE\";\n            break;\n\n          case \"Admitted\":\n            status = \"OCCUPIED\";\n            break;\n\n          case \"Reserved\":\n            status = \"RESERVED\";\n            break;\n        }\n      }\n\n      dispatch(updateBedStatus({\n        bedId: instanceId,\n        status: status,\n        lastEvent: lastEvent\n      }));\n    }\n  };\n}\nexport function createBed(teID, icuId, programId, attributes) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {\n        \"trackedEntityType\": teID,\n        \"orgUnit\": icuId,\n        \"attributes\": attributes,\n        \"enrollments\": [{\n          \"orgUnit\": icuId,\n          \"program\": programId,\n          \"enrollmentDate\": moment().format(\"YYYY-MM-DD\"),\n          \"incidentDate\": moment().format(\"YYYY-MM-DD\")\n        }]\n      };\n      const mutation = {\n        resource: 'trackedEntityInstances',\n        type: 'create',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      const instanceId = response.response.importSummaries[0].reference; // add new event to make the bed available\n\n      dispatch(addBedEvent(instanceId, programId, getState().app.ICUEventId, icuId, \"Discharged\"));\n      dispatch(getICUBeds(icuId, programId));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in creating bed',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function updateBed(icuId, bedId, attributes) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {\n        \"orgUnit\": icuId,\n        \"attributes\": attributes\n      };\n      const mutation = {\n        resource: 'trackedEntityInstances/' + bedId,\n        type: 'update',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getICUBeds(icuId, getState().app.metaData.id));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in updating bed',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function removeBed(icuId, enrollmentId) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      const payload = {};\n      const mutation = {\n        resource: 'enrollments/' + enrollmentId,\n        type: 'delete'\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getICUBeds(icuId, getState().app.metaData.id));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in deleting bed',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function addBedEvent(teId, programId, programStageId, icuId, eventType, additionalData = []) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      // first we complete last event\n      const query = {\n        events: {\n          resource: 'events',\n          params: {\n            trackedEntityInstance: teId,\n            paging: \"false\",\n            status: \"ACTIVE\"\n          }\n        }\n      };\n      const eventResponse = await dhisEngine.query(query);\n\n      if (eventResponse.events.events.length > 0) {\n        const lastEvent = eventResponse.events.events[0];\n        const updatePayload = {\n          \"event\": lastEvent.event,\n          \"trackedEntityInstance\": teId,\n          \"program\": programId,\n          \"programStage\": programStageId,\n          \"enrollment\": icuId,\n          \"orgUnit\": icuId,\n          \"completedDate\": moment().format(\"YYYY-MM-DD\"),\n          \"status\": \"COMPLETED\"\n        };\n        const updateMutation = {\n          resource: 'events',\n          type: 'create',\n          data: updatePayload\n        };\n        await dhisEngine.mutate(updateMutation);\n      }\n\n      const dataValues = [bedEventHelper(getState().app.metaData.dataElements, eventType), ...additionalData];\n      const payload = {\n        \"trackedEntityInstance\": teId,\n        \"program\": programId,\n        \"programStage\": programStageId,\n        \"enrollment\": icuId,\n        \"orgUnit\": icuId,\n        \"dataValues\": dataValues,\n        \"eventDate\": moment().format(\"YYYY-MM-DD\"),\n        \"status\": \"ACTIVE\"\n      };\n      const mutation = {\n        resource: 'events',\n        type: 'create',\n        data: payload\n      };\n      const response = await dhisEngine.mutate(mutation);\n      dispatch(getBedStatus(teId));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in adding bed event',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}\nexport function getICUStat(icu, filters = {}) {\n  return async (dispatch, getState, dhisEngine) => {\n    try {\n      let filtersQuery = \"\";\n\n      for (var filter in filters) {\n        if (filters[filter].length === 0) {\n          continue;\n        }\n\n        const values = filters[filter].map(f => f.value);\n        filtersQuery += `${filter}:IN:${values.join(\";\")},`;\n      }\n\n      filtersQuery = filtersQuery.substr(0, filtersQuery.length - 1); // first we complete last event\n\n      const query = {\n        events: {\n          resource: 'events',\n          params: {\n            orgUnit: icu.id,\n            paging: \"false\",\n            status: \"ACTIVE\"\n          }\n        },\n        filteredTEI: {\n          resource: 'trackedEntityInstances',\n          params: {\n            ou: icu.id,\n            paging: 'false',\n            fields: 'trackedEntityInstance',\n            filter: filtersQuery\n          }\n        },\n        organisationUnit: {\n          resource: 'organisationUnits/' + icu.id,\n          params: {\n            fields: 'id,displayName,parent[displayName]'\n          }\n        }\n      };\n      const response = await dhisEngine.query(query);\n      let stat = {\n        available: 0,\n        total: 0\n      };\n\n      for (var event of response.events.events) {\n        let teIndex = response.filteredTEI.trackedEntityInstances.findIndex(te => te.trackedEntityInstance === event.trackedEntityInstance);\n\n        if (teIndex === -1) {\n          // filtered TE doesn't have this\n          continue;\n        }\n\n        let status = getEventStatus(event);\n\n        if (status === \"AVAILABLE\") {\n          stat.available++;\n        }\n\n        stat.total++;\n      }\n\n      dispatch(updateICUStat({\n        icuId: icu.id,\n        stat: stat,\n        icuName: `${response.organisationUnit.parent.displayName} - ${response.organisationUnit.displayName}`\n      }));\n    } catch (error) {\n      dispatch(showNotification({\n        message: 'error in retrieving ICU status',\n        type: 'error'\n      }));\n      console.log(\"Error in creating:\", error);\n    }\n  };\n}","import React, { useEffect, useState } from 'react';\nimport { Table, TableHead, TableBody, TableRow, TableCellHead, TableCell, Button, DropdownButton } from '@dhis2/ui-core';\nimport { useDispatch } from 'react-redux';\nimport { getICUStat } from '../state/apiActions';\n\nfunction sortData(field, data, state) {\n  const {\n    setLocationData,\n    sortedBy,\n    setSortedBy,\n    sortOrder,\n    setSortOrder\n  } = state;\n\n  const compare = (locOne, locTwo) => {\n    let propertyOne = locOne[field];\n    let propertyTwo = locTwo[field];\n    let comparison = 0;\n\n    if (propertyOne > propertyTwo) {\n      comparison = 1;\n    } else if (propertyOne < propertyTwo) {\n      comparison = -1;\n    }\n\n    if (sortedBy === field) {\n      comparison = comparison * -1 * sortOrder; //inverts the order\n    }\n\n    return comparison;\n  };\n\n  let result = data.slice();\n  result = result.sort(compare);\n  setLocationData(result);\n  setSortedBy(field);\n  setSortOrder(sortOrder * -1);\n}\n\nexport default function ICUTable({\n  data,\n  onSelectICU\n}) {\n  const [locationData, setLocationData] = useState([]);\n  const [sortedBy, setSortedBy] = useState('distance');\n  const [sortOrder, setSortOrder] = useState(1);\n  const dispatch = useDispatch();\n  const stateData = {\n    setLocationData,\n    sortedBy,\n    setSortedBy,\n    sortOrder,\n    setSortOrder\n  };\n  useEffect(() => {\n    sortData(sortedBy, data, stateData);\n  }, [data]);\n\n  if (!data) {\n    return <div></div>;\n  }\n\n  return <Table>\n            <TableHead>\n                <TableRow>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'name'} onClick={() => {\n            sortData('name', locationData, stateData);\n          }}> \n                            ICU\n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'distance'} onClick={() => {\n            sortData('distance', locationData, stateData);\n          }}> \n                            Distance \n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'total'} onClick={() => {\n            sortData('total', locationData, stateData);\n          }}> \n                            TotalBeds \n                        </DropdownButton> \n                    </TableCellHead>\n                    <TableCellHead>  \n                        <DropdownButton primary={sortedBy === 'available'} onClick={() => {\n            sortData('available', locationData, stateData);\n          }}> \n                            AvailableBeds \n                        </DropdownButton> \n                    </TableCellHead>\n                </TableRow>\n            </TableHead>\n            <TableBody>\n                {locationData.map((loc, key) => <TableRow key={key}>\n                    <TableCell><a href=\"#\" onClick={() => onSelectICU(loc)}>{loc.name}</a></TableCell>\n                    <TableCell>{loc.distance}</TableCell>\n                    <TableCell>{loc.total}</TableCell>\n                    <TableCell>{loc.available}</TableCell>\n                </TableRow>)}\n            </TableBody>\n        </Table>;\n}","import { configureStore, combineReducers, getDefaultMiddleware } from \"@reduxjs/toolkit\";\nimport appReducer from './appState';\nimport notificationReducer from './notificationState';\nexport const rootReducer = combineReducers({\n  app: appReducer,\n  notification: notificationReducer\n});\nexport const store = configureStore({\n  reducer: rootReducer\n});","export const ACTIONS = {\n  VIEW_ICU: \"VIEW_ICU\",\n  CONFIG_ICU: \"CONFIG_ICU\",\n  ADD_EVENT: \"ADD_EVENT\"\n};\nexport function hasPerm(action, activeUser, programAccess, teAccess, icuId) {\n  if (activeUser.group === \"LkEkMDG0zfj\") {\n    //super user\n    return true;\n  }\n\n  if (action === ACTIONS.VIEW_ICU) {\n    if (teAccess[activeUser.group] && teAccess[activeUser.group].canRead) {\n      return true;\n    }\n  }\n\n  if (action === ACTIONS.CONFIG_ICU && activeUser.organisationUnits.indexOf(icuId) > -1) {\n    if (teAccess[activeUser.group] && teAccess[activeUser.group].canWrite) {\n      return true;\n    }\n  }\n\n  if (action === ACTIONS.ADD_EVENT) {\n    if (programAccess[activeUser.group] && programAccess[activeUser.group].canWrite && activeUser.organisationUnits.indexOf(icuId) > -1) {\n      return true;\n    }\n  }\n\n  return false;\n}","import React, { useEffect, useState, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { Popper, ScreenCover } from '@dhis2/ui-core';\nimport { hasPerm, ACTIONS } from './permissionUtils';\nexport default function ICUBed({\n  name,\n  status,\n  onView,\n  onOccupy,\n  onDischarge,\n  onReserve,\n  hasEventPerm,\n  onViewPatient,\n  hasEditPerm\n}) {\n  const ref = useRef(null);\n  const [open, setOpen] = useState(false);\n\n  const getClassName = () => {\n    if (status === \"AVAILABLE\") {\n      return \"available\";\n    }\n\n    if (status === \"OCCUPIED\") {\n      return \"occupied\";\n    }\n\n    if (status === \"RESERVED\") {\n      return \"reserved\";\n    }\n\n    return \"\";\n  };\n\n  const onToggle = () => {\n    if (hasEventPerm) {\n      setOpen(!open);\n    }\n  };\n\n  return <div className={`icu-bed ${getClassName()}`} ref={ref} onClick={onToggle}>\n            <span>{name}</span>\n            {open && createPortal(<ScreenCover onClick={onToggle} transparent>\n                        <Popper placement=\"right\" reference={ref}>\n                            <div className=\"bed-options\">\n                                {(status === \"AVAILABLE\" || status === \"RESERVED\") && <div onClick={() => {\n            setOpen(false);\n            onOccupy();\n          }}>Occupy</div>}\n                                {status === \"AVAILABLE\" && <div onClick={() => {\n            setOpen(false);\n            onReserve();\n          }}>Reserve</div>}\n                                {status !== \"AVAILABLE\" && <div onClick={() => {\n            setOpen(false);\n            onDischarge();\n          }}>Discharge</div>}\n                                <div onClick={onView}>View</div>\n                                {hasEditPerm && (status === \"OCCUPIED\" || status === \"RESERVED\") && <div onClick={onViewPatient}>View Patient</div>}\n                            </div>\n                        </Popper>\n                    </ScreenCover>, document.body)}\n        </div>;\n}","import React, { useState, useEffect } from 'react';\nimport { Modal, ModalTitle, ModalActions, ModalContent, ButtonStrip, Button, InputField, SingleSelect, RadioGroup, Radio, RadioGroupField, SingleSelectOption, SingleSelectField } from '@dhis2/ui-core';\nimport { useSelector, useDispatch } from 'react-redux';\nimport * as moment from 'moment';\nimport { useDataMutation, useDataEngine } from '@dhis2/app-runtime';\nimport { test, createBed, updateBed } from '../state/apiActions';\nconst booleanSelections = [{\n  label: \"No\",\n  value: 'false'\n}, {\n  label: \"Yes\",\n  value: 'true'\n}];\nconst experiseAttrbutes = [\"v5eNzdQsLox\", \"eBlbs7BzVfX\", \"JJ2DQSnlhfR\", \"m64bCKnUD8L\", \"Xar8cTc8XN0\", \"k7eXIuzzhat\", \"JZXI1GzSoYx\"];\nconst facilitiesAttributes = [\"Jio5MTDVFo4\", \"yvOZEiBS5cd\", \"CGp0lKLkSKY\", \"YCILPvLTofG\"];\nconst infoAttributes = [\"tswabivShTy\", \"Xt5tV6OFSEW\", \"XYNBoDZS0aV\"];\n\nfunction findAttribute(attributes, id) {\n  const search = attributes.filter(a => a.attribute === id);\n  return search.length > 0 ? search[0].value : null;\n}\n\nfunction findOption(optionSet, code) {\n  const search = optionSet.filter(o => o.code === code);\n  return search[0];\n}\n\nexport default function ConfigureBedModal({\n  open,\n  onClose,\n  selectedBed,\n  editable\n}) {\n  const metaData = useSelector(state => state.app.metaData);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const [bedAttributes, setBedAttributtes] = useState([]);\n  const [formState, setFormState] = useState({});\n  const engine = useDataEngine();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    if (metaData) {\n      let _bedAttributes = metaData.trackedEntityType.trackedEntityTypeAttributes;\n      let _formState = {};\n\n      for (var attrib of _bedAttributes) {\n        // check if this is a update thing\n        let bedValue = null;\n\n        if (selectedBed) {\n          bedValue = findAttribute(selectedBed.attributes, attrib.id);\n        }\n\n        if (attrib.valueType === \"TEXT\") {\n          if (attrib.optionSet && attrib.optionSet.options && attrib.optionSet.options.length > 0) {\n            if (bedValue) {\n              const option = findOption(attrib.optionSet.options, bedValue);\n              _formState[attrib.id] = {\n                \"label\": option.displayName,\n                \"value\": option.code\n              };\n            } else {\n              _formState[attrib.id] = {\n                \"label\": attrib.optionSet.options[0].displayName,\n                \"value\": attrib.optionSet.options[0].code\n              };\n            }\n          } else {\n            _formState[attrib.id] = bedValue ? bedValue : \"\";\n          }\n        } else if (attrib.valueType === \"BOOLEAN\") {\n          _formState[attrib.id] = {\n            \"label\": bedValue && bedValue === \"true\" ? \"Yes\" : \"No\",\n            \"value\": bedValue ? bedValue : \"false\"\n          };\n        }\n      }\n\n      setFormState(_formState);\n      setBedAttributtes(_bedAttributes);\n    }\n  }, [metaData]);\n\n  if (!open) {\n    return <></>;\n  }\n\n  const updateField = (field, value) => {\n    setFormState({ ...formState,\n      [field]: value\n    });\n  };\n\n  const getAttributeInput = (attribId, key) => {\n    console.log(attribId);\n    console.log(bedAttributes);\n    const attrib = bedAttributes.find(b => b.id === attribId);\n    console.log(attrib);\n\n    if (attrib.optionSet && attrib.optionSet.options && attrib.optionSet.options.length > 0) {\n      return <SingleSelectField key={key} label={attrib.formName} name={attrib.id} onChange={val => updateField(attrib.id, val.selected)} selected={formState[attrib.id]} disabled={!editable}>\n                        {attrib.optionSet.options.map((sel, key) => <SingleSelectOption key={key} label={sel.displayName} value={sel.code} />)}\n                </SingleSelectField>;\n    }\n\n    if (attrib.valueType === \"TEXT\") {\n      return <InputField key={key} label={attrib.formName} name={attrib.id} type=\"text\" onChange={val => updateField(attrib.id, val.value)} value={formState[attrib.id]} disabled={!editable} />;\n    }\n\n    if (attrib.valueType === \"BOOLEAN\") {\n      return <SingleSelectField key={key} label={attrib.formName} name={attrib.id} onChange={val => updateField(attrib.id, val.selected)} selected={formState[attrib.id]} disabled={!editable}>\n                        {booleanSelections.map((sel, key) => <SingleSelectOption key={key} label={sel.label} value={sel.value} />)}\n                </SingleSelectField>;\n      return <></>;\n    }\n  };\n\n  const addBed = async () => {\n    const attributes = [];\n\n    for (var attrib in formState) {\n      attributes.push({\n        \"attribute\": attrib,\n        \"value\": formState[attrib].value ? formState[attrib].value : formState[attrib]\n      });\n    }\n\n    if (selectedBed) {\n      // update existing bed\n      dispatch(updateBed(activeICU.id, selectedBed.trackedEntityInstance, attributes));\n    } else {\n      //create new bed\n      dispatch(createBed(metaData.trackedEntityType.id, activeICU.id, metaData.id, attributes));\n    }\n\n    onClose();\n  };\n\n  return <Modal open>\n            <ModalTitle>\n                {!editable ? \"View\" : selectedBed ? \"Update\" : \"Add\"} ICU Bed\n            </ModalTitle>\n            <ModalContent>\n                {bedAttributes.length > 0 && <div className=\"form\">\n                        {infoAttributes.map((attrib, key) => getAttributeInput(attrib, key))}\n                        \n                        <h4>Facilities</h4>\n                        {facilitiesAttributes.map((attrib, key) => getAttributeInput(attrib, key))}\n\n                        <h4>Expertise</h4>\n                        {experiseAttrbutes.map((attrib, key) => getAttributeInput(attrib, key))}\n                    </div>}\n            </ModalContent>\n            <ModalActions>\n                <ButtonStrip end>\n                    <Button onClick={onClose} secondary type=\"button\">\n                        Close\n                    </Button>\n                    {editable && <Button onClick={addBed} primary type=\"button\">\n                            {selectedBed ? \"Update Bed\" : \"Add New Bed\"}\n                        </Button>}\n                </ButtonStrip>\n            </ModalActions>\n        </Modal>;\n}","import React from 'react';\nexport default function useConfirmation() {\n  const show = (query, onOk, onCancel) => {\n    const isOk = confirm(query);\n\n    if (isOk) {\n      onOk();\n    } else {\n      onCancel();\n    }\n  };\n\n  return {\n    show\n  };\n}","import React, { useState, useEffect } from 'react';\nimport { Modal, ModalTitle, ModalActions, ModalContent, ButtonStrip, Button, InputField, SingleSelect, RadioGroup, Radio, RadioGroupField, SingleSelectOption, SingleSelectField } from '@dhis2/ui-core';\nimport { addBedEvent } from '../state/apiActions';\nimport { useSelector, useDispatch } from 'react-redux';\nimport useConfirmation from './useConfirmationHook';\nconst patientFieldset = [{\n  type: \"TEXT\",\n  label: \"ICU - BHT Number\",\n  id: \"j1hbO7zzRgV\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Patient Name\",\n  id: \"sK09QRLNyAA\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Consultant In-charge\",\n  id: \"malZQqUEzi9\"\n}, {\n  type: \"TEXT\",\n  label: \"ICU - Patient Diagnosis\",\n  id: \"qh9bc6jlauE\"\n}];\nexport default function RegisterPatientModal({\n  open,\n  onClose,\n  selectedBed,\n  actionType,\n  editable\n}) {\n  const [formState, setFormState] = useState({});\n  const dispatch = useDispatch();\n  const metaData = useSelector(state => state.app.metaData);\n  const programStage = useSelector(state => state.app.ICUEventId);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const confirmation = useConfirmation();\n  useEffect(() => {\n    let _formState = {};\n\n    for (var field of patientFieldset) {\n      if (field.type === \"TEXT\") {\n        if (!editable && selectedBed.lastEvent) {\n          _formState[field.id] = selectedBed.lastEvent.dataValues.find(dv => dv.dataElement === field.id).value;\n        } else {\n          _formState[field.id] = \"\";\n        }\n      }\n    }\n\n    setFormState(_formState);\n  }, [selectedBed]);\n\n  const updateField = (field, value) => {\n    setFormState({ ...formState,\n      [field]: value\n    });\n  };\n\n  const getFormField = (field, key) => {\n    if (field.type === \"TEXT\") {\n      return <InputField key={key} label={field.label} name={field.id} onChange={val => updateField(field.id, val.value)} value={formState[field.id]} disabled={!editable} />;\n    }\n  };\n\n  const admitPatient = () => {\n    let dataValues = [];\n\n    for (var field in formState) {\n      dataValues.push({\n        dataElement: field,\n        value: formState[field]\n      });\n    }\n\n    if (actionType === \"admit\") {\n      dispatch(addBedEvent(selectedBed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Admitted\", dataValues));\n    } else if (actionType === \"reserve\") {\n      dispatch(addBedEvent(selectedBed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Reserved\", dataValues));\n    }\n\n    onClose();\n  };\n\n  return <Modal open>\n            <ModalTitle>\n                \n                {editable && <span>{actionType === \"admit\" ? 'Admit' : 'Reserve'} New Patient</span>}\n                {!editable && <span>View Patient</span>}\n                \n            </ModalTitle>\n            <ModalContent>\n                {patientFieldset.map((field, key) => getFormField(field, key))}\n            </ModalContent>\n            <ModalActions>\n                <ButtonStrip end>\n                    <Button onClick={onClose} secondary type=\"button\">\n                        Close\n                    </Button>\n                    {editable && <Button onClick={admitPatient} primary type=\"button\">\n                            Admit Patient\n                        </Button>}\n                </ButtonStrip>\n            </ModalActions>\n        </Modal>;\n}","import React, { useEffect, useState } from 'react';\nimport { GoogleMap, LoadScript, Marker, InfoBox, DistanceMatrixService } from '@react-google-maps/api';\nconst mapContainerStyle = {\n  height: \"600px\",\n  width: \"100%\"\n};\nconst center = {\n  lat: 8.11,\n  lng: 80.77\n};\nconst infoWindowInitData = {\n  visible: false,\n  ...center\n};\nexport default function ICUMap(props) {\n  const {\n    onMarkerClick,\n    data,\n    origin,\n    updateDistance\n  } = props;\n  const [infoWindowData, setInfoWindowData] = useState(infoWindowInitData);\n\n  const handleMarkerOnHover = ICUEntry => {\n    setInfoWindowData({\n      visible: true,\n      ...ICUEntry\n    });\n  };\n\n  const infoBoxOptions = {\n    closeBoxURL: ''\n  };\n  const markerAvailableOptions = {\n    icon: {\n      path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',\n      fillColor: '#00802b',\n      fillOpacity: 1,\n      strokeColor: '',\n      strokeWeight: 0\n    }\n  };\n  const markerUnavailableOptions = {\n    icon: {\n      path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',\n      fillColor: '#DC143C',\n      fillOpacity: 1,\n      strokeColor: '',\n      strokeWeight: 0\n    }\n  };\n  let destinations = null;\n  let distanceRequest = null;\n\n  if (origin) {\n    destinations = data.map(d => d.geometry);\n    distanceRequest = {\n      origins: [{\n        lat: origin[1],\n        lng: origin[0]\n      }],\n      destinations: destinations,\n      travelMode: 'DRIVING'\n    };\n  }\n\n  return <LoadScript id=\"script-loader\" googleMapsApiKey=\"AIzaSyBjlDmwuON9lJbPMDlh_LI3zGpGtpK9erc\">\n            <GoogleMap id='example-map' mapContainerStyle={mapContainerStyle} zoom={7.6} center={center}>\n                {data.map((ICUEntry, index) => {\n        return <Marker position={{\n          lat: ICUEntry.geometry.lat,\n          lng: ICUEntry.geometry.lng\n        }} onClick={() => {\n          onMarkerClick(ICUEntry);\n        }} onMouseOver={() => {\n          handleMarkerOnHover(ICUEntry);\n        }} onMouseOut={() => {\n          handleMarkerOnHover(infoWindowInitData);\n        }} options={ICUEntry.available > 0 ? markerAvailableOptions : markerUnavailableOptions} key={index} />;\n      })}\n                {infoWindowData.visible && <InfoBox position={infoWindowData} options={infoBoxOptions}>\n                        <div style={{\n          backgroundColor: 'white',\n          opacity: 0.95,\n          padding: 5\n        }}>\n                            <div style={{\n            fontSize: 14,\n            fontColor: `#08233B`\n          }}>\n                                <div>ICU: {infoWindowData.name}</div>\n                                <div>Distance: {infoWindowData.distance}</div>\n                                <div>Beds: {infoWindowData.available}</div>\n                            </div>\n                        </div>\n                    </InfoBox>}\n            </GoogleMap>\n            {origin && <DistanceMatrixService options={distanceRequest} callback={(data, s) => updateDistance(data, status)} />}\n        </LoadScript>;\n}","import React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { AlertBar } from '@dhis2/ui-core';\nexport default function Notification(props) {\n  const {\n    isOpen,\n    message,\n    type\n  } = useSelector(state => state.notification);\n  if (!isOpen) return null;\n  return <AlertBar duration={5000} icon critical={type === 'error'} warning={type === 'warning'} success={type === 'success'}>\n            {message}\n        </AlertBar>;\n}","import React, { useState, useEffect } from 'react';\nimport { Provider, useSelector, useDispatch } from 'react-redux';\nimport { DataQuery, useDataQuery, useDataEngine } from '@dhis2/app-runtime';\nimport i18n from '@dhis2/d2-i18n';\nimport OrgUnits from './components/OrgUnits';\nimport './App.css';\nimport { Card, MultiSelect, MultiSelectOption, MultiSelectField, Button, ButtonStrip, Table, TableHead, TableBody, TableRow, TableCellHead, TableCell } from '@dhis2/ui-core';\nimport ICUTable from './components/ICUTable';\nimport * as api from \"./mockapi\";\nimport { rootReducer } from './state/store';\nimport ICUBed from './components/ICUBed';\nimport ConfigureBedModal from './components/ConfigureBedModal';\nimport { setActiveICU, setMetaData, setActiveOrgUnit, updateICUStat, updateICUDistance } from './state/appState';\nimport { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';\nimport { getICUBeds, getMetaData, addBedEvent, removeBed, getICUStat, getActiveUser } from './state/apiActions';\nimport RegisterPatientModal from './components/RegisterPatientModal';\nimport useConfirmation from './components/useConfirmationHook';\nimport ICUMap from './components/ICUMap';\nimport Notification from './components/Notification';\nimport { hasPerm, ACTIONS } from './components/permissionUtils';\n\nfunction getAttributeByName(bed, name) {\n  for (var attrib of bed.attributes) {\n    if (attrib.displayName === name) {\n      return attrib.value;\n    }\n  }\n\n  return \"\";\n}\n\nfunction ViewOrgICU() {\n  const activeOrgUnit = useSelector(state => state.app.activeOrgUnit);\n  const activeUser = useSelector(state => state.app.activeUser);\n  const bedData = useSelector(state => state.app.icuList);\n  const metaData = useSelector(state => state.app.metaData);\n  const dispatch = useDispatch();\n  const bedTypeId = 'XYNBoDZS0aV';\n  const covidTypeId = 'Xt5tV6OFSEW';\n  let bedTypeData = null;\n  let covidTypeData = null;\n\n  if (metaData) {\n    bedTypeData = metaData.trackedEntityType.trackedEntityTypeAttributes.find(({\n      id\n    }) => id === bedTypeId);\n    covidTypeData = metaData.trackedEntityType.trackedEntityTypeAttributes.find(({\n      id\n    }) => id === covidTypeId);\n  }\n\n  const [filters, setFilters] = useState({\n    [bedTypeId]: [],\n    [covidTypeId]: []\n  });\n  useEffect(() => {\n    if (bedData) {\n      for (var icu of bedData) {\n        if (icu.total === null) {\n          dispatch(getICUStat(icu, filters));\n          dispatch(updateICUStat({\n            icuId: icu.id,\n            stat: {\n              total: \"Updating...\",\n              available: null\n            }\n          }));\n        }\n      }\n    }\n  }, [bedData]);\n  useEffect(() => {\n    if (bedData) {\n      for (var icu of bedData) {\n        dispatch(getICUStat(icu, filters));\n      }\n    }\n  }, [filters]);\n\n  if (!activeOrgUnit) {\n    return <p>Please select an organization unit</p>;\n  }\n\n  if (activeOrgUnit.level === 6) {\n    return <ViewICUBeds />;\n  }\n\n  const onSelectICU = icu => {\n    dispatch(setActiveOrgUnit({\n      id: icu.id,\n      name: icu.name,\n      level: icu.level\n    }));\n    dispatch(setActiveICU({\n      id: icu.id,\n      beds: []\n    }));\n  };\n\n  const onUpdateDistance = (data, status) => {\n    if (data.rows && data.rows.length > 0 && data.rows[0].elements && data.rows[0].elements.length === bedData.length) {\n      for (var ind in bedData) {\n        if (data.rows[0].elements[ind].status === \"OK\") {\n          dispatch(updateICUDistance({\n            icuId: bedData[ind].id,\n            distance: `${data.rows[0].elements[ind].distance.text} (${data.rows[0].elements[ind].duration.text})`\n          }));\n        }\n      }\n    }\n  };\n\n  return activeOrgUnit.level < 6 && <>\n                <span className=\"t20\">Showing ICU Locations for <b>{activeOrgUnit.name}</b></span>\n                <div className=\"filter-area\">\n                    <MultiSelect selected={filters[bedTypeId]} placeholder={bedTypeData.displayName} onChange={({\n        selected\n      }) => {\n        setFilters({ ...filters,\n          [bedTypeId]: selected\n        });\n      }}>\n                        {bedTypeData && bedTypeData.optionSet.options.map((option, key) => <MultiSelectOption key={key} value={option.code} label={option.displayName} />)}\n                    </MultiSelect>\n                    <MultiSelect selected={filters[covidTypeId]} placeholder={covidTypeData.displayName} onChange={({\n        selected\n      }) => {\n        setFilters({ ...filters,\n          [covidTypeId]: selected\n        });\n      }}>\n                        {covidTypeData && covidTypeData.optionSet.options.map((option, key) => <MultiSelectOption key={key} value={option.code} label={option.displayName} />)}\n                    </MultiSelect>\n                </div>\n                <div className=\"icu-org\">\n                    <div className=\"icu-table\">\n                        <ICUTable data={bedData} onSelectICU={onSelectICU} />\n                    </div>\n                    <div className=\"icu-map\">\n                        <ICUMap onMarkerClick={ICUEntry => {\n          console.log(ICUEntry);\n        }} data={bedData} origin={activeUser.origin} updateDistance={onUpdateDistance} />\n                    </div>\n                </div>\n            </>;\n}\n\nfunction ViewICUBeds() {\n  const activeUser = useSelector(state => state.app.activeUser);\n  const activeOrgUnit = useSelector(state => state.app.activeOrgUnit);\n  const activeICU = useSelector(state => state.app.activeICU);\n  const metaData = useSelector(state => state.app.metaData);\n  const programStage = useSelector(state => state.app.ICUEventId);\n  const [showConfigure, setShowConfigure] = useState(false);\n  const [bedModalOpen, setBedModalOpen] = useState(false);\n  const [patientModalOpen, setPatientModalOpen] = useState(false);\n  const [patientModalAction, setPatientModalAction] = useState(\"admit\");\n  const [selectedBed, setSelectedBed] = useState(null);\n  const [eventPerm, setEventPerm] = useState(false);\n  const [patientEditable, setPatientEditable] = useState(true);\n  const dispatch = useDispatch();\n  const confirmation = useConfirmation();\n  useEffect(() => {\n    if (metaData) {\n      dispatch(getICUBeds(activeICU.id, metaData.id));\n\n      if (hasPerm(ACTIONS.ADD_EVENT, activeUser, metaData.programAccess, metaData.trackedEntityType.access, activeICU.id)) {\n        setEventPerm(true);\n      }\n    }\n  }, [metaData, activeICU.id]);\n\n  const onViewBed = bed => {\n    setSelectedBed(bed);\n    setBedModalOpen(true);\n  };\n\n  const onOccupyBed = bed => {\n    setSelectedBed(bed);\n    setPatientEditable(true);\n    setPatientModalAction(\"admit\");\n    setPatientModalOpen(true); // dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Admitted\"));\n  };\n\n  const onReserveBed = bed => {\n    // confirmation.show(\"Do you want to confirm reserving this bed?\",\n    //     () => dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Reserved\")),\n    //     () => { }\n    // );\n    setSelectedBed(bed);\n    setPatientEditable(true);\n    setPatientModalAction(\"reserve\");\n    setPatientModalOpen(true);\n  };\n\n  const onDischargeBed = bed => {\n    confirmation.show(\"Do you want to confirm discharging this bed?\", () => dispatch(addBedEvent(bed.trackedEntityInstance, metaData.id, programStage, activeICU.id, \"Discharged\")), () => {});\n  };\n\n  const onViewPatient = bed => {\n    setSelectedBed(bed);\n    setPatientEditable(false);\n    setPatientModalOpen(true);\n  };\n\n  if (!activeOrgUnit) {\n    return <p>Please select an organization unit</p>;\n  }\n\n  return <>\n            <div className=\"contact\">\n                <p><b>Primary Contact</b></p>\n                <p>Dr. John Doe</p>\n                <p>+94771234568</p>\n                <p>+94717894562</p>\n            </div>\n            <div className=\"inner-header\">\n                <span className=\"t20\">Showing ICU Bed status at <b>{activeOrgUnit.name}</b></span>\n                {hasPerm(ACTIONS.CONFIG_ICU, activeUser, metaData.programAccess, metaData.trackedEntityType.access, activeICU.id) && <Button onClick={() => setShowConfigure(true)} className=\"pull-right\">Configure Beds</Button>}\n            </div>\n            {activeICU && <>\n                    {showConfigure && <ViewConfigureBeds onBack={() => setShowConfigure(false)} />}\n                    {!showConfigure && <div className=\"icu-bed-container\">\n                            {!activeICU.beds.length && <p>No beds currently added</p>}\n                            {activeICU.beds.map((bed, key) => <ICUBed key={key} name={getAttributeByName(bed, \"ICU - Bed Number\")} status={bed.status ? bed.status : \"IDLE\"} onView={() => onViewBed(bed)} onOccupy={() => onOccupyBed(bed)} onDischarge={() => onDischargeBed(bed)} onReserve={() => onReserveBed(bed)} onViewPatient={() => onViewPatient(bed)} hasEventPerm={eventPerm} hasEditPerm={hasPerm(ACTIONS.CONFIG_ICU, activeUser, metaData.programAccess, metaData.trackedEntityType.access, activeICU.id)} />)}\n                        </div>}\n                </>}\n            {bedModalOpen && <ConfigureBedModal open={bedModalOpen} onClose={() => setBedModalOpen(false)} selectedBed={selectedBed} editable={false} />}\n            {patientModalOpen && <RegisterPatientModal open={patientModalOpen} onClose={() => setPatientModalOpen(false)} selectedBed={selectedBed} actionType={patientModalAction} editable={patientEditable} />}\n        </>;\n}\n\nfunction ViewConfigureBeds({\n  onBack\n}) {\n  const [bedModalOpen, setBedModalOpen] = useState(false);\n  const dispatch = useDispatch();\n  const activeICU = useSelector(state => state.app.activeICU);\n  const metaData = useSelector(state => state.app.metaData);\n  const [selectedBed, setSelectedBed] = useState(null);\n  const confirmation = useConfirmation(); // useEffect(() => {\n  //     dispatch(getICUBeds(activeICU.id, metaData.id));\n  // }, []);\n\n  const onAddBed = () => {\n    setSelectedBed(null);\n    setBedModalOpen(true);\n  };\n\n  const onSelectBed = bed => {\n    setSelectedBed(bed);\n    setBedModalOpen(true);\n  };\n\n  const onRemoveBed = bed => {\n    confirmation.show(\"Do you really want to remove this bed?\", () => {\n      dispatch(removeBed(activeICU.id, bed.enrollments[0].enrollment));\n    }, () => {});\n  };\n\n  return <>\n            <div className=\"inner-header\">\n                <ButtonStrip end>\n                    <Button onClick={onBack}>Back</Button>\n                    <Button primary onClick={onAddBed}>Add New Bed</Button>\n                </ButtonStrip>\n            </div>\n            <div className=\"inner-container\">\n                <Table>\n                    <TableHead>\n                        <TableRow>\n                            <TableCellHead>Bed No</TableCellHead>\n                            <TableCellHead>Bed Type</TableCellHead>\n                            <TableCellHead>Covid Type</TableCellHead>\n                            <TableCellHead>Action</TableCellHead>\n                        </TableRow>\n                    </TableHead>\n                    {activeICU && <TableBody>\n                            {activeICU.beds.map((bed, key) => <TableRow key={key}>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - Bed Number\")}</TableCell>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - Type\")}</TableCell>\n                                    <TableCell>{getAttributeByName(bed, \"ICU - COVID Type\")}</TableCell>\n                                    <TableCell>\n                                        <ButtonStrip>\n                                            <Button onClick={() => onSelectBed(bed)}>View Details</Button>\n                                            <Button destructive onClick={() => onRemoveBed(bed)}>Remove</Button>\n                                        </ButtonStrip>\n                                    </TableCell>\n                                </TableRow>)}\n                        </TableBody>}\n                </Table>\n            </div>\n            {bedModalOpen && <ConfigureBedModal open={bedModalOpen} onClose={() => setBedModalOpen(false)} selectedBed={selectedBed} editable={true} />}\n        </>;\n}\n\nfunction ContainerView({\n  children\n}) {\n  const dispatch = useDispatch();\n  useEffect(() => {\n    dispatch(getMetaData());\n    dispatch(getActiveUser());\n  }, []);\n  return <div style={{\n    height: \"100vh\"\n  }}>\n            {children}\n        </div>;\n}\n\nfunction MyApp() {\n  const dhisEngine = useDataEngine();\n  const customizedMiddleware = getDefaultMiddleware({\n    thunk: {\n      extraArgument: dhisEngine\n    }\n  });\n  const store = configureStore({\n    reducer: rootReducer,\n    middleware: customizedMiddleware\n  });\n  return <Provider store={store}>\n            <ContainerView>\n                <div className=\"container\">\n                    <div className=\"left-column\">\n                        <OrgUnits />\n                    </div>\n                    <div className=\"right-column\">\n                        <ViewOrgICU />\n                        {\n            /* <ViewICUBeds /> */\n          }\n                        {\n            /* <ViewConfigureBeds /> */\n          }\n                    </div>\n                </div>\n                <div style={{\n        bottom: 0,\n        left: 0,\n        paddingLeft: 16,\n        position: 'fixed',\n        width: '60%'\n      }}>\n                    <Notification />\n                </div>\n            </ContainerView>\n        </Provider>;\n}\n\nexport default MyApp;"],"sourceRoot":""}