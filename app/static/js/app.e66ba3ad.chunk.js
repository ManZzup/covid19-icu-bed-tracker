(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{428:function(e,t,a){},430:function(e,t,a){"use strict";a.r(t);var n=a(1),l=a.n(n),c=a(192),r=a(17),i=(a(7),a(203)),s=a(5),o=a(272),d=a(230);const u=Object(d.b)({name:"app",initialState:{activeOrgUnit:null,activeICU:null,metaData:null,icuList:[],ICUEventId:"fKXrko0yhua"},reducers:{setActiveOrgUnit(e,t){e.activeOrgUnit=t.payload},setActiveICU(e,t){e.activeICU=t.payload},setMetaData(e,t){e.metaData=t.payload},setICUBeds(e,t){e.activeICU&&e.activeICU.id===t.payload.icuId&&(e.activeICU.beds=t.payload.beds)},updateBedStatus(e,t){const a=e.activeICU.beds.findIndex(e=>e.trackedEntityInstance===t.payload.bedId);e.activeICU.beds[a].status=t.payload.status},updateFilteredICUList(e,t){e.icuList=t.payload},updateICUStat(e,t){const a=e.icuList.findIndex(e=>e.id===t.payload.icuId);e.icuList[a].available=t.payload.stat.available,e.icuList[a].total=t.payload.stat.total}}}),{setActiveOrgUnit:m,setActiveICU:p,setMetaData:E,setICUBeds:y,updateBedStatus:b,updateFilteredICUList:v,updateICUStat:f}=u.actions;var g=u.reducer;const C={organisationUnits:{resource:"organisationUnits.json",params:{paging:"false",fields:"id,name,level,children"}}};function h(){const{loading:e,error:t,data:a,refetch:d}=Object(r.c)(C),[u,E]=Object(n.useState)(null),[y,b]=Object(n.useState)(!1),f=Object(c.b)();var g=[];Object(n.useEffect)(()=>{if(a){const e=a.organisationUnits.organisationUnits,t=a.organisationUnits.organisationUnits.filter(e=>1===e.level)[0];t.children=function e(t,a){let n=[];for(var l of a){let a=t.filter(e=>e.id===l.id);1===a.length&&(a=a[0],0===a.children.length?a.children=null:a.children=e(t,a.children),n.push(Object(i.a)({},a,{active:!1})))}let c=[];for(var l of n)g=[],h(l,6),g.length>0&&c.push(l);return c}(e,t.children),console.log(t),E(t)}},[e]);function h(e,t){if(e.level!==t){if(e.children)for(var a of e.children)h(a,t)}else g.push(Object(i.a)({},e))}const O=e=>{g=[],h(e,6);let t=[];for(var a of g)t.push(Object(i.a)({},a,{distance:0,total:null,available:null}));f(v(t)),f(m({id:e.id,name:e.name,level:e.level})),6===e.level&&f(p({id:e.id,beds:[]}))};return l.a.createElement(s.c,null,u&&l.a.createElement(o.Treebeard,{data:u,onToggle:(e,t)=>{y&&(y.active=!1),e.active=!0,e.children&&(e.toggled=t),b(e),E(Object.assign({},u)),O(e)}}))}a(428);var O=a(25);const I="ICU - Bed Event";function k(e,t){let a={};return"Discharged"===t?a={dataElement:e[I].id,value:"Discharged"}:"Admitted"===t?a={dataElement:e[I].id,value:"Admitted"}:"Reserved"===t&&(a={dataElement:e[I].id,value:"Reserved"}),a}function U(e){if(e.dataValues.length>0)switch(e.dataValues[0].value){case"Discharged":return"AVAILABLE";case"Admitted":return"OCCUPIED";case"Reserved":return"RESERVED"}return""}function j(e,t){return async(a,n,l)=>{try{const n={results:{resource:"trackedEntityInstances",params:{ou:e,fields:"trackedEntityInstance,attributes[attribute,displayName,value],enrollments",program:t}}},r=(await l.query(n)).results.trackedEntityInstances;for(var c of r)a(D(c.trackedEntityInstance));a(y({icuId:e,beds:r}))}catch(r){console.log("Error in query:",r)}}}function D(e){return async(t,a,n)=>{const l={events:{resource:"events",params:{trackedEntityInstance:e,paging:"false",status:"ACTIVE"}}},c=(await n.query(l)).events.events;let r="";if(c.length>0){const n=c[0],l=n.dataValues.findIndex(e=>e.dataElement===a().app.metaData.dataElements[I].id);if(l>-1)switch(n.dataValues[l].value){case"Discharged":r="AVAILABLE";break;case"Admitted":r="OCCUPIED";break;case"Reserved":r="RESERVED"}t(b({bedId:e,status:r,lastEvent:n}))}}}function A(e,t,a,n,l,c=[]){return async(r,i,s)=>{try{const o={events:{resource:"events",params:{trackedEntityInstance:e,paging:"false",status:"ACTIVE"}}},d=await s.query(o);if(d.events.events.length>0){const l={resource:"events",type:"create",data:{event:d.events.events[0].event,trackedEntityInstance:e,program:t,programStage:a,enrollment:n,orgUnit:n,completedDate:O().format("YYYY-MM-DD"),status:"COMPLETED"}};await s.mutate(l)}const u=[k(i().app.metaData.dataElements,l),...c],m={resource:"events",type:"create",data:{trackedEntityInstance:e,program:t,programStage:a,enrollment:n,orgUnit:n,dataValues:u,eventDate:O().format("YYYY-MM-DD"),status:"ACTIVE"}};await s.mutate(m);r(D(e))}catch(o){console.log("Error in creating:",o)}}}function T(e,t,a){const{setLocationData:n,sortedBy:l,setSortedBy:c,sortOrder:r,setSortOrder:i}=a;let s=t.slice();s=s.sort((t,a)=>{let n=t[e],c=a[e],i=0;return n>c?i=1:n<c&&(i=-1),l===e&&(i=-1*i*r),i}),n(s),c(e),i(-1*r)}function S({data:e,onSelectICU:t}){const[a,r]=Object(n.useState)([]),[i,o]=Object(n.useState)("distance"),[d,u]=Object(n.useState)(1),m=Object(c.b)(),p={setLocationData:r,sortedBy:i,setSortedBy:o,sortOrder:d,setSortOrder:u};Object(n.useEffect)(()=>{T(i,e,p)},[e]);const E=e=>null===e.total?(m(function(e){return async(t,a,n)=>{try{const a={events:{resource:"events",params:{orgUnit:e.id,paging:"false",status:"ACTIVE"}}},c=await n.query(a);let r={available:0,total:0};for(var l of c.events.events){"AVAILABLE"===U(l)&&r.available++,r.total++}t(f({icuId:e.id,stat:r}))}catch(c){console.log("Error in creating:",c)}}}(e)),"Updating...."):e.total;return e?l.a.createElement(s.w,null,l.a.createElement(s.A,null,l.a.createElement(s.B,null,l.a.createElement(s.z,null,l.a.createElement(s.h,{primary:"name"===i,onClick:()=>{T("name",a,p)}},"ICU")),l.a.createElement(s.z,null,l.a.createElement(s.h,{primary:"distance"===i,onClick:()=>{T("distance",a,p)}},"Distance")),l.a.createElement(s.z,null,l.a.createElement(s.h,{primary:"total"===i,onClick:()=>{T("total",a,p)}},"TotalBeds")),l.a.createElement(s.z,null,l.a.createElement(s.h,{primary:"available"===i,onClick:()=>{T("available",a,p)}},"AvailableBeds")),l.a.createElement(s.z,null,"  Contact "))),l.a.createElement(s.x,null,a.map((e,a)=>l.a.createElement(s.B,{key:a},l.a.createElement(s.y,null,l.a.createElement("a",{href:"#",onClick:()=>t(e)},e.name)),l.a.createElement(s.y,null,e.distance),l.a.createElement(s.y,null,E(e)),l.a.createElement(s.y,null,e.available),l.a.createElement(s.y,null,l.a.createElement("p",null,"Dr. John Doe"),l.a.createElement("p",null,"+94771234568"),l.a.createElement("p",null,"+94717894562")))))):l.a.createElement("div",null)}var N=a(188);const B=Object(N.combineReducers)({app:g});Object(d.a)({reducer:B});var w=a(15);function L({name:e,status:t,onView:a,onOccupy:c,onDischarge:r,onReserve:i}){const o=Object(n.useRef)(null),[d,u]=Object(n.useState)(!1),m=()=>{u(!d)};return l.a.createElement("div",{className:"icu-bed ".concat("AVAILABLE"===t?"available":"OCCUPIED"===t?"occupied":"RESERVED"===t?"reserved":""),ref:o,onClick:m},l.a.createElement("span",null,e),d&&Object(w.createPortal)(l.a.createElement(s.t,{onClick:m,transparent:!0},l.a.createElement(s.s,{placement:"right",reference:o},l.a.createElement("div",{className:"bed-options"},("AVAILABLE"===t||"RESERVED"===t)&&l.a.createElement("div",{onClick:()=>{u(!1),c()}},"Occupy"),"AVAILABLE"===t&&l.a.createElement("div",{onClick:()=>{u(!1),i()}},"Reserve"),"AVAILABLE"!==t&&l.a.createElement("div",{onClick:()=>{u(!1),r()}},"Discharge"),l.a.createElement("div",{onClick:a},"View")))),document.body))}const V=[{label:"No",value:"false"},{label:"Yes",value:"true"}];function M(e,t){const a=e.filter(e=>e.attribute===t);return a.length>0?a[0].value:null}function R(e,t){return e.filter(e=>e.code===t)[0]}function z({open:e,onClose:t,selectedBed:a,editable:o}){const d=Object(c.c)(e=>e.app.metaData),u=Object(c.c)(e=>e.app.activeICU),[m,p]=Object(n.useState)([]),[E,y]=Object(n.useState)({}),b=(Object(r.b)(),Object(c.b)());if(Object(n.useEffect)(()=>{if(d){let t=d.trackedEntityType.trackedEntityTypeAttributes,n={};for(var e of t){let t=null;if(a&&(t=M(a.attributes,e.id)),"TEXT"===e.valueType)if(e.optionSet&&e.optionSet.options&&e.optionSet.options.length>0)if(t){const a=R(e.optionSet.options,t);n[e.id]={label:a.displayName,value:a.code}}else n[e.id]={label:e.optionSet.options[0].displayName,value:e.optionSet.options[0].code};else n[e.id]=t||"";else"BOOLEAN"===e.valueType&&(n[e.id]={label:t&&"true"===t?"Yes":"No",value:t||"false"})}y(n),p(t)}},[d]),!e)return l.a.createElement(l.a.Fragment,null);const v=(e,t)=>{y(Object(i.a)({},E,{[e]:t}))};return l.a.createElement(s.l,{open:!0},l.a.createElement(s.o,null,o?a?"Update":"Add":"View"," ICU Bed"),l.a.createElement(s.n,null,l.a.createElement("div",{className:"form"},m.map((e,t)=>((e,t)=>e.optionSet&&e.optionSet.options&&e.optionSet.options.length>0?l.a.createElement(s.u,{key:t,label:e.displayName,name:e.id,onChange:t=>v(e.id,t.selected),selected:E[e.id],disabled:!o},e.optionSet.options.map((e,t)=>l.a.createElement(s.v,{key:t,label:e.displayName,value:e.code}))):"TEXT"===e.valueType?l.a.createElement(s.i,{key:t,label:e.displayName,name:e.id,type:"text",onChange:t=>v(e.id,t.value),value:E[e.id],disabled:!o}):"BOOLEAN"===e.valueType?l.a.createElement(s.u,{key:t,label:e.displayName,name:e.id,onChange:t=>v(e.id,t.selected),selected:E[e.id],disabled:!o},V.map((e,t)=>l.a.createElement(s.v,{key:t,label:e.label,value:e.value}))):void 0)(e,t)))),l.a.createElement(s.m,null,l.a.createElement(s.b,{end:!0},l.a.createElement(s.a,{onClick:t,secondary:!0,type:"button"},"Close"),o&&l.a.createElement(s.a,{onClick:async()=>{const e=[];for(var n in E)e.push({attribute:n,value:E[n].value?E[n].value:E[n]});b(a?function(e,t,a){return async(n,l,c)=>{try{const r={resource:"trackedEntityInstances/"+t,type:"update",data:{orgUnit:e,attributes:a}};await c.mutate(r);n(j(e,l().app.metaData.id))}catch(r){console.log("Error in creating:",r)}}}(u.id,a.trackedEntityInstance,e):function(e,t,a,n){return async(l,c,r)=>{try{const i={resource:"trackedEntityInstances",type:"create",data:{trackedEntityType:e,orgUnit:t,attributes:n,enrollments:[{orgUnit:t,program:a,enrollmentDate:O().format("YYYY-MM-DD"),incidentDate:O().format("YYYY-MM-DD")}]}};l(A((await r.mutate(i)).response.importSummaries[0].reference,a,c().app.ICUEventId,t,"Discharged")),l(j(t,a))}catch(i){console.log("Error in creating:",i)}}}(d.trackedEntityType.id,u.id,d.id,e)),t()},primary:!0,type:"button"},a?"Update Bed":"Add New Bed"))))}function Y(){return{show:(e,t,a)=>{confirm(e)?t():a()}}}const q=[{type:"TEXT",label:"ICU - BHT Number",id:"j1hbO7zzRgV"},{type:"TEXT",label:"ICU - Patient Name",id:"sK09QRLNyAA"},{type:"TEXT",label:"ICU - Consultant In-charge",id:"malZQqUEzi9"},{type:"TEXT",label:"ICU - Patient Diagnosis",id:"qh9bc6jlauE"}];function P({open:e,onClose:t,selectedBed:a}){const[r,o]=Object(n.useState)({}),d=Object(c.b)(),u=Object(c.c)(e=>e.app.metaData),m=Object(c.c)(e=>e.app.ICUEventId),p=Object(c.c)(e=>e.app.activeICU);Y();Object(n.useEffect)(()=>{let e={};for(var t of q)"TEXT"===t.type&&(e[t.id]="");o(e)},[]);const E=(e,t)=>{if("TEXT"===e.type)return l.a.createElement(s.i,{key:t,label:e.label,name:e.id,onChange:t=>((e,t)=>{o(Object(i.a)({},r,{[e]:t}))})(e.id,t.value),value:r[e.id]})};return l.a.createElement(s.l,{open:!0},l.a.createElement(s.o,null,"Admit New Patient"),l.a.createElement(s.n,null,q.map((e,t)=>E(e,t))),l.a.createElement(s.m,null,l.a.createElement(s.b,{end:!0},l.a.createElement(s.a,{onClick:t,secondary:!0,type:"button"},"Close"),l.a.createElement(s.a,{onClick:()=>{let e=[];for(var n in r)e.push({dataElement:n,value:r[n]});d(A(a.trackedEntityInstance,u.id,m,p.id,"Admitted",e)),t()},primary:!0,type:"button"},"Admit Patient"))))}var x=a(429);const X={height:"600px",width:"100%"},F={lat:8.11,lng:80.77},J=Object(i.a)({visible:!1},F);function K(e){const{onMarkerClick:t,data:a}=e,[c,r]=Object(n.useState)(J),s=e=>{r(Object(i.a)({visible:!0},e))},o={icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#00802b",fillOpacity:1,strokeColor:"",strokeWeight:0}},d={icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#DC143C",fillOpacity:1,strokeColor:"",strokeWeight:0}};return l.a.createElement(x.c,{id:"script-loader",googleMapsApiKey:"AIzaSyBjlDmwuON9lJbPMDlh_LI3zGpGtpK9erc"},l.a.createElement(x.a,{id:"example-map",mapContainerStyle:X,zoom:7.6,center:F},a.map((e,a)=>l.a.createElement(x.d,{position:{lat:e.lat,lng:e.lng},onClick:()=>{t(e)},onMouseOver:()=>{s(e)},onMouseOut:()=>{s(J)},options:e.available>0?o:d})),c.visible&&l.a.createElement(x.b,{position:c,options:{closeBoxURL:""}},l.a.createElement("div",{style:{backgroundColor:"white",opacity:.95,padding:5}},l.a.createElement("div",{style:{fontSize:14,fontColor:"#08233B"}},l.a.createElement("div",null,"ICU: ",c.name),l.a.createElement("div",null,"Distance: ",c.distance),l.a.createElement("div",null,"Beds: ",c.available))))))}function Q(e,t){for(var a of e.attributes)if(a.displayName===t)return a.value;return""}function W(){const e=Object(c.c)(e=>e.app.activeOrgUnit),t=Object(c.c)(e=>e.app.icuList),a=Object(c.b)();Object(n.useEffect)(()=>{},[]);const r=()=>{};if(!e)return l.a.createElement("p",null,"Please select an organization unit");if(6===e.level)return l.a.createElement(G,null);return e.level<6&&l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"t20"},"Showing ICU Locations for ",l.a.createElement("b",null,e.name)),l.a.createElement("div",{className:"filter-area"},l.a.createElement(s.p,{placeholder:"ICU Type",onChange:r},l.a.createElement(s.q,{value:"type01",label:"Medical"}),l.a.createElement(s.q,{value:"type01",label:"Surgical"}),l.a.createElement(s.q,{value:"type01",label:"Neurosurgical"}),l.a.createElement(s.q,{value:"type01",label:"Pediatric"}),l.a.createElement(s.q,{value:"type01",label:"Neonatal"}),l.a.createElement(s.q,{value:"type01",label:"Other"})),l.a.createElement(s.p,{placeholder:"Bed Type",onChange:r},l.a.createElement(s.q,{value:"type01",label:"Type 01",onClick:r})),l.a.createElement(s.p,{placeholder:"Diagnosis Type",onChange:r},l.a.createElement(s.q,{value:"type01",label:"Type 01",onClick:r}))),l.a.createElement("div",{className:"icu-org"},l.a.createElement("div",{className:"icu-table"},l.a.createElement(S,{data:t,onSelectICU:e=>{a(m({id:e.id,name:e.name,level:e.level})),a(p({id:e.id,beds:[]}))}})),l.a.createElement("div",{className:"icu-map"},l.a.createElement(K,{onMarkerClick:e=>{console.log(e)},data:t}))))}function G(){const e=Object(c.c)(e=>e.app.activeOrgUnit),t=Object(c.c)(e=>e.app.activeICU),a=Object(c.c)(e=>e.app.metaData),r=Object(c.c)(e=>e.app.ICUEventId),[i,o]=Object(n.useState)(!1),[d,u]=Object(n.useState)(!1),[m,p]=Object(n.useState)(!1),[E,y]=Object(n.useState)(null),b=Object(c.b)(),v=Y();Object(n.useEffect)(()=>{a&&b(j(t.id,a.id))},[a,t.id]);return e?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"inner-header"},l.a.createElement("span",{className:"t20"},"Showing ICU Bed status at ",l.a.createElement("b",null,e.name)),l.a.createElement(s.a,{onClick:()=>o(!0),className:"pull-right"},"Configure Beds")),t&&l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(H,{onBack:()=>o(!1)}),!i&&l.a.createElement("div",{className:"icu-bed-container"},!t.beds.length&&l.a.createElement("p",null,"No beds currently added"),t.beds.map((e,n)=>l.a.createElement(L,{key:n,name:Q(e,"ICU - Bed Number"),status:e.status?e.status:"IDLE",onView:()=>(e=>{y(e),u(!0)})(e),onOccupy:()=>(e=>{y(e),p(!0)})(e),onDischarge:()=>(e=>{v.show("Do you want to confirm discharging this bed?",()=>b(A(e.trackedEntityInstance,a.id,r,t.id,"Discharged")),()=>{})})(e),onReserve:()=>(e=>{v.show("Do you want to confirm reserving this bed?",()=>b(A(e.trackedEntityInstance,a.id,r,t.id,"Reserved")),()=>{})})(e)})))),d&&l.a.createElement(z,{open:d,onClose:()=>u(!1),selectedBed:E,editable:!1}),m&&l.a.createElement(P,{open:m,onClose:()=>p(!1),selectedBed:E})):l.a.createElement("p",null,"Please select an organization unit")}function H({onBack:e}){const[t,a]=Object(n.useState)(!1),r=Object(c.b)(),i=Object(c.c)(e=>e.app.activeICU),[o,d]=(Object(c.c)(e=>e.app.metaData),Object(n.useState)(null)),u=Y(),m=e=>{u.show("Do you really want to remove this bed?",()=>{var t,a;r((t=i.id,a=e.enrollments[0].enrollment,async(e,n,l)=>{try{const c={resource:"enrollments/"+a,type:"delete"};await l.mutate(c),e(j(t,n().app.metaData.id))}catch(c){console.log("Error in creating:",c)}}))},()=>{})};return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"inner-header"},l.a.createElement(s.b,{end:!0},l.a.createElement(s.a,{onClick:e},"Back"),l.a.createElement(s.a,{primary:!0,onClick:()=>{d(null),a(!0)}},"Add New Bed"))),l.a.createElement("div",{className:"inner-container"},l.a.createElement(s.w,null,l.a.createElement(s.A,null,l.a.createElement(s.B,null,l.a.createElement(s.z,null,"Bed No"),l.a.createElement(s.z,null,"Bed Type"),l.a.createElement(s.z,null,"Covid Type"),l.a.createElement(s.z,null,"Action"))),i&&l.a.createElement(s.x,null,i.beds.map((e,t)=>l.a.createElement(s.B,{key:t},l.a.createElement(s.y,null,Q(e,"ICU - Bed Number")),l.a.createElement(s.y,null,Q(e,"ICU - Type")),l.a.createElement(s.y,null,Q(e,"ICU - COVID Type")),l.a.createElement(s.y,null,l.a.createElement(s.b,null,l.a.createElement(s.a,{onClick:()=>(e=>{d(e),a(!0)})(e)},"View Details"),l.a.createElement(s.a,{destructive:!0,onClick:()=>m(e)},"Remove")))))))),t&&l.a.createElement(z,{open:t,onClose:()=>a(!1),selectedBed:o,editable:!0}))}function Z({children:e}){const t=Object(c.b)();return Object(n.useEffect)(()=>{t(async(e,t,a)=>{try{const t={program:{resource:"programs/C1wTfmmMQUn",params:{fields:"id,name,trackedEntityType[id, displayName, trackedEntityTypeAttributes[trackedEntityAttribute[id, displayName, valueType, optionSet[options[displayName, id, code]]]]]"}},dataElements:{resource:"dataElements",params:{paging:"false",program:"C1wTfmmMQUn",fields:"id,displayName,optionSet[options[id, displayName,code]]"}}},{program:c,dataElements:r}=await a.query(t);let i={id:c.id,name:c.name,trackedEntityType:{id:c.trackedEntityType.id,displayName:c.trackedEntityType.displayName,trackedEntityTypeAttributes:[]}};for(var n of c.trackedEntityType.trackedEntityTypeAttributes)i.trackedEntityType.trackedEntityTypeAttributes.push(n.trackedEntityAttribute);let s={};for(var l of r.dataElements)if(l.displayName.startsWith("ICU")){let e={id:l.id,displayName:l.displayName};l.optionSet&&(e.options=l.optionSet.options),s[l.displayName]=e}i.dataElements=s,e(E(i))}catch(c){console.log("Error in query:",c)}})},[]),l.a.createElement("div",{style:{height:"100vh"}},e)}t.default=function(){const e=Object(r.b)(),t=Object(d.c)({thunk:{extraArgument:e}}),a=Object(d.a)({reducer:B,middleware:t});return l.a.createElement(c.a,{store:a},l.a.createElement(Z,null,l.a.createElement("div",{className:"container"},l.a.createElement("div",{className:"left-column"},l.a.createElement(h,null)),l.a.createElement("div",{className:"right-column"},l.a.createElement(W,null)))))}}}]);
//# sourceMappingURL=app.e66ba3ad.chunk.js.map