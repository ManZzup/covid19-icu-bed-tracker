(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{428:function(e,t,a){},435:function(e,t,a){"use strict";a.r(t);var n=a(194),r=a(1),i=a.n(r),c=a(189),l=a(17),s=(a(7),a(5)),o=a(272),d=a(204);const u=Object(d.b)({name:"app",initialState:{activeUser:null,activeOrgUnit:null,activeICU:null,metaData:null,icuList:[],ICUEventId:"fKXrko0yhua"},reducers:{setActiveOrgUnit(e,t){e.activeOrgUnit=t.payload},setActiveICU(e,t){e.activeICU=t.payload},setActiveUser(e,t){e.activeUser=t.payload},setMetaData(e,t){e.metaData=t.payload},setICUBeds(e,t){e.activeICU&&e.activeICU.id===t.payload.icuId&&(e.activeICU.beds=t.payload.beds)},updateBedStatus(e,t){const a=e.activeICU.beds.findIndex(e=>e.trackedEntityInstance===t.payload.bedId);a>-1&&(e.activeICU.beds[a].status=t.payload.status,e.activeICU.beds[a].lastEvent=t.payload.lastEvent)},updateFilteredICUList(e,t){e.icuList=t.payload},updateICUStat(e,t){const a=e.icuList.find(e=>e.id===t.payload.icuId);a&&Object.assign(a,{available:t.payload.stat.available,total:t.payload.stat.total,name:t.payload.icuName,isLoading:!1})},updateICUDistance(e,t){const a=e.icuList.findIndex(e=>e.id===t.payload.icuId);a>-1&&(e.icuList[a].distance=t.payload.distance)},updateActiveICUData(e,t){e.activeICU&&e.activeICU.id===t.payload.icuId&&Object.assign(e.activeICU,{contactPerson:t.payload.contactPerson,contactNumber:t.payload.contactNumber})},updateICUStatRequest(e,t){e.icuList.find(e=>e.id===t.payload.icuId).isLoading=!0}}}),{setActiveOrgUnit:m,setActiveICU:p,setMetaData:E,setICUBeds:y,updateBedStatus:b,updateFilteredICUList:v,updateICUStat:g,setActiveUser:f,updateICUDistance:h,updateActiveICUData:O,updateICUStatRequest:C}=u.actions;var I=u.reducer;const U=["v5eNzdQsLox","eBlbs7BzVfX","JJ2DQSnlhfR","m64bCKnUD8L","Xar8cTc8XN0","k7eXIuzzhat","JZXI1GzSoYx"],k=["Jio5MTDVFo4","yvOZEiBS5cd","CGp0lKLkSKY","YCILPvLTofG"],N=["j1hbO7zzRgV","sK09QRLNyAA","malZQqUEzi9","qh9bc6jlauE"],j={organisationUnits:{resource:"organisationUnits.json",params:{paging:"false",fields:"id,name,level,children,geometry,organisationUnitGroups,parent[id, displayName]"}}};function S(e,t){return e.name.localeCompare(t.name)}let A={};var D={};function T(){const{loading:e,error:t,data:a,refetch:d}=Object(l.c)(j),[u,E]=Object(r.useState)(null),[y,b]=Object(r.useState)(!1),g=Object(c.b)();var f=[];Object(r.useEffect)(()=>{if(a){const e=a.organisationUnits.organisationUnits,t=a.organisationUnits.organisationUnits.filter(e=>1===e.level)[0];t.children=function e(t,a,r=null){let i=[];for(var c of a){let a=t.find(e=>e.id===c.id);a&&(r&&(D[a.id]||(D[a.id]={}),D[a.id]=r.id),0===a.children.length?a.children=null:a.children=e(t,a.children,a),i.push(Object(n.a)({},a,{active:!1})))}let l=[];for(var c of i)f=[],h(c,5),f.length>0&&(l.push(c),A[c.id]=Object(n.a)({},c,{list:[...f]}));return l.sort(S)}(e,t.children,t),D[t.id]="",E(t)}},[e]);function h(e,t){if(e.level===t&&e.organisationUnitGroups.findIndex(e=>"PTahQgpjqyQ"===e.id)>-1)f.push(Object(n.a)({},e));else if(e.children)for(var a of e.children)A[a.id]?f=f.concat(A[a.id].list):h(a,t)}const O=e=>{f=[],h(e,5);let t=[];for(var a of f)t.push(Object(n.a)({},a,{distance:0,total:null,available:null,geometry:A[a.parent.id]&&A[a.parent.id].geometry&&"Point"===A[a.parent.id].geometry.type?{lat:A[a.parent.id].geometry.coordinates[1],lng:A[a.parent.id].geometry.coordinates[0]}:{lat:0,lng:0},isLoading:!0}));g(v(t)),g(m({id:e.id,name:e.name,level:e.level})),5===e.level&&g(p({id:e.id,beds:[]}))};return i.a.createElement(s.d,null,u&&i.a.createElement(o.Treebeard,{data:u,onToggle:(e,t)=>{y&&(y.active=!1),e.active=!0,e.children&&(e.toggled=t),b(e),E(Object.assign({},u)),O(e)}}))}a(428);var w=a(25);const B=Object(d.b)({name:"notification",initialState:{isOpen:!1,message:null,type:null},reducers:{showNotification(e,t){e.isOpen=!0,e.message=t.payload.message,e.type=t.payload.type},hideNotification(e,t){isOpen=!1,e.message=null,e.type=null}}});var L=B.reducer;const{showNotification:V,hideNotification:P}=B.actions;function R(e,t){let a={};return"Discharged"===t?a={dataElement:"MtYPOv0wqCg",value:"Discharged"}:"Admitted"===t?a={dataElement:"MtYPOv0wqCg",value:"Admitted"}:"Reserved"===t&&(a={dataElement:"MtYPOv0wqCg",value:"Reserved"}),a}function Y(e){if(e.dataValues.length>0)switch(e.dataValues[0].value){case"Discharged":return"AVAILABLE";case"Admitted":return"OCCUPIED";case"Reserved":return"RESERVED"}return""}function z(e,t){return async(a,n,r)=>{try{const n={results:{resource:"trackedEntityInstances",params:{ou:e,fields:"trackedEntityInstance,attributes[attribute,displayName,value],enrollments",program:t}}},c=(await r.query(n)).results.trackedEntityInstances;for(var i of c)a(M(i.trackedEntityInstance));a(y({icuId:e,beds:c}))}catch(c){a(V({message:"failed to load icu bed data",type:"error"})),console.log("Error in query:",c)}}}function M(e){return async(t,a,n)=>{const r={events:{resource:"events",params:{trackedEntityInstance:e,paging:"false",status:"ACTIVE"}}},i=(await n.query(r)).events.events;let c="";if(i.length>0){const a=i[0],n=a.dataValues.findIndex(e=>"MtYPOv0wqCg"===e.dataElement);if(n>-1)switch(a.dataValues[n].value){case"Discharged":c="AVAILABLE";break;case"Admitted":c="OCCUPIED";break;case"Reserved":c="RESERVED"}t(b({bedId:e,status:c,lastEvent:a}))}}}function X(e,t,a,n,r,i=[]){return async(c,l,s)=>{try{const o={events:{resource:"events",params:{trackedEntityInstance:e,paging:"false",status:"ACTIVE"}}},d=await s.query(o);if(d.events.events.length>0){const r={resource:"events",type:"create",data:{event:d.events.events[0].event,trackedEntityInstance:e,program:t,programStage:a,enrollment:n,orgUnit:n,completedDate:w().format("YYYY-MM-DD"),status:"COMPLETED"}};await s.mutate(r)}const u=[R(l().app.metaData.dataElements,r),...i],m={resource:"events",type:"create",data:{trackedEntityInstance:e,program:t,programStage:a,enrollment:n,orgUnit:n,dataValues:u,eventDate:w().format("YYYY-MM-DD"),status:"ACTIVE"}};await s.mutate(m);c(M(e))}catch(o){c(V({message:"error in adding bed event",type:"error"})),console.log("Error in creating:",o)}}}function x(e,t={}){return async(a,n,r)=>{try{a(C({icuId:e.id}));let n="";for(var i in t){if(0===t[i].length)continue;const e=t[i].map(e=>e.value);n+="".concat(i,":IN:").concat(e.join(";"),",")}n=n.substr(0,n.length-1);const l={events:{resource:"events",params:{orgUnit:e.id,paging:"false",status:"ACTIVE"}},filteredTEI:{resource:"trackedEntityInstances",params:{ou:e.id,paging:"false",fields:"trackedEntityInstance",filter:n}},organisationUnit:{resource:"organisationUnits/"+e.id,params:{fields:"id,displayName,parent[displayName, geometry],contactPerson,phoneNumber"}}},s=await r.query(l);let o={available:0,total:0};for(var c of s.events.events){-1!==s.filteredTEI.trackedEntityInstances.findIndex(e=>e.trackedEntityInstance===c.trackedEntityInstance)&&("AVAILABLE"===Y(c)&&o.available++,o.total++)}a(g({icuId:e.id,stat:o,icuName:"".concat(s.organisationUnit.parent.displayName," - ").concat(s.organisationUnit.displayName),contactPerson:s.organisationUnit.contactPerson,contactNumber:s.organisationUnit.phoneNumber}))}catch(l){a(V({message:"error in retrieving ICU status",type:"error"})),console.log("Error in creating:",l)}}}function G(e,t,a){const{setLocationData:n,sortedBy:r,setSortedBy:i,sortOrder:c,setSortOrder:l}=a;let s=t.slice();s=s.sort((t,a)=>{let n=t[e],i=a[e],l=0;return n>i?l=1:n<i&&(l=-1),r===e&&(l=-1*l*c),l}),n(s),i(e),l(-1*c)}function q({data:e,onSelectICU:t}){const[a,n]=Object(r.useState)([]),[l,o]=Object(r.useState)("distance"),[d,u]=Object(r.useState)(1),m=(Object(c.b)(),{setLocationData:n,sortedBy:l,setSortedBy:o,sortOrder:d,setSortOrder:u});return Object(r.useEffect)(()=>{G(l,e,m)},[e]),e?i.a.createElement(s.x,null,i.a.createElement(s.B,null,i.a.createElement(s.C,null,i.a.createElement(s.A,null,i.a.createElement(s.i,{primary:"name"===l,onClick:()=>{G("name",a,m)}},"ICU")),i.a.createElement(s.A,null,i.a.createElement(s.i,{primary:"distance"===l,onClick:()=>{G("distance",a,m)}},"Distance")),i.a.createElement(s.A,null,i.a.createElement(s.i,{primary:"total"===l,onClick:()=>{G("total",a,m)}},"TotalBeds")),i.a.createElement(s.A,null,i.a.createElement(s.i,{primary:"available"===l,onClick:()=>{G("available",a,m)}},"AvailableBeds")))),i.a.createElement(s.y,null,a.map((e,a)=>0===e.total?"":i.a.createElement(s.C,{key:a},i.a.createElement(s.z,null,i.a.createElement("a",{href:"#",onClick:()=>t(e)},e.name)),i.a.createElement(s.z,null,e.distance),i.a.createElement(s.z,null,e.total),i.a.createElement(s.z,null,e.available))))):i.a.createElement("div",null)}var F=a(190);const W=Object(F.combineReducers)({app:I,notification:L});Object(d.a)({reducer:W});var J=a(15);const K="VIEW_ICU",Q="CONFIG_ICU",Z="ADD_EVENT";function _(e,t){for(;D[t]!==e&&(t=D[t],D[t]););return!(!D[t]||D[t]!==e)}function H(e,t){for(var a of e)if(a===t||_(a,t))return!0;return!1}function $(e,t,a){for(var n of e)if(t[n]){if("READ"===a)return t[n].canRead;if("WRITE"===a)return t[n].canWrite}return!1}function ee(e,t,a,n,r){return t.group.indexOf("LkEkMDG0zfj")>-1||(!(e!==K||!$(t.group,n,"READ"))||(!(e!==Q||!H(t.organisationUnits,r)||!$(t.group,n,"WRITE"))||!(e!==Z||!$(t.group,a,"WRITE")||!H(t.organisationUnits,r))))}var te=a(429),ae=a(433);function ne({name:e,status:t,onView:a,onOccupy:n,onDischarge:c,onReserve:l,hasEventPerm:o,onViewPatient:d,hasEditPerm:u}){const m=Object(r.useRef)(null),[p,E]=Object(r.useState)(!1),y=()=>{o&&E(!p)};return i.a.createElement("div",{className:"icu-bed ".concat("AVAILABLE"===t?"available":"OCCUPIED"===t?"occupied":"RESERVED"===t?"reserved":""),ref:m,onClick:y},i.a.createElement(te.a,{icon:ae.a,size:"lg"}),i.a.createElement("span",null,e),p&&Object(J.createPortal)(i.a.createElement(s.u,{onClick:y,transparent:!0},i.a.createElement(s.t,{placement:"right",reference:m},i.a.createElement("div",{className:"bed-options"},("AVAILABLE"===t||"RESERVED"===t)&&i.a.createElement("div",{onClick:()=>{E(!1),n()}},"Occupy"),"AVAILABLE"===t&&i.a.createElement("div",{onClick:()=>{E(!1),l()}},"Reserve"),"AVAILABLE"!==t&&i.a.createElement("div",{onClick:()=>{E(!1),c()}},"Discharge"),i.a.createElement("div",{onClick:a},"View"),u&&("OCCUPIED"===t||"RESERVED"===t)&&i.a.createElement("div",{onClick:d},"View Patient")))),document.body))}const re=[{label:"No",value:"false"},{label:"Yes",value:"true"}],ie=["v5eNzdQsLox","eBlbs7BzVfX","JJ2DQSnlhfR","m64bCKnUD8L","Xar8cTc8XN0","k7eXIuzzhat","JZXI1GzSoYx"],ce=["Jio5MTDVFo4","yvOZEiBS5cd","CGp0lKLkSKY","YCILPvLTofG"],le=["tswabivShTy","Xt5tV6OFSEW","XYNBoDZS0aV"];function se(e,t){const a=e.filter(e=>e.attribute===t);return a.length>0?a[0].value:null}function oe(e,t){return e.filter(e=>e.code===t)[0]}function de({open:e,onClose:t,selectedBed:a,editable:o}){const d=Object(c.c)(e=>e.app.metaData),u=Object(c.c)(e=>e.app.activeICU),[m,p]=Object(r.useState)([]),[E,y]=Object(r.useState)({}),b=(Object(l.b)(),Object(c.b)());if(Object(r.useEffect)(()=>{if(d){let t=d.trackedEntityType.trackedEntityTypeAttributes,n={};for(var e of t){let t=null;if(a&&(t=se(a.attributes,e.id)),"TEXT"===e.valueType)if(e.optionSet&&e.optionSet.options&&e.optionSet.options.length>0)if(t){const a=oe(e.optionSet.options,t);n[e.id]={label:a.displayName,value:a.code}}else n[e.id]={label:e.optionSet.options[0].displayName,value:e.optionSet.options[0].code};else n[e.id]=t||"";else"BOOLEAN"===e.valueType&&(n[e.id]={label:t&&"true"===t?"Yes":"No",value:t||"false"})}y(n),p(t)}},[d]),!e)return i.a.createElement(i.a.Fragment,null);const v=(e,t)=>{y(Object(n.a)({},E,{[e]:t}))},g=(e,t)=>{const a=m.find(t=>t.id===e);return a.optionSet&&a.optionSet.options&&a.optionSet.options.length>0?i.a.createElement(s.v,{key:t,label:a.formName,name:a.id,onChange:e=>v(a.id,e.selected),selected:E[a.id],disabled:!o},a.optionSet.options.map((e,t)=>i.a.createElement(s.w,{key:t,label:e.displayName,value:e.code}))):"TEXT"===a.valueType?i.a.createElement(s.j,{key:t,label:a.formName,name:a.id,type:"text",onChange:e=>v(a.id,e.value),value:E[a.id],disabled:!o}):"BOOLEAN"===a.valueType?i.a.createElement(s.v,{key:t,label:a.formName,name:a.id,onChange:e=>v(a.id,e.selected),selected:E[a.id],disabled:!o},re.map((e,t)=>i.a.createElement(s.w,{key:t,label:e.label,value:e.value}))):void 0};return i.a.createElement(s.m,{open:!0},i.a.createElement(s.p,null,o?a?"Update":"Add":"View"," ICU Bed"),i.a.createElement(s.o,null,m.length>0&&i.a.createElement("div",{className:"form"},le.map((e,t)=>g(e,t)),i.a.createElement("h4",null,"Facilities"),ce.map((e,t)=>g(e,t)),i.a.createElement("h4",null,"Expertise"),ie.map((e,t)=>g(e,t)))),i.a.createElement(s.n,null,i.a.createElement(s.c,{end:!0},i.a.createElement(s.b,{onClick:t,secondary:!0,type:"button"},"Close"),o&&i.a.createElement(s.b,{onClick:async()=>{const e=[];for(var n in E)e.push({attribute:n,value:E[n].value?E[n].value:E[n]});b(a?function(e,t,a){return async(n,r,i)=>{try{const c={resource:"trackedEntityInstances/"+t,type:"update",data:{orgUnit:e,attributes:a}};await i.mutate(c);n(z(e,r().app.metaData.id))}catch(c){n(V({message:"error in updating bed",type:"error"})),console.log("Error in creating:",c)}}}(u.id,a.trackedEntityInstance,e):function(e,t,a,n){return async(r,i,c)=>{try{const l={resource:"trackedEntityInstances",type:"create",data:{trackedEntityType:e,orgUnit:t,attributes:n,enrollments:[{orgUnit:t,program:a,enrollmentDate:w().format("YYYY-MM-DD"),incidentDate:w().format("YYYY-MM-DD")}]}};r(X((await c.mutate(l)).response.importSummaries[0].reference,a,i().app.ICUEventId,t,"Discharged")),r(z(t,a))}catch(l){r(V({message:"error in creating bed",type:"error"})),console.log("Error in creating:",l)}}}(d.trackedEntityType.id,u.id,d.id,e)),t()},primary:!0,type:"button"},a?"Update Bed":"Add New Bed"))))}function ue(){return{show:(e,t,a)=>{confirm(e)?t():a()}}}function me({open:e,onClose:t,selectedBed:a,actionType:l,editable:o}){const[d,u]=Object(r.useState)({}),m=Object(c.b)(),p=Object(c.c)(e=>e.app.metaData),E=Object(c.c)(e=>e.app.ICUEventId),y=Object(c.c)(e=>e.app.activeICU);ue();Object(r.useEffect)(()=>{let e={};for(var t of N){const n=Object.values(p.dataElements).find(e=>e.id===t);"TEXT"===n.type&&(!o&&a.lastEvent?e[n.id]=a.lastEvent.dataValues.find(e=>e.dataElement===n.id).value:e[n.id]="")}u(e)},[a]);const b=(e,t)=>{const a=Object.values(p.dataElements).find(t=>t.id===e);if("TEXT"===a.type)return i.a.createElement(s.j,{key:t,label:a.formName,name:a.id,onChange:e=>((e,t)=>{u(Object(n.a)({},d,{[e]:t}))})(a.id,e.value),value:d[a.id],disabled:!o})};return i.a.createElement(s.m,{open:!0},i.a.createElement(s.p,null,o&&i.a.createElement("span",null,"admit"===l?"Admit":"Reserve"," New Patient"),!o&&i.a.createElement("span",null,"View Patient")),i.a.createElement(s.o,null,N.map((e,t)=>b(e,t))),i.a.createElement(s.n,null,i.a.createElement(s.c,{end:!0},i.a.createElement(s.b,{onClick:t,secondary:!0,type:"button"},"Close"),o&&i.a.createElement(s.b,{onClick:()=>{let e=[];for(var n in d)e.push({dataElement:n,value:d[n]});"admit"===l?m(X(a.trackedEntityInstance,p.id,E,y.id,"Admitted",e)):"reserve"===l&&m(X(a.trackedEntityInstance,p.id,E,y.id,"Reserved",e)),t()},primary:!0,type:"button"},"admit"===l?"Admit":"Reserve"," Patient"))))}var pe=a(434);const Ee={height:"600px",width:"100%"},ye={lat:8.11,lng:80.77},be=Object(n.a)({visible:!1},ye);function ve(e){const{onMarkerClick:t,data:a,origin:c,updateDistance:l}=e,[s,o]=Object(r.useState)(be),[d,u]=Object(r.useState)(null),[m,p]=Object(r.useState)(null);Object(r.useEffect)(()=>{if(a){let t=[],n=[],r={};for(var e of a)r[e.parent.id]||(t.push({id:e.parent.id,name:e.parent.displayName,geometry:e.geometry,icus:[]}),r[e.parent.id]=!0),t.find(t=>t.id===e.parent.id).icus.push(e.name),n.push(e.geometry);let i=null;c&&(i={origins:[{lat:c[1],lng:c[0]}],destinations:n,travelMode:"DRIVING"}),u(t),p(i)}},[a.length,c]);const E=e=>{o(Object(n.a)({visible:!0},e))},y={icon:{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30 a 2,2 0 1,1 4,0 2,2 0 1,1 -4,0",fillColor:"green",fillOpacity:1,strokeColor:"#000",strokeWeight:1,scale:1}};return i.a.createElement(pe.d,{id:"script-loader",googleMapsApiKey:"AIzaSyBjlDmwuON9lJbPMDlh_LI3zGpGtpK9erc"},d&&i.a.createElement(pe.b,{id:"example-map",mapContainerStyle:Ee,zoom:7.6,center:ye},d.map((e,a)=>i.a.createElement(pe.e,{position:{lat:e.geometry.lat,lng:e.geometry.lng},onClick:()=>{t(e)},onMouseOver:()=>{E(e)},onMouseOut:()=>{E(be)},options:y,key:a})),s.visible&&i.a.createElement(pe.c,{position:{lat:s.geometry.lat,lng:s.geometry.lng},options:{closeBoxURL:""}},i.a.createElement("div",{style:{backgroundColor:"white",opacity:.95,padding:5}},i.a.createElement("div",{style:{fontSize:14,fontColor:"#08233B"}},i.a.createElement("div",null,"Hospital: ",s.name),i.a.createElement("div",null,i.a.createElement("b",null,"ICUs")),s.icus.map(e=>i.a.createElement("div",null,e)))))),m&&i.a.createElement(pe.a,{options:m,callback:(e,t)=>l(e,t)}))}function ge(e){const{isOpen:t,message:a,type:n}=Object(c.c)(e=>e.notification);return t?i.a.createElement(s.a,{duration:5e3,icon:!0,critical:"error"===n,warning:"warning"===n,success:"success"===n},a):null}function fe(e,t){for(var a of e.attributes)if(a.displayName===t)return a.value;return""}function he(){const e=Object(c.c)(e=>e.app.activeOrgUnit),t=Object(c.c)(e=>e.app.activeUser),a=Object(c.c)(e=>e.app.icuList),l=Object(c.c)(e=>e.app.metaData),[o,d]=Object(r.useState)(!0),[u,E]=Object(r.useState)(!0),y=Object(c.b)();let b=null,v=null;l&&(b=l.trackedEntityType.trackedEntityTypeAttributes.find(({id:e})=>"XYNBoDZS0aV"===e),v=l.trackedEntityType.trackedEntityTypeAttributes.find(({id:e})=>"Xt5tV6OFSEW"===e));const[f,O]=Object(r.useState)({XYNBoDZS0aV:[],Xt5tV6OFSEW:[]});if(Object(r.useEffect)(()=>{if(a){for(var e of a)null===e.total&&(y(x(e,f)),y(g({icuId:e.id,stat:{total:"Updating...",available:null}})));let t=!1;for(var e of(E(!0),a))if(e.isLoading){t=!0;break}d(t)}},[a]),Object(r.useEffect)(()=>{if(a)for(var e of a)y(x(e,f))},[f]),!e)return i.a.createElement("p",null,"Please select an organization unit");if(5===e.level)return i.a.createElement(Oe,null);return e.level<6&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"t20"},"Showing ICU Locations for ",i.a.createElement("b",null,e.name)),i.a.createElement("div",{className:"filter-area"},i.a.createElement(s.q,{selected:f.XYNBoDZS0aV,placeholder:b.displayName,onChange:({selected:e})=>{O(Object(n.a)({},f,{XYNBoDZS0aV:e}))}},b&&b.optionSet.options.map((e,t)=>i.a.createElement(s.r,{className:"multiselect-bedtype",key:t,value:e.code,label:e.displayName}))),i.a.createElement(s.q,{selected:f.Xt5tV6OFSEW,placeholder:v.displayName,onChange:({selected:e})=>{O(Object(n.a)({},f,{Xt5tV6OFSEW:e}))}},v&&v.optionSet.options.map((e,t)=>i.a.createElement(s.r,{key:t,value:e.code,label:e.displayName})))),i.a.createElement("div",{className:"icu-org"},(o||u)&&i.a.createElement("div",{className:"icu-table"},i.a.createElement("p",null,"Loading ICU stat, please wait...")),!(o||u)&&i.a.createElement("div",{className:"icu-table"},i.a.createElement(q,{data:a,onSelectICU:e=>{y(m({id:e.id,name:e.name,level:e.level})),y(p({id:e.id,beds:[]}))}})),i.a.createElement("div",{className:"icu-map"},i.a.createElement(ve,{onMarkerClick:e=>{console.log(e)},data:a.filter(e=>0!==e.total),origin:t.origin,updateDistance:(e,t)=>{try{if(e&&e.rows&&e.rows.length>0&&e.rows[0].elements&&e.rows[0].elements.length===a.length)for(var n in a)"OK"===e.rows[0].elements[n].status&&y(h({icuId:a[n].id,distance:"".concat(e.rows[0].elements[n].distance.text," (").concat(e.rows[0].elements[n].duration.text,")")}))}catch(r){}E(!1)}}))))}function Oe(){const e=Object(c.c)(e=>e.app.activeUser),t=Object(c.c)(e=>e.app.activeOrgUnit),a=Object(c.c)(e=>e.app.activeICU),n=Object(c.c)(e=>e.app.metaData),l=Object(c.c)(e=>e.app.ICUEventId),[o,d]=Object(r.useState)(!1),[u,m]=Object(r.useState)(!1),[p,E]=Object(r.useState)(!1),[y,b]=Object(r.useState)("admit"),[v,g]=Object(r.useState)(null),[f,h]=Object(r.useState)(!1),[C,I]=Object(r.useState)(!0),N=Object(c.b)(),j=ue();Object(r.useEffect)(()=>{var t;n&&(N(z(a.id,n.id)),N((t=a.id,async(e,a,n)=>{try{const a={organisationUnit:{resource:"organisationUnits/"+t,params:{fields:"id,contactPerson,phoneNumber"}}},r=await n.query(a);e(O({icuId:t,contactPerson:r.organisationUnit.contactPerson,contactNumber:r.organisationUnit.phoneNumber}))}catch(r){e(V({message:"error in retrieving ICU data",type:"error"})),console.log("Error in creating:",r)}})),ee(Z,e,n.programAccess,n.trackedEntityType.access,a.id)&&h(!0))},[n,a.id]);if(!t)return i.a.createElement("p",null,"Please select an organization unit");const S=(e,t,a)=>"true"===e.attributes.find(e=>e.attribute===t).value?i.a.createElement("p",{key:a},n.trackedEntityType.trackedEntityTypeAttributes.find(e=>e.id===t).formName):"";return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"inner-header"},i.a.createElement("span",{className:"t20"},"Showing ICU Bed status at ",i.a.createElement("b",null,t.name)),ee(Q,e,n.programAccess,n.trackedEntityType.access,a.id)&&i.a.createElement(s.b,{onClick:()=>d(!0),className:"pull-right"},"Configure Beds")),i.a.createElement("div",{className:"info"},a.beds.length>0&&i.a.createElement("div",{className:"contact"},i.a.createElement("p",null,i.a.createElement("b",null,"Facilities")),k.map((e,t)=>S(a.beds[0],e,t))),a.beds.length>0&&i.a.createElement("div",{className:"contact"},i.a.createElement("p",null,i.a.createElement("b",null,"Expertise")),U.map((e,t)=>S(a.beds[0],e,t))),i.a.createElement("div",{className:"contact"},i.a.createElement("p",null,i.a.createElement("b",null,"Primary Contact")),i.a.createElement("p",null,a.contactPerson?a.contactPerson:"No contact person listed"),i.a.createElement("p",null,a.contactNumber?a.contactNumber:"No contact number listed"))),a&&i.a.createElement(i.a.Fragment,null,o&&i.a.createElement(Ce,{onBack:()=>d(!1)}),!o&&i.a.createElement("div",{className:"icu-bed-container"},!a.beds.length&&i.a.createElement("p",null,"No beds currently added"),a.beds.map((t,r)=>i.a.createElement(ne,{key:r,name:fe(t,"ICU - Bed Number"),status:t.status?t.status:"IDLE",onView:()=>(e=>{g(e),m(!0)})(t),onOccupy:()=>(e=>{g(e),I(!0),b("admit"),E(!0)})(t),onDischarge:()=>(e=>{j.show("Do you want to confirm discharging this bed?",()=>N(X(e.trackedEntityInstance,n.id,l,a.id,"Discharged")),()=>{})})(t),onReserve:()=>(e=>{g(e),I(!0),b("reserve"),E(!0)})(t),onViewPatient:()=>(e=>{g(e),I(!1),E(!0)})(t),hasEventPerm:f,hasEditPerm:ee(Q,e,n.programAccess,n.trackedEntityType.access,a.id)})))),u&&i.a.createElement(de,{open:u,onClose:()=>m(!1),selectedBed:v,editable:!1}),p&&i.a.createElement(me,{open:p,onClose:()=>E(!1),selectedBed:v,actionType:y,editable:C}))}function Ce({onBack:e}){const[t,a]=Object(r.useState)(!1),n=Object(c.b)(),l=Object(c.c)(e=>e.app.activeICU),[o,d]=(Object(c.c)(e=>e.app.metaData),Object(r.useState)(null)),u=ue(),m=e=>{u.show("Do you really want to remove this bed?",()=>{var t,a;n((t=l.id,a=e.enrollments[0].enrollment,async(e,n,r)=>{try{const i={resource:"enrollments/"+a,type:"delete"};await r.mutate(i),e(z(t,n().app.metaData.id))}catch(i){e(V({message:"error in deleting bed",type:"error"})),console.log("Error in creating:",i)}}))},()=>{})};return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"inner-header"},i.a.createElement(s.c,{end:!0},i.a.createElement(s.b,{onClick:e},"Back"),i.a.createElement(s.b,{primary:!0,onClick:()=>{d(null),a(!0)}},"Add New Bed"))),i.a.createElement("div",{className:"inner-container"},i.a.createElement(s.x,null,i.a.createElement(s.B,null,i.a.createElement(s.C,null,i.a.createElement(s.A,null,"Bed No"),i.a.createElement(s.A,null,"Bed Type"),i.a.createElement(s.A,null,"Covid Type"),i.a.createElement(s.A,null,"Action"))),l&&i.a.createElement(s.y,null,l.beds.map((e,t)=>i.a.createElement(s.C,{key:t},i.a.createElement(s.z,null,fe(e,"ICU - Bed Number")),i.a.createElement(s.z,null,fe(e,"ICU - Type")),i.a.createElement(s.z,null,fe(e,"ICU - COVID Type")),i.a.createElement(s.z,null,i.a.createElement(s.c,null,i.a.createElement(s.b,{onClick:()=>(e=>{d(e),a(!0)})(e)},"View Details"),i.a.createElement(s.b,{destructive:!0,onClick:()=>m(e)},"Remove")))))))),t&&i.a.createElement(de,{open:t,onClose:()=>a(!1),selectedBed:o,editable:!0}))}function Ie({children:e}){const t=Object(c.b)();return Object(r.useEffect)(()=>{t(async(e,t,a)=>{try{const t={program:{resource:"programs/C1wTfmmMQUn",params:{fields:"id,name,userGroupAccesses,trackedEntityType[id, displayName, userGroupAccesses, trackedEntityTypeAttributes[trackedEntityAttribute[id, displayName, formName, valueType, optionSet[options[displayName, id, code]]]]]"}},dataElements:{resource:"dataElements",params:{paging:"false",program:"C1wTfmmMQUn",fields:"id,displayName,displayFormName,valueType,optionSet[options[id, displayName, code]]"}}},{program:c,dataElements:l}=await a.query(t);let s={id:c.id,name:c.name,trackedEntityType:{id:c.trackedEntityType.id,displayName:c.trackedEntityType.displayName,trackedEntityTypeAttributes:[]}},o={};for(var n of c.userGroupAccesses)o[n.userGroupUid]={canRead:n.access.startsWith("rw"),canWrite:n.access.startsWith("rwrw")};for(var r of(s.programAccess=o,c.trackedEntityType.trackedEntityTypeAttributes))s.trackedEntityType.trackedEntityTypeAttributes.push(r.trackedEntityAttribute);let d={};for(var n of c.trackedEntityType.userGroupAccesses)d[n.userGroupUid]={canRead:n.access.startsWith("rw"),canWrite:n.access.startsWith("rwrw")};s.trackedEntityType.access=d;let u={};for(var i of l.dataElements)if(i.displayName.startsWith("ICU")){let e={id:i.id,displayName:i.displayName,formName:i.displayFormName,type:i.valueType};i.optionSet&&(e.options=i.optionSet.options),u[i.displayName]=e}s.dataElements=u,e(E(s))}catch(c){e(V({message:"failed to load metadata",type:"error"})),console.log("Error in query:",c)}}),t(async(e,t,a)=>{try{const t={user:{resource:"me",params:{fields:"id,displayName,userGroups,organisationUnits[id, geometry]"}}},{user:n}=await a.query(t);e(f({id:n.id,name:n.displayName,group:n.userGroups.length>0?n.userGroups.map(e=>e.id):null,organisationUnits:n.organisationUnits.map(e=>e.id),origin:n.organisationUnits.length>0&&n.organisationUnits[0].geometry&&"Point"===n.organisationUnits[0].geometry.type?n.organisationUnits[0].geometry.coordinates:null}))}catch(n){e(V({message:"Error loading user",type:"error"})),console.log("Error in query:",n)}})},[]),i.a.createElement("div",{style:{height:"100vh"}},e)}t.default=function(){const e=Object(l.b)(),t=Object(d.c)({thunk:{extraArgument:e}}),a=Object(d.a)({reducer:W,middleware:t});return i.a.createElement(c.a,{store:a},i.a.createElement(Ie,null,i.a.createElement("div",{className:"container"},i.a.createElement("div",{className:"left-column"},i.a.createElement(T,null)),i.a.createElement("div",{className:"right-column"},i.a.createElement(he,null))),i.a.createElement("div",{style:{bottom:0,left:0,paddingLeft:16,position:"fixed",width:"60%"}},i.a.createElement(ge,null))))}}}]);
//# sourceMappingURL=app.6d3c0fbb.chunk.js.map