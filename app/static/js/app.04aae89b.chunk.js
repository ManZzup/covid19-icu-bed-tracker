(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{428:function(e,t,a){},430:function(e,t,a){"use strict";a.r(t);var n=a(1),l=a.n(n),c=a(201),r=a(17),i=(a(7),a(203)),o=a(5),s=a(272),d=a(230);const u=Object(d.b)({name:"app",initialState:{activeOrgUnit:null,activeICU:null,metaData:null,icuList:[],ICUEventId:"fKXrko0yhua"},reducers:{setActiveOrgUnit(e,t){e.activeOrgUnit=t.payload},setActiveICU(e,t){e.activeICU=t.payload},setMetaData(e,t){e.metaData=t.payload},setICUBeds(e,t){e.activeICU&&e.activeICU.id===t.payload.icuId&&(e.activeICU.beds=t.payload.beds)},updateBedStatus(e,t){const a=e.activeICU.beds.findIndex(e=>e.trackedEntityInstance===t.payload.bedId);e.activeICU.beds[a].status=t.payload.status},updateFilteredICUList(e,t){e.icuList=t.payload}}}),{setActiveOrgUnit:m,setActiveICU:p,setMetaData:E,setICUBeds:y,updateBedStatus:b,updateFilteredICUList:v}=u.actions;var f=u.reducer;const g={organisationUnits:{resource:"organisationUnits.json",params:{paging:"false",fields:"id,name,level,children"}}};function h(){const{loading:e,error:t,data:a,refetch:d}=Object(r.c)(g),[u,E]=Object(n.useState)(null),[y,b]=Object(n.useState)(!1),f=Object(c.b)();var h=[];Object(n.useEffect)(()=>{if(a){const e=a.organisationUnits.organisationUnits,t=a.organisationUnits.organisationUnits.filter(e=>1===e.level)[0];t.children=function e(t,a){let n=[];for(var l of a){let a=t.filter(e=>e.id===l.id);1===a.length&&(a=a[0],0===a.children.length?a.children=null:a.children=e(t,a.children),n.push(Object(i.a)({},a,{active:!1})))}let c=[];for(var l of n)h=[],C(l,6),h.length>0&&c.push(l);return c}(e,t.children),console.log(t),E(t)}},[e]);function C(e,t){if(e.level!==t){if(e.children)for(var a of e.children)C(a,t)}else h.push(Object(i.a)({},e))}const O=e=>{h=[],C(e,6);let t=[];for(var a of h)t.push({name:a.name,distance:0,total:0,available:0});f(v(t)),f(m({id:e.id,name:e.name,level:e.level})),6===e.level&&f(p({id:e.id,beds:[]}))};return l.a.createElement(o.c,null,u&&l.a.createElement(s.Treebeard,{data:u,onToggle:(e,t)=>{y&&(y.active=!1),e.active=!0,e.children&&(e.toggled=t),b(e),E(Object.assign({},u)),O(e)}}))}a(428);function C(e,t,a){const{setLocationData:n,sortedBy:l,setSortedBy:c,sortOrder:r,setSortOrder:i}=a;let o=t.slice();o=o.sort((t,a)=>{let n=t[e],c=a[e],i=0;return n>c?i=1:n<c&&(i=-1),l===e&&(i=-1*i*r),i}),n(o),c(e),i(-1*r)}function O({data:e}){const[t,a]=Object(n.useState)([]),[c,r]=Object(n.useState)("distance"),[i,s]=Object(n.useState)(1),d={setLocationData:a,sortedBy:c,setSortedBy:r,sortOrder:i,setSortOrder:s};return Object(n.useEffect)(()=>{C(c,e,d)},[e]),e?l.a.createElement(o.w,null,l.a.createElement(o.A,null,l.a.createElement(o.B,null,l.a.createElement(o.z,null,l.a.createElement(o.h,{primary:"name"===c,onClick:()=>{C("name",t,d)}},"ICU")),l.a.createElement(o.z,null,l.a.createElement(o.h,{primary:"distance"===c,onClick:()=>{C("distance",t,d)}},"Distance")),l.a.createElement(o.z,null,l.a.createElement(o.h,{primary:"total"===c,onClick:()=>{C("total",t,d)}},"TotalBeds")),l.a.createElement(o.z,null,l.a.createElement(o.h,{primary:"available"===c,onClick:()=>{C("available",t,d)}},"AvailableBeds")),l.a.createElement(o.z,null,"  Contact "))),l.a.createElement(o.x,null,t.map((e,t)=>l.a.createElement(o.B,{key:t},l.a.createElement(o.y,null,e.name),l.a.createElement(o.y,null,e.distance),l.a.createElement(o.y,null,e.total),l.a.createElement(o.y,null,e.available),l.a.createElement(o.y,null,l.a.createElement("p",null,"Dr. John Doe"),l.a.createElement("p",null,"+94771234568"),l.a.createElement("p",null,"+94717894562")))))):l.a.createElement("div",null)}var k=a(188);const I=Object(k.combineReducers)({app:f});Object(d.a)({reducer:I});var j=a(15);function U({name:e,status:t,onView:a,onOccupy:c,onDischarge:r,onReserve:i}){const s=Object(n.useRef)(null),[d,u]=Object(n.useState)(!1),m=()=>{u(!d)};return l.a.createElement("div",{className:"icu-bed ".concat("AVAILABLE"===t?"available":"OCCUPIED"===t?"occupied":"RESERVED"===t?"reserved":""),ref:s,onClick:m},l.a.createElement("span",null,e),d&&Object(j.createPortal)(l.a.createElement(o.t,{onClick:m,transparent:!0},l.a.createElement(o.s,{placement:"right",reference:s},l.a.createElement("div",{className:"bed-options"},("AVAILABLE"===t||"RESERVED"===t)&&l.a.createElement("div",{onClick:()=>{u(!1),c()}},"Occupy"),"AVAILABLE"===t&&l.a.createElement("div",{onClick:()=>{u(!1),i()}},"Reserve"),"AVAILABLE"!==t&&l.a.createElement("div",{onClick:()=>{u(!1),r()}},"Discharge"),l.a.createElement("div",{onClick:a},"View")))),document.body))}var N=a(25);const T="ICU - Bed Event";function D(e,t){let a={};return"Discharged"===t?a={dataElement:e[T].id,value:"Discharged"}:"Admitted"===t?a={dataElement:e[T].id,value:"Admitted"}:"Reserved"===t&&(a={dataElement:e[T].id,value:"Reserved"}),a}function S(e,t){return async(a,n,l)=>{try{const n={results:{resource:"trackedEntityInstances",params:{ou:e,fields:"trackedEntityInstance,attributes[attribute,displayName,value],enrollments",program:t}}},r=(await l.query(n)).results.trackedEntityInstances;for(var c of r)a(A(c.trackedEntityInstance));a(y({icuId:e,beds:r}))}catch(r){console.log("Error in query:",r)}}}function A(e){return async(t,a,n)=>{const l={events:{resource:"events",params:{trackedEntityInstance:e,paging:"false"}}},c=(await n.query(l)).events.events;let r="";if(c.length>0){const n=c[0],l=n.dataValues.findIndex(e=>e.dataElement===a().app.metaData.dataElements[T].id);if(l>-1)switch(n.dataValues[l].value){case"Discharged":r="AVAILABLE";break;case"Admitted":r="OCCUPIED";break;case"Reserved":r="RESERVED"}t(b({bedId:e,status:r}))}}}function B(e,t,a,n,l,c=[]){return async(r,i,o)=>{try{const s=[D(i().app.metaData.dataElements,l),...c],d={resource:"events",type:"create",data:{trackedEntityInstance:e,program:t,programStage:a,enrollment:n,orgUnit:n,dataValues:s,status:"COMPLETED"}};await o.mutate(d);r(A(e))}catch(s){console.log("Error in creating:",s)}}}const w=[{label:"No",value:"false"},{label:"Yes",value:"true"}];function L(e,t){const a=e.filter(e=>e.attribute===t);return a.length>0?a[0].value:null}function z(e,t){return e.filter(e=>e.code===t)[0]}function R({open:e,onClose:t,selectedBed:a,editable:s}){const d=Object(c.c)(e=>e.app.metaData),u=Object(c.c)(e=>e.app.activeICU),[m,p]=Object(n.useState)([]),[E,y]=Object(n.useState)({}),b=(Object(r.b)(),Object(c.b)());if(Object(n.useEffect)(()=>{if(d){let t=d.trackedEntityType.trackedEntityTypeAttributes,n={};for(var e of t){let t=null;if(a&&(t=L(a.attributes,e.id)),"TEXT"===e.valueType)if(e.optionSet&&e.optionSet.options&&e.optionSet.options.length>0)if(t){const a=z(e.optionSet.options,t);n[e.id]={label:a.displayName,value:a.code}}else n[e.id]={label:e.optionSet.options[0].displayName,value:e.optionSet.options[0].code};else n[e.id]=t||"";else"BOOLEAN"===e.valueType&&(n[e.id]={label:t&&"true"===t?"Yes":"No",value:t||"false"})}y(n),p(t)}},[d]),!e)return l.a.createElement(l.a.Fragment,null);const v=(e,t)=>{y(Object(i.a)({},E,{[e]:t}))};return l.a.createElement(o.l,{open:!0},l.a.createElement(o.o,null,s?a?"Update":"Add":"View"," ICU Bed"),l.a.createElement(o.n,null,l.a.createElement("div",{className:"form"},m.map((e,t)=>((e,t)=>e.optionSet&&e.optionSet.options&&e.optionSet.options.length>0?l.a.createElement(o.u,{key:t,label:e.displayName,name:e.id,onChange:t=>v(e.id,t.selected),selected:E[e.id],disabled:!s},e.optionSet.options.map((e,t)=>l.a.createElement(o.v,{key:t,label:e.displayName,value:e.code}))):"TEXT"===e.valueType?l.a.createElement(o.i,{key:t,label:e.displayName,name:e.id,type:"text",onChange:t=>v(e.id,t.value),value:E[e.id],disabled:!s}):"BOOLEAN"===e.valueType?l.a.createElement(o.u,{key:t,label:e.displayName,name:e.id,onChange:t=>v(e.id,t.selected),selected:E[e.id],disabled:!s},w.map((e,t)=>l.a.createElement(o.v,{key:t,label:e.label,value:e.value}))):void 0)(e,t)))),l.a.createElement(o.m,null,l.a.createElement(o.b,{end:!0},l.a.createElement(o.a,{onClick:t,secondary:!0,type:"button"},"Close"),s&&l.a.createElement(o.a,{onClick:async()=>{const e=[];for(var n in E)e.push({attribute:n,value:E[n].value?E[n].value:E[n]});b(a?function(e,t,a){return async(n,l,c)=>{try{const r={resource:"trackedEntityInstances/"+t,type:"update",data:{orgUnit:e,attributes:a}};await c.mutate(r);n(S(e,l().app.metaData.id))}catch(r){console.log("Error in creating:",r)}}}(u.id,a.trackedEntityInstance,e):function(e,t,a,n){return async(l,c,r)=>{try{const i={resource:"trackedEntityInstances",type:"create",data:{trackedEntityType:e,orgUnit:t,attributes:n,enrollments:[{orgUnit:t,program:a,enrollmentDate:N().format("YYYY-MM-DD"),incidentDate:N().format("YYYY-MM-DD")}]}};l(B((await r.mutate(i)).response.importSummaries[0].reference,a,c().app.ICUEventId,t,"Discharged")),l(S(t,a))}catch(i){console.log("Error in creating:",i)}}}(d.trackedEntityType.id,u.id,d.id,e)),t()},primary:!0,type:"button"},a?"Update Bed":"Add New Bed"))))}function M(){return{show:(e,t,a)=>{confirm(e)?t():a()}}}const V=[{type:"TEXT",label:"ICU - BHT Number",id:"j1hbO7zzRgV"},{type:"TEXT",label:"ICU - Patient Name",id:"sK09QRLNyAA"},{type:"TEXT",label:"ICU - Consultant In-charge",id:"malZQqUEzi9"},{type:"TEXT",label:"ICU - Patient Diagnosis",id:"qh9bc6jlauE"}];function q({open:e,onClose:t,selectedBed:a}){const[r,s]=Object(n.useState)({}),d=Object(c.b)(),u=Object(c.c)(e=>e.app.metaData),m=Object(c.c)(e=>e.app.ICUEventId),p=Object(c.c)(e=>e.app.activeICU);M();Object(n.useEffect)(()=>{let e={};for(var t of V)"TEXT"===t.type&&(e[t.id]="");s(e)},[]);const E=(e,t)=>{if("TEXT"===e.type)return l.a.createElement(o.i,{key:t,label:e.label,name:e.id,onChange:t=>((e,t)=>{s(Object(i.a)({},r,{[e]:t}))})(e.id,t.value),value:r[e.id]})};return l.a.createElement(o.l,{open:!0},l.a.createElement(o.o,null,"Admit New Patient"),l.a.createElement(o.n,null,V.map((e,t)=>E(e,t))),l.a.createElement(o.m,null,l.a.createElement(o.b,{end:!0},l.a.createElement(o.a,{onClick:t,secondary:!0,type:"button"},"Close"),l.a.createElement(o.a,{onClick:()=>{let e=[];for(var n in r)e.push({dataElement:n,value:r[n]});d(B(a.trackedEntityInstance,u.id,m,p.id,"Admitted",e)),t()},primary:!0,type:"button"},"Admit Patient"))))}var P=a(429);const Y={height:"600px",width:"100%"},x={lat:8.11,lng:80.77},X=Object(i.a)({visible:!1},x);function F(e){const{onMarkerClick:t,data:a}=e,[c,r]=Object(n.useState)(X),o=e=>{r(Object(i.a)({visible:!0},e))},s={icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#00802b",fillOpacity:1,strokeColor:"",strokeWeight:0}},d={icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#DC143C",fillOpacity:1,strokeColor:"",strokeWeight:0}};return l.a.createElement(P.c,{id:"script-loader",googleMapsApiKey:"AIzaSyBjlDmwuON9lJbPMDlh_LI3zGpGtpK9erc"},l.a.createElement(P.a,{id:"example-map",mapContainerStyle:Y,zoom:7.6,center:x},a.map((e,a)=>l.a.createElement(P.d,{position:{lat:e.lat,lng:e.lng},onClick:()=>{t(e)},onMouseOver:()=>{o(e)},onMouseOut:()=>{o(X)},options:e.available>0?s:d})),c.visible&&l.a.createElement(P.b,{position:c,options:{closeBoxURL:""}},l.a.createElement("div",{style:{backgroundColor:"white",opacity:.95,padding:5}},l.a.createElement("div",{style:{fontSize:14,fontColor:"#08233B"}},l.a.createElement("div",null,"ICU: ",c.name),l.a.createElement("div",null,"Distance: ",c.distance),l.a.createElement("div",null,"Beds: ",c.available))))))}function J(e,t){for(var a of e.attributes)if(a.displayName===t)return a.value;return""}function K(){const e=Object(c.c)(e=>e.app.activeOrgUnit),t=Object(c.c)(e=>e.app.icuList);Object(n.useEffect)(()=>{},[]);const a=()=>{};return e?6===e.level?l.a.createElement(Q,null):e.level<6&&l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"t20"},"Showing ICU Locations for ",l.a.createElement("b",null,e.name)),l.a.createElement("div",{className:"filter-area"},l.a.createElement(o.p,{placeholder:"ICU Type",onChange:a},l.a.createElement(o.q,{value:"type01",label:"Medical"}),l.a.createElement(o.q,{value:"type01",label:"Surgical"}),l.a.createElement(o.q,{value:"type01",label:"Neurosurgical"}),l.a.createElement(o.q,{value:"type01",label:"Pediatric"}),l.a.createElement(o.q,{value:"type01",label:"Neonatal"}),l.a.createElement(o.q,{value:"type01",label:"Other"})),l.a.createElement(o.p,{placeholder:"Bed Type",onChange:a},l.a.createElement(o.q,{value:"type01",label:"Type 01",onClick:a})),l.a.createElement(o.p,{placeholder:"Diagnosis Type",onChange:a},l.a.createElement(o.q,{value:"type01",label:"Type 01",onClick:a}))),l.a.createElement("div",{className:"icu-org"},l.a.createElement("div",{className:"icu-table"},l.a.createElement(O,{data:t})),l.a.createElement("div",{className:"icu-map"},l.a.createElement(F,{onMarkerClick:e=>{console.log(e)},data:t})))):l.a.createElement("p",null,"Please select an organization unit")}function Q(){const e=Object(c.c)(e=>e.app.activeOrgUnit),t=Object(c.c)(e=>e.app.activeICU),a=Object(c.c)(e=>e.app.metaData),r=Object(c.c)(e=>e.app.ICUEventId),[i,s]=Object(n.useState)(!1),[d,u]=Object(n.useState)(!1),[m,p]=Object(n.useState)(!1),[E,y]=Object(n.useState)(null),b=Object(c.b)(),v=M();Object(n.useEffect)(()=>{a&&b(S(t.id,a.id))},[a,t.id]);return e?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"inner-header"},l.a.createElement("span",{className:"t20"},"Showing ICU Bed status at ",l.a.createElement("b",null,e.name)),l.a.createElement(o.a,{onClick:()=>s(!0),className:"pull-right"},"Configure Beds")),t&&l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(W,{onBack:()=>s(!1)}),!i&&l.a.createElement("div",{className:"icu-bed-container"},!t.beds.length&&l.a.createElement("p",null,"No beds currently added"),t.beds.map((e,n)=>l.a.createElement(U,{key:n,name:J(e,"ICU - Bed Number"),status:e.status?e.status:"IDLE",onView:()=>(e=>{y(e),u(!0)})(e),onOccupy:()=>(e=>{y(e),p(!0)})(e),onDischarge:()=>(e=>{v.show("Do you want to confirm discharging this bed?",()=>b(B(e.trackedEntityInstance,a.id,r,t.id,"Discharged")),()=>{})})(e),onReserve:()=>(e=>{v.show("Do you want to confirm reserving this bed?",()=>b(B(e.trackedEntityInstance,a.id,r,t.id,"Reserved")),()=>{})})(e)})))),d&&l.a.createElement(R,{open:d,onClose:()=>u(!1),selectedBed:E,editable:!1}),m&&l.a.createElement(q,{open:m,onClose:()=>p(!1),selectedBed:E})):l.a.createElement("p",null,"Please select an organization unit")}function W({onBack:e}){const[t,a]=Object(n.useState)(!1),r=Object(c.b)(),i=Object(c.c)(e=>e.app.activeICU),[s,d]=(Object(c.c)(e=>e.app.metaData),Object(n.useState)(null)),u=M(),m=e=>{u.show("Do you really want to remove this bed?",()=>{var t,a;r((t=i.id,a=e.enrollments[0].enrollment,async(e,n,l)=>{try{const c={resource:"enrollments/"+a,type:"delete"};await l.mutate(c),e(S(t,n().app.metaData.id))}catch(c){console.log("Error in creating:",c)}}))},()=>{})};return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"inner-header"},l.a.createElement(o.b,{end:!0},l.a.createElement(o.a,{onClick:e},"Back"),l.a.createElement(o.a,{primary:!0,onClick:()=>{d(null),a(!0)}},"Add New Bed"))),l.a.createElement("div",{className:"inner-container"},l.a.createElement(o.w,null,l.a.createElement(o.A,null,l.a.createElement(o.B,null,l.a.createElement(o.z,null,"Bed No"),l.a.createElement(o.z,null,"Bed Type"),l.a.createElement(o.z,null,"Covid Type"),l.a.createElement(o.z,null,"Action"))),i&&l.a.createElement(o.x,null,i.beds.map((e,t)=>l.a.createElement(o.B,{key:t},l.a.createElement(o.y,null,J(e,"ICU - Bed Number")),l.a.createElement(o.y,null,J(e,"ICU - Type")),l.a.createElement(o.y,null,J(e,"ICU - COVID Type")),l.a.createElement(o.y,null,l.a.createElement(o.b,null,l.a.createElement(o.a,{onClick:()=>(e=>{d(e),a(!0)})(e)},"View Details"),l.a.createElement(o.a,{destructive:!0,onClick:()=>m(e)},"Remove")))))))),t&&l.a.createElement(R,{open:t,onClose:()=>a(!1),selectedBed:s,editable:!0}))}function G({children:e}){const t=Object(c.b)();return Object(n.useEffect)(()=>{t(async(e,t,a)=>{try{const t={program:{resource:"programs/C1wTfmmMQUn",params:{fields:"id,name,trackedEntityType[id, displayName, trackedEntityTypeAttributes[trackedEntityAttribute[id, displayName, valueType, optionSet[options[displayName, id, code]]]]]"}},dataElements:{resource:"dataElements",params:{paging:"false",program:"C1wTfmmMQUn",fields:"id,displayName,optionSet[options[id, displayName,code]]"}}},{program:c,dataElements:r}=await a.query(t);let i={id:c.id,name:c.name,trackedEntityType:{id:c.trackedEntityType.id,displayName:c.trackedEntityType.displayName,trackedEntityTypeAttributes:[]}};for(var n of c.trackedEntityType.trackedEntityTypeAttributes)i.trackedEntityType.trackedEntityTypeAttributes.push(n.trackedEntityAttribute);let o={};for(var l of r.dataElements)if(l.displayName.startsWith("ICU")){let e={id:l.id,displayName:l.displayName};l.optionSet&&(e.options=l.optionSet.options),o[l.displayName]=e}i.dataElements=o,e(E(i))}catch(c){console.log("Error in query:",c)}})},[]),l.a.createElement("div",{style:{height:"100vh"}},e)}t.default=function(){const e=Object(r.b)(),t=Object(d.c)({thunk:{extraArgument:e}}),a=Object(d.a)({reducer:I,middleware:t});return l.a.createElement(c.a,{store:a},l.a.createElement(G,null,l.a.createElement("div",{className:"container"},l.a.createElement("div",{className:"left-column"},l.a.createElement(h,null)),l.a.createElement("div",{className:"right-column"},l.a.createElement(K,null)))))}}}]);
//# sourceMappingURL=app.04aae89b.chunk.js.map